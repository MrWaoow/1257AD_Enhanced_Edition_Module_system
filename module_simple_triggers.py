# -*- coding: UTF-8 -*-
####################################################################################################################
# Generated by Warband Module Decompiler
# All rights of the module belong to their respective owners
####################################################################################################################

from header_common import *
from header_operations import *
from header_parties import *
from header_items import *
from header_skills import *
from header_triggers import *
from header_troops import *
from header_music import *

from module_constants import *

####################################################################################################################
# Simple triggers are the alternative to old style triggers. They do not preserve state, and thus simpler to maintain.
#
#  Each simple trigger contains the following fields:
# 1) Check interval: How frequently this trigger will be checked
# 2) Operation block: This must be a valid operation block. See header_operations.py for reference. 
####################################################################################################################

simple_triggers = [
  (ti_on_party_encounter,
  []),

  (ti_simulate_battle,
  []),

  (0.1,
  [
    (try_begin),
      (eq, "$bug_fix_version", 0),
      (disable_party, "p_test_scene"),
      (faction_set_note_available, "fac_player_faction", 0),
      (faction_set_note_available, "fac_no_faction", 0),
      (try_begin),
        (neg|check_quest_active, "qst_kidnapped_girl"),
        (party_remove_members, "p_main_party", "trp_kidnapped_girl", 1),
      (try_end),
      (try_for_range, ":var0", "trp_knight_1_1", "trp_enhanced_rnd_lord_end"),
        (troop_slot_eq, ":var0", 166, 1),
        (try_begin),
          (troop_slot_eq, ":var0", 2, 0),
          (store_faction_of_troop, ":var1", ":var0"),
          (is_between, ":var1", "fac_kingdom_1", "fac_kingdoms_end"),
          (troop_set_slot, ":var0", 2, 2),
        (try_end),
      (try_end),
      (call_script, "script_initialize_item_info"),
      (assign, "$bug_fix_version", 1),
    (try_end),
    (eq, "$g_player_is_captive", 1),
    (gt, "$capturer_party", 0),
    (party_is_active, "$capturer_party"),
    (party_relocate_near_party, "p_main_party", "$capturer_party", 0),
  ]),

  (0,
  [
    (try_begin),
      (gt, "$g_last_rest_center", 0),
      (party_get_battle_opponent, ":var0", "$g_last_rest_center"),
      (gt, ":var0", 0),
      (store_faction_of_party, ":var1", "$g_last_rest_center"),
      (store_relation, ":var2", ":var1", "fac_player_supporters_faction"),
      (store_faction_of_party, ":var3", ":var0"),
      (store_relation, ":var4", ":var3", "fac_player_supporters_faction"),
      (ge, ":var2", 0),
      (lt, ":var4", 0),
      (start_encounter, "$g_last_rest_center"),
      (rest_for_hours, 0, 0, 0),
    (else_try),
      (store_current_hours, ":var5"),
      (assign, ":var6", 0),
      (try_begin),
        (neq, "$g_check_autos_at_hour", 0),
        (ge, ":var5", "$g_check_autos_at_hour"),
        (assign, ":var6", 1),
        (assign, "$g_check_autos_at_hour", 0),
      (try_end),
      (this_or_next|eq, ":var6", 1),
      (map_free),
      (try_begin),
        (ge, "$auto_menu", 1),
        (jump_to_menu, "$auto_menu"),
        (assign, "$auto_menu", -1),
      (else_try),
        (ge, "$auto_enter_town", 1),
        (start_encounter, "$auto_enter_town"),
      (else_try),
        (ge, "$g_camp_mode", 1),
        (assign, "$g_camp_mode", 0),
        (assign, "$g_infinite_camping", 0),
        (assign, "$g_player_icon_state", 0),
        (rest_for_hours, 0, 0, 0),
        (display_message, "@Breaking camp..."),
      (try_end),
    (try_end),
  ]),

  (0.25,
  [
    (gt, "$auto_besiege_town", 0),
    (gt, "$g_player_besiege_town", 0),
    (ge, "$g_siege_method", 1),
    (store_distance_to_party_from_party, ":var0", "$g_player_besiege_town", "p_main_party"),
    (try_begin),
      (gt, ":var0", 2),
      (str_store_party_name_link, s1, "$g_player_besiege_town"),
      (display_message, "@You have broken off your siege of {s1}."),
      (call_script, "script_lift_siege", "$g_player_besiege_town", 0),
      (assign, "$g_player_besiege_town", -1),
      (rest_for_hours, 0, 0, 0),
    (else_try),
      (ge, ":var0", 1),
      (map_free),
      (str_store_party_name_link, s1, "$g_player_besiege_town"),
      (display_message, "@You cannot maintain your siege of {s1} from this distance. You risk your lines breaking."),
    (else_try),
      (eq, "$g_siege_force_wait", 0),
      (store_current_hours, ":var1"),
      (ge, ":var1", "$g_siege_method_finish_hours"),
      (neg|is_currently_night),
      (rest_for_hours, 0, 0, 0),
      (start_encounter, "$auto_besiege_town"),
    (try_end),
  ]),

  (0,
  [
    (troop_slot_ge, "trp_notification_menu_types", 0, 1),
    (troop_get_slot, ":var0", "trp_notification_menu_types", 0),
    (troop_get_slot, "$g_notification_menu_var1", "trp_notification_menu_var1", 0),
    (troop_get_slot, "$g_notification_menu_var2", "trp_notification_menu_var2", 0),
    (jump_to_menu, ":var0"),
    (assign, ":var1", 2),
    (try_for_range, ":var2", 1, ":var1"),
      (try_begin),
        (troop_slot_ge, "trp_notification_menu_types", ":var2", 1),
        (val_add, ":var1", 1),
      (try_end),
      (store_sub, ":var3", ":var2", 1),
      (troop_get_slot, ":var4", "trp_notification_menu_types", ":var2"),
      (troop_set_slot, "trp_notification_menu_types", ":var3", ":var4"),
      (troop_get_slot, ":var4", "trp_notification_menu_var1", ":var2"),
      (troop_set_slot, "trp_notification_menu_var1", ":var3", ":var4"),
      (troop_get_slot, ":var4", "trp_notification_menu_var2", ":var2"),
      (troop_set_slot, "trp_notification_menu_var2", ":var3", ":var4"),
    (try_end),
  ]),

  (2,
  [
    (map_free),
    (try_begin),
      (call_script, "script_music_set_situation_with_culture", 65536),
    (try_end),
  ]),

  (0,
  [
    (try_begin),
      (eq, "$caravan_escort_state", 1),
      (party_is_active, "$caravan_escort_party_id"),
      (store_distance_to_party_from_party, ":var0", "$caravan_escort_destination_town", "$caravan_escort_party_id"),
      (lt, ":var0", 2),
      (store_distance_to_party_from_party, ":var1", "p_main_party", "$caravan_escort_party_id"),
      (lt, ":var1", 5),
      (assign, "$talk_context", 2),
      (assign, "$g_encountered_party", "$caravan_escort_party_id"),
      (party_stack_get_troop_id, ":var2", "$caravan_escort_party_id", 0),
      (party_stack_get_troop_dna, ":var3", "$caravan_escort_party_id", 0),
      (start_map_conversation, ":var2", ":var3"),
    (try_end),
    (try_begin),
      (gt, "$g_reset_mission_participation", 1),
      (try_for_range, ":var4", "trp_npc1", "trp_heroes_end"),
        (troop_set_slot, ":var4", 149, 0),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (faction_slot_eq, "$players_kingdom", 21, 0),
    (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    (faction_slot_eq, "$players_kingdom", 4, 6),
    (store_current_hours, ":var0"),
    (faction_get_slot, ":var1", "$players_kingdom", 97),
    (val_sub, ":var0", ":var1"),
    (gt, ":var0", 168),
    (call_script, "script_faction_conclude_feast", "$players_kingdom", 6),
    (display_message, "@Your kingdoms feast have concluded."),
  ]),

  (0.171,
  [
    (try_begin),
      (lt, "$g_locate_ladies_cur_lady", "trp_knight_1_1_wife"),
      (assign, "$g_locate_ladies_cur_lady", "trp_knight_1_1_wife"),
    (try_end),
    (try_begin),
      (ge, "$g_locate_ladies_cur_lady", "trp_heroes_end"),
      (assign, "$g_locate_ladies_cur_lady", "trp_knight_1_1_wife"),
    (try_end),
    (try_begin),
      (neg|troop_slot_ge, "$g_locate_ladies_cur_lady", 8, 0),
      (neg|troop_slot_eq, "$g_locate_ladies_cur_lady", 30, "trp_player"),
      (call_script, "script_get_kingdom_lady_social_determinants", "$g_locate_ladies_cur_lady"),
      (assign, ":var0", reg1),
      (troop_set_slot, "$g_locate_ladies_cur_lady", 12, ":var0"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_locate_ladies_cur_lady", 30, "trp_player"),
      (neg|troop_slot_ge, "$g_locate_ladies_cur_lady", 8, 0),
      (troop_get_slot, ":var1", "$g_locate_ladies_cur_lady", 246),
      (neq, ":var1", "$g_player_court"),
      (troop_set_slot, "$g_locate_ladies_cur_lady", 12, "$g_player_court"),
    (try_end),
    (val_add, "$g_locate_ladies_cur_lady", 1),
  ]),

  (24,
  [
    (try_begin),
      (neg|check_quest_active, "qst_visit_lady"),
      (neg|troop_slot_ge, "trp_player", 8, 1),
      (neg|troop_slot_ge, "trp_player", 30, "trp_npc1"),
      (assign, ":var0", -1),
      (assign, ":var1", 120),
      (try_for_range, ":var2", "trp_knight_1_1_wife", "trp_heroes_end"),
        (troop_slot_ge, ":var2", 5, 2),
        (neg|troop_slot_eq, ":var2", 5, 4),
        (troop_slot_eq, ":var2", 37, 0),
        (troop_slot_eq, ":var2", 30, -1),
        (troop_get_slot, ":var3", ":var2", 12),
        (is_between, ":var3", "p_town_1_1", "p_village_1_1"),
        (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var2"),
        (gt, reg0, 1),
        (store_current_hours, ":var4"),
        (troop_get_slot, ":var5", ":var2", 4),
        (val_sub, ":var4", ":var5"),
        (gt, ":var4", ":var1"),
        (assign, ":var1", ":var4"),
        (assign, ":var0", ":var2"),
        (assign, ":var6", ":var3"),
      (try_end),
      (try_begin),
        (gt, ":var0", 0),
        (call_script, "script_add_notification_menu", "mnu_notification_lady_requests_visit", ":var0", ":var6"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (ge, "$g_player_raiding_village", 1),
    (try_begin),
      (neq, "$g_player_is_captive", 0),
      (assign, "$g_player_raiding_village", 0),
    (else_try),
      (this_or_next|party_slot_eq, "$g_player_raiding_village", 35, 2),
      (party_slot_eq, "$g_player_raiding_village", 35, 4),
      (start_encounter, "$g_player_raiding_village"),
      (rest_for_hours, 0),
      (assign, "$g_player_raiding_village", 0),
      (assign, "$g_player_raid_complete", 1),
    (else_try),
      (party_slot_eq, "$g_player_raiding_village", 35, 1),
      (rest_for_hours_interactive, 3, 3, 1),
    (else_try),
      (rest_for_hours, 0, 0, 0),
      (assign, "$g_player_raiding_village", 0),
      (assign, "$g_player_raid_complete", 0),
    (try_end),
  ]),

  (0.25,
  [
    (ge, "$g_player_raiding_village", 1),
    (store_distance_to_party_from_party, ":var0", "$g_player_raiding_village", "p_main_party"),
    (try_begin),
      (gt, ":var0", 4),
      (str_store_party_name_link, s1, "$g_player_raiding_village"),
      (display_message, "@You have broken off your raid of {s1}."),
      (call_script, "script_village_set_state", "$current_town", 0),
      (party_set_slot, "$current_town", 34, -1),
      (assign, "$g_player_raiding_village", 0),
      (rest_for_hours, 0, 0, 0),
    (else_try),
      (ge, ":var0", 2),
      (map_free),
      (jump_to_menu, "mnu_village_loot_continue"),
    (try_end),
  ]),

  (168,
  [
    (try_begin),
      (eq, "$do_once_budget_presentation", 0),
      (assign, "$do_once_budget_presentation", 1),
      (store_current_hours, "$g_last_payday"),
    (else_try),
      (eq, "$do_once_budget_presentation", 1),
      (assign, "$g_presentation_lines_to_display_begin", 0),
      (assign, "$g_presentation_lines_to_display_end", 15),
      (assign, "$g_apply_budget_report_to_gold", 1),
      (store_current_hours, "$g_last_payday"),
      (try_begin),
        (this_or_next|eq, "$g_infinite_camping", 0),
        (eq, "$freelancer_state", 1),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (party_get_num_companions, ":var0", "p_main_party"),
          (gt, ":var0", 1),
        (else_try),
          (start_presentation, "prsnt_budget_report"),
        (try_end),
        (try_begin),
          (gt, "$g_player_debt_to_party_members", 5000),
          (call_script, "script_add_notification_menu", "mnu_dplmc_deserters", 20, 0),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (24,
  [
    (le, "$auto_menu", 0),
    (gt, "$players_kingdom", 0),
    (neg|faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    (eq, "$player_has_homage", 0),
    (eq, "$freelancer_state", 0),
    (troop_get_slot, ":var0", "trp_player", 30),
    (assign, ":var1", 0),
    (try_begin),
      (is_between, ":var0", "trp_npc1", "trp_knight_1_1_wife"),
      (store_faction_of_troop, ":var2", ":var0"),
      (eq, ":var2", "$players_kingdom"),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 0),
    (store_current_day, ":var3"),
    (gt, ":var3", "$mercenary_service_next_renew_day"),
    (jump_to_menu, "mnu_oath_fulfilled"),
  ]),

  (72,
  [
    (assign, "$lady_flirtation_location", 0),
    (try_for_range, ":var0", "p_town_1_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 7),
      (gt, ":var1", -1),
      (neg|troop_slot_eq, ":var1", 166, 1),
      (party_set_slot, ":var0", 7, -1),
    (try_end),
  ]),

  (4,
  [
    (assign, "$g_time_to_spare", 1),
    (try_begin),
      (troop_slot_ge, "trp_player", 30, "trp_npc1"),
      (assign, "$g_player_banner_granted", 1),
    (try_end),
  ]),

  (24,
  [
    (eq, "$g_player_banner_granted", 1),
    (troop_slot_eq, "trp_player", 13, 0),
    (le, "$auto_menu", 0),
    (start_presentation, "prsnt_banner_selection"),
  ]),

  (24,
  [
    (call_script, "script_get_player_party_morale_values"),
    (assign, ":var0", reg0),
    (party_get_morale, ":var1", "p_main_party"),
    (store_sub, ":var2", ":var0", ":var1"),
    (store_div, ":var3", ":var2", 5),
    (store_mul, ":var4", ":var3", 5),
    (try_begin),
      (neq, ":var4", ":var2"),
      (try_begin),
        (gt, ":var2", 0),
        (val_add, ":var3", 1),
      (else_try),
        (val_sub, ":var3", 1),
      (try_end),
    (try_end),
    (val_add, ":var1", ":var3"),
    (party_set_morale, "p_main_party", ":var1"),
  ]),

  (0.54,
  [
    (try_begin),
      (eq, "$g_prison_culling", 0),
      (try_begin),
        (lt, "$g_prison_culling_cur_center", "p_town_1_1"),
        (assign, "$g_prison_culling_cur_center", "p_town_1_1"),
      (try_end),
      (try_begin),
        (ge, "$g_prison_culling_cur_center", "p_village_1_1"),
        (assign, "$g_prison_culling_cur_center", "p_town_1_1"),
      (try_end),
      (try_begin),
        (party_get_num_prisoner_stacks, ":var0", "$g_prison_culling_cur_center"),
        (try_for_range_backwards, ":var1", 0, ":var0"),
          (party_prisoner_stack_get_troop_id, ":var2", "$g_prison_culling_cur_center", ":var1"),
          (neg|troop_is_hero, ":var2"),
          (party_prisoner_stack_get_size, ":var3", "$g_prison_culling_cur_center", ":var1"),
          (gt, ":var3", 0),
          (call_script, "script_game_get_prisoner_price", ":var2"),
          (assign, ":var4", reg0),
          (store_random_in_range, ":var5", 10, 60),
          (val_mul, ":var3", ":var5"),
          (val_div, ":var3", 100),
          (try_begin),
            (eq, ":var3", 0),
            (val_add, ":var3", 1),
          (try_end),
          (party_get_slot, ":var6", "$g_prison_culling_cur_center", 49),
          (store_mul, ":var7", ":var3", ":var4"),
          (val_add, ":var6", ":var7"),
          (party_set_slot, "$g_prison_culling_cur_center", 49, ":var6"),
          (party_remove_prisoners, "$g_prison_culling_cur_center", ":var2", ":var3"),
        (try_end),
      (try_end),
      (val_add, "$g_prison_culling_cur_center", 1),
      (val_add, "$g_simple_trigger_fire_count_1", 1),
    (try_end),
  ]),

  (0.237,
  [
    (try_begin),
      (lt, "$g_calculate_weekly_income_cur_npc", "trp_npc1"),
      (assign, "$g_calculate_weekly_income_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_calculate_weekly_income_cur_npc", "trp_knight_1_1_wife"),
      (assign, "$g_calculate_weekly_income_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_calculate_weekly_income_cur_npc", 166, 1),
      (troop_get_slot, ":var0", "$g_calculate_weekly_income_cur_npc", 21),
      (val_mul, ":var0", 101),
      (val_div, ":var0", 100),
      (troop_set_slot, "$g_calculate_weekly_income_cur_npc", 21, ":var0"),
      (call_script, "script_calculate_hero_weekly_net_income_and_add_to_wealth", "$g_calculate_weekly_income_cur_npc"),
    (try_end),
    (val_add, "$g_calculate_weekly_income_cur_npc", 1),
    (val_add, "$g_simple_trigger_fire_count_2", 1),
  ]),

  (6,
  [
    (store_current_day, ":var0"),
    (try_begin),
      (neq, ":var0", "$g_last_half_payment_check_day"),
      (assign, "$g_last_half_payment_check_day", ":var0"),
      (try_begin),
        (eq, "$g_half_payment_checkpoint", 1),
        (val_add, "$g_cur_week_half_daily_wage_payments", 1),
      (try_end),
      (assign, "$g_half_payment_checkpoint", 1),
      (call_script, "script_pcamp_ransom_prisoners"),
    (try_end),
    (assign, ":var1", 0),
    (try_begin),
      (neg|map_free),
      (ge, "$g_last_rest_center", 0),
      (this_or_next|party_slot_eq, "$g_last_rest_center", 130, 1),
      (is_between, "$g_last_rest_center", "p_town_1_1", "p_village_1_1"),
      (assign, ":var1", 1),
    (try_end),
    (eq, ":var1", 0),
    (assign, "$g_half_payment_checkpoint", 0),
  ]),

  (8,
  [
    (try_begin),
      (call_script, "script_raf_create_incidents"),
      (assign, ":var0", reg0),
      (assign, ":var1", reg1),
      (gt, ":var0", 0),
      (gt, ":var1", 0),
      (store_faction_of_party, ":var2", ":var0"),
      (store_faction_of_party, ":var3", ":var1"),
      (neq, ":var0", ":var1"),
      (neq, ":var2", ":var3"),
      (call_script, "script_diplomacy_faction_get_diplomatic_status_with_faction", ":var3", ":var2"),
      (eq, reg0, 0),
      (try_begin),
        (party_slot_eq, ":var0", 61, ":var3"),
        (call_script, "script_create_incidents_new", ":var0", -1),
      (else_try),
        (party_slot_eq, ":var0", 62, ":var3"),
        (call_script, "script_create_incidents_new", ":var0", -1),
      (else_try),
        (set_fixed_point_multiplier, 1),
        (store_distance_to_party_from_party, ":var4", ":var0", ":var1"),
        (lt, ":var4", 25),
        (call_script, "script_create_incidents_new", ":var0", ":var1"),
      (try_end),
    (try_end),
  ]),

  (0.328,
  [
    (try_begin),
      (lt, "$g_update_faction_notes_cur_fac", "fac_player_supporters_faction"),
      (assign, "$g_update_faction_notes_cur_fac", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (ge, "$g_update_faction_notes_cur_fac", "fac_kingdoms_end"),
      (assign, "$g_update_faction_notes_cur_fac", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (faction_slot_eq, "$g_update_faction_notes_cur_fac", 21, 0),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (neq, "$g_update_faction_notes_cur_fac", ":var0"),
        (faction_slot_eq, ":var0", 21, 0),
        (store_add, ":var1", ":var0", 160),
        (val_sub, ":var1", "fac_player_supporters_faction"),
        (faction_get_slot, ":var2", "$g_update_faction_notes_cur_fac", ":var1"),
        (try_begin),
          (ge, ":var2", 1),
          (try_begin),
            (eq, ":var2", 1),
            (call_script, "script_update_faction_notes", "$g_update_faction_notes_cur_fac"),
            (lt, "$g_update_faction_notes_cur_fac", ":var0"),
            (try_begin),
              (this_or_next|eq, "$g_update_faction_notes_cur_fac", "$players_kingdom"),
              (eq, ":var0", "$players_kingdom"),
              (call_script, "script_add_notification_menu", "mnu_notification_truce_expired", "$g_update_faction_notes_cur_fac", ":var0"),
            (else_try),
              (str_store_faction_name, s1, "$g_update_faction_notes_cur_fac"),
              (str_store_faction_name, s2, ":var0"),
              (display_log_message, "@The truce between {s1} and {s2} has expired."),
            (try_end),
          (try_end),
          (val_sub, ":var2", 1),
          (faction_set_slot, "$g_update_faction_notes_cur_fac", ":var1", ":var2"),
        (try_end),
        (store_add, ":var3", ":var0", 220),
        (val_sub, ":var3", "fac_player_supporters_faction"),
        (faction_get_slot, ":var4", "$g_update_faction_notes_cur_fac", ":var3"),
        (try_begin),
          (ge, ":var4", 1),
          (try_begin),
            (store_relation, ":var5", "$g_update_faction_notes_cur_fac", ":var0"),
            (lt, ":var5", 0),
            (faction_set_slot, "$g_update_faction_notes_cur_fac", ":var3", 0),
          (else_try),
            (eq, ":var4", 1),
            (try_begin),
              (this_or_next|eq, "$g_update_faction_notes_cur_fac", "$players_kingdom"),
              (eq, ":var0", "$players_kingdom"),
              (call_script, "script_add_notification_menu", "mnu_notification_casus_belli_expired", "$g_update_faction_notes_cur_fac", ":var0"),
            (else_try),
              (str_store_faction_name, s1, "$g_update_faction_notes_cur_fac"),
              (str_store_faction_name, s2, ":var0"),
              (faction_get_slot, ":var6", "$g_update_faction_notes_cur_fac", 11),
              (str_store_troop_name, s3, ":var6"),
              (troop_get_type, reg4, ":var6"),
              (display_log_message, "@The {s1} has not responded to the {s2}'s provocations, and {s3} suffers a loss of face among {reg4?her:his} more bellicose subjects...."),
            (try_end),
            (faction_set_slot, "$g_update_faction_notes_cur_fac", ":var3", 0),
          (else_try),
            (val_sub, ":var4", 1),
            (faction_set_slot, "$g_update_faction_notes_cur_fac", ":var3", ":var4"),
          (try_end),
        (try_end),
        (try_begin),
          (store_relation, ":var5", "$g_update_faction_notes_cur_fac", ":var0"),
          (lt, ":var5", 0),
          (store_add, ":var7", ":var0", 300),
          (val_sub, ":var7", "fac_player_supporters_faction"),
          (faction_get_slot, ":var8", "$g_update_faction_notes_cur_fac", ":var7"),
          (val_add, ":var8", 1),
          (faction_set_slot, "$g_update_faction_notes_cur_fac", ":var7", ":var8"),
        (try_end),
      (try_end),
      (call_script, "script_update_faction_notes", "$g_update_faction_notes_cur_fac"),
    (try_end),
    (val_add, "$g_update_faction_notes_cur_fac", 1),
    (val_add, "$g_simple_trigger_fire_count_3", 1),
  ]),

  (0.033,
  [
    (try_begin),
      (eq, "$g_party_npc_trainer", 1),
      (try_begin),
        (lt, "$g_daily_training_cur_lord", "trp_npc1"),
        (assign, "$g_daily_training_cur_lord", "trp_npc1"),
      (try_end),
      (try_begin),
        (ge, "$g_daily_training_cur_lord", "trp_knight_1_1_wife"),
        (assign, "$g_daily_training_cur_lord", "trp_npc1"),
      (try_end),
      (try_begin),
        (troop_slot_eq, "$g_daily_training_cur_lord", 166, 1),
        (troop_slot_eq, "$g_daily_training_cur_lord", 2, 2),
        (troop_get_slot, ":var0", "$g_daily_training_cur_lord", 10),
        (gt, ":var0", "p_salt_mine"),
        (party_is_active, ":var0"),
        (call_script, "script_party_daily_training", ":var0"),
      (try_end),
      (val_add, "$g_daily_training_cur_lord", 1),
      (val_add, "$g_simple_trigger_fire_count_4", 1),
    (try_end),
  ]),

  (0.07,
  [
    (try_begin),
      (eq, "$g_party_npc_trainer", 1),
      (try_begin),
        (lt, "$g_daily_training_cur_center", "p_town_1_1"),
        (assign, "$g_daily_training_cur_center", "p_town_1_1"),
      (try_end),
      (try_begin),
        (ge, "$g_daily_training_cur_center", "p_village_1_1"),
        (assign, "$g_daily_training_cur_center", "p_town_1_1"),
      (try_end),
      (try_begin),
        (party_slot_eq, "$g_daily_training_cur_center", 54, -1),
        (call_script, "script_party_daily_training", "$g_daily_training_cur_center"),
      (try_end),
      (val_add, "$g_daily_training_cur_center", 1),
      (val_add, "$g_simple_trigger_fire_count_5", 1),
    (try_end),
  ]),

  (0.07,
  [
    (try_begin),
      (lt, "$g_process_sieges_cur_center", "p_town_1_1"),
      (assign, "$g_process_sieges_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_process_sieges_cur_center", "p_village_1_1"),
      (assign, "$g_process_sieges_cur_center", "p_town_1_1"),
    (try_end),
    (call_script, "script_process_sieges", "$g_process_sieges_cur_center"),
    (val_add, "$g_process_sieges_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_6", 1),
  ]),

  (0.033,
  [
    (try_begin),
      (lt, "$g_process_village_raids_cur_village", "p_village_1_1"),
      (assign, "$g_process_village_raids_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_process_village_raids_cur_village", "p_salt_mine"),
      (assign, "$g_process_village_raids_cur_village", "p_village_1_1"),
    (try_end),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (call_script, "script_process_village_raids", "$g_process_village_raids_cur_village"),
    (val_add, "$g_process_village_raids_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_7", 5),
  ]),

  (24,
  [
    (assign, "$men_are_pleased", 0),
  ]),

  (0.033,
  [
    (try_begin),
      (lt, "$g_recalculate_controversy_cur_npc", "trp_npc1"),
      (assign, "$g_recalculate_controversy_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_recalculate_controversy_cur_npc", "trp_knight_1_1_wife"),
      (assign, "$g_recalculate_controversy_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_recalculate_controversy_cur_npc", 166, 1),
      (troop_get_slot, ":var0", "$g_recalculate_controversy_cur_npc", 51),
      (val_sub, ":var0", 5),
      (val_max, ":var0", 0),
      (troop_set_slot, "$g_recalculate_controversy_cur_npc", 51, ":var0"),
    (try_end),
    (store_random_in_range, ":var1", 1, 3),
    (val_min, ":var1", 2),
    (try_begin),
      (troop_get_slot, ":var2", "$g_recalculate_controversy_cur_npc", 150),
      (ge, ":var2", 1),
      (val_sub, ":var2", ":var1"),
      (val_max, ":var2", 0),
      (troop_set_slot, "$g_recalculate_controversy_cur_npc", 150, ":var2"),
    (try_end),
    (val_add, "$g_recalculate_controversy_cur_npc", 1),
    (val_add, "$g_simple_trigger_fire_count_8", 1),
  ]),

  (24,
  [
    (store_random_in_range, ":var0", 1, 3),
    (troop_get_slot, ":var1", "trp_player", 150),
    (val_sub, ":var1", ":var0"),
    (val_max, ":var1", 0),
    (troop_set_slot, "trp_player", 150, ":var1"),
  ]),

  (6,
  [
    (call_script, "script_cf_random_political_event"),
    (call_script, "script_cf_random_political_event"),
  ]),

  (0.5,
  [
    (try_begin),
      (neg|is_between, "$g_lord_long_term_count", "trp_kingdom_heroes_including_player_begin", "trp_knight_1_1_wife"),
      (assign, "$g_lord_long_term_count", "trp_kingdom_heroes_including_player_begin"),
    (try_end),
    (assign, ":var0", "$g_lord_long_term_count"),
    (try_begin),
      (eq, ":var0", "trp_kingdom_heroes_including_player_begin"),
      (assign, ":var0", "trp_player"),
    (try_end),
    (try_begin),
      (eq, "$cheat_mode", 1),
      (str_store_troop_name, s9, ":var0"),
      (display_message, "@{!}DEBUG -- Doing political calculations for {s9}"),
    (try_end),
    (try_begin),
      (troop_slot_eq, ":var0", 166, 1),
      (troop_slot_eq, ":var0", 2, 2),
      (neq, ":var0", "trp_player"),
      (assign, ":var1", -1),
      (try_for_range, ":var2", "p_town_1_1", "p_salt_mine"),
        (party_slot_eq, ":var2", 7, ":var0"),
        (assign, ":var1", ":var2"),
      (try_end),
      (try_begin),
        (eq, ":var1", -1),
        (is_between, ":var0", "trp_npc1", "trp_knight_1_1_wife"),
        (store_faction_of_troop, ":var3", ":var0"),
        (faction_get_slot, ":var4", ":var3", 11),
        (troop_get_slot, ":var5", ":var0", 52),
        (try_begin),
          (neq, ":var4", ":var0"),
          (try_begin),
            (eq, "$g_landless_vassals_compensation", 1),
            (eq, ":var4", "trp_player"),
            (assign, ":var6", 2000),
            (assign, ":var7", ":var6"),
            (try_begin),
              (store_skill_level, ":var8", "skl_persuasion", "trp_player"),
              (store_mul, ":var9", ":var8", 4),
              (assign, ":var10", ":var6"),
              (val_div, ":var10", 100),
              (val_mul, ":var10", ":var9"),
              (val_sub, ":var7", ":var10"),
            (try_end),
            (try_begin),
              (call_script, "script_troop_get_relation_with_troop", "trp_player", ":var0"),
              (assign, ":var11", reg0),
              (gt, ":var11", 0),
              (store_div, ":var9", ":var11", 5),
              (assign, ":var10", ":var6"),
              (val_div, ":var10", 100),
              (val_mul, ":var10", ":var9"),
              (val_sub, ":var7", ":var10"),
            (try_end),
            (assign, reg17, ":var7"),
            (store_troop_gold, ":var12", "trp_household_possessions"),
            (ge, ":var12", reg17),
            (call_script, "script_dplmc_withdraw_from_treasury", reg17),
            (troop_get_slot, ":var13", ":var0", 11),
            (val_add, ":var13", reg17),
            (troop_set_slot, ":var0", 11, ":var13"),
            (str_store_troop_name_link, s1, ":var0"),
            (display_message, "@{reg17} coins were withdraw from your treasury to pay for {s1}'s compensation.", 0x7D7DFF),
            (assign, "$g_no_money_for_compensation", 0),
          (else_try),
            (eq, "$g_landless_vassals_compensation", 1),
            (eq, ":var4", "trp_player"),
            (store_troop_gold, ":var12", "trp_household_possessions"),
            (lt, ":var12", reg17),
            (display_message, "@You didn't have the {reg17} coins in the treasury to pay for {s1}'s compensation. Thus you suffer a relation hit!", 0xFF1A1A),
            (assign, "$g_no_money_for_compensation", 1),
          (else_try),
            (this_or_next|eq, "$g_landless_vassals_compensation", 0),
            (this_or_next|neq, ":var4", "trp_player"),
            (eq, "$g_no_money_for_compensation", 1),
            (this_or_next|eq, ":var5", 2),
            (this_or_next|eq, ":var5", 3),
            (this_or_next|eq, ":var5", 4),
            (eq, ":var5", 5),
            (call_script, "script_troop_change_relation_with_troop", ":var0", ":var4", -4),
            (val_add, "$total_no_fief_changes", -4),
            (try_begin),
              (eq, ":var4", "trp_player"),
              (eq, "$g_no_money_for_compensation", 0),
              (str_store_troop_name_link, s1, ":var0"),
              (display_message, "@{s1} is angry at you for not having a fief!", 0xFF1A1A),
            (else_try),
              (eq, ":var4", "trp_player"),
              (eq, "$g_no_money_for_compensation", 1),
              (assign, "$g_no_money_for_compensation", 0),
            (try_end),
          (else_try),
            (this_or_next|eq, "$g_landless_vassals_compensation", 0),
            (this_or_next|neq, ":var4", "trp_player"),
            (eq, "$g_no_money_for_compensation", 1),
            (eq, ":var5", 1),
            (call_script, "script_troop_change_relation_with_troop", ":var0", ":var4", -2),
            (val_add, "$total_no_fief_changes", -2),
            (try_begin),
              (eq, ":var4", "trp_player"),
              (eq, "$g_no_money_for_compensation", 0),
              (str_store_troop_name_link, s1, ":var0"),
              (display_message, "@{s1} is angry at you for not having a fief!", 0xFF1A1A),
            (else_try),
              (eq, ":var4", "trp_player"),
              (eq, "$g_no_money_for_compensation", 1),
              (assign, "$g_no_money_for_compensation", 0),
            (try_end),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (try_begin),
      (troop_slot_eq, ":var0", 166, 1),
      (this_or_next|troop_slot_eq, ":var0", 2, 2),
      (eq, ":var0", "trp_player"),
      (try_begin),
        (eq, ":var0", "trp_player"),
        (assign, ":var14", "$players_kingdom"),
      (else_try),
        (store_faction_of_troop, ":var14", ":var0"),
      (try_end),
      (faction_get_slot, ":var4", ":var14", 11),
      (neq, ":var0", ":var4"),
      (neg|is_between, ":var0", "trp_kingdom_1_lord", "trp_knight_1_1"),
      (neg|is_between, ":var0", "trp_kingdom_2_pretender", "trp_knight_1_1_wife"),
      (assign, ":var15", 0),
      (try_for_range, ":var16", "p_town_1_1", "p_village_1_1"),
        (store_faction_of_party, ":var17", ":var16"),
        (eq, ":var17", ":var14"),
        (val_add, ":var15", 1),
      (try_end),
      (try_begin),
        (this_or_next|eq, ":var14", "$players_kingdom"),
        (eq, ":var14", "fac_player_supporters_faction"),
        (val_add, ":var15", 1),
      (try_end),
      (call_script, "script_troop_get_relation_with_troop", ":var0", ":var4"),
      (this_or_next|le, reg0, -50),
      (eq, ":var15", 0),
      (call_script, "script_cf_troop_can_intrigue", ":var0", 0),
      (store_random_in_range, ":var18", 0, 2),
      (try_begin),
        (this_or_next|eq, ":var15", 0),
        (neq, ":var18", 0),
        (neq, ":var0", "trp_player"),
        (try_begin),
          (neq, ":var15", 0),
          (assign, "$g_give_advantage_to_original_faction", 1),
        (try_end),
        (store_faction_of_troop, ":var19", ":var0"),
        (call_script, "script_ee_lord_find_faction_to_defect", ":var0"),
        (assign, ":var20", reg0),
        (assign, "$g_give_advantage_to_original_faction", 0),
        (try_begin),
          (neq, ":var20", ":var19"),
          (is_between, ":var20", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (str_store_troop_name_link, s1, ":var0"),
          (str_store_faction_name_link, s2, ":var20"),
          (str_store_faction_name_link, s3, ":var14"),
          (call_script, "script_change_troop_faction", ":var0", ":var20"),
          (try_begin),
            (ge, "$cheat_mode", 1),
            (str_store_troop_name, s4, ":var0"),
            (display_message, "@{!}DEBUG - {s4} faction changed in defection"),
          (try_end),
          (troop_get_type, reg4, ":var0"),
          (str_store_string, s4, "str_lord_defects_ordinary"),
          (display_log_message, "@{!}{s4}"),
          (faction_get_slot, ":var21", ":var14", 133),
          (val_add, ":var21", 1),
          (faction_set_slot, ":var14", 133, ":var21"),
          (try_begin),
            (this_or_next|eq, ":var20", "$players_kingdom"),
            (eq, ":var14", "$players_kingdom"),
            (call_script, "script_add_notification_menu", "mnu_notification_lord_defects", ":var0", ":var14"),
          (try_end),
        (try_end),
      (else_try),
        (neq, ":var4", "trp_player"),
        (call_script, "script_troop_get_relation_with_troop", ":var0", ":var4"),
        (le, reg0, -40),
        (assign, ":var22", reg0),
        (store_random_in_range, ":var23", -101, 0),
        (try_begin),
          (gt, ":var23", ":var22"),
          (gt, "$g_lord_death_chance_execution_base", 0),
          (call_script, "script_ee_get_execution_method", ":var4"),
          (assign, ":var24", reg0),
          (call_script, "script_kill_lord_execution", ":var4", ":var0", -1, ":var24", 3),
        (else_try),
          (call_script, "script_indict_lord_for_treason", ":var0", ":var14"),
        (try_end),
      (try_end),
    (try_end),
    (try_for_range, ":var25", "trp_npc1", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var25", 166, 1),
      (call_script, "script_troop_get_relation_with_troop", ":var0", ":var25"),
      (lt, reg0, 0),
      (assign, ":var26", reg0),
      (store_sub, ":var27", 0, ":var26"),
      (store_random_in_range, ":var28", 0, 300),
      (lt, ":var28", ":var27"),
      (call_script, "script_troop_change_relation_with_troop", ":var0", ":var25", 1),
      (val_add, "$total_relation_changes_through_convergence", 1),
    (try_end),
    (val_add, "$g_lord_long_term_count", 1),
  ]),

  (0.101,
  [
    (try_begin),
      (lt, "$g_resolve_issue_cur_lord", "trp_npc1"),
      (assign, "$g_resolve_issue_cur_lord", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_resolve_issue_cur_lord", "trp_knight_1_1_wife"),
      (assign, "$g_resolve_issue_cur_lord", "trp_npc1"),
    (try_end),
    (assign, ":var0", "$g_resolve_issue_cur_lord"),
    (try_begin),
      (troop_slot_eq, ":var0", 166, 1),
      (troop_slot_eq, ":var0", 2, 2),
      (neq, ":var0", "trp_player"),
      (store_faction_of_troop, ":var1", ":var0"),
      (faction_slot_ge, ":var1", 64, 1),
      (neg|troop_slot_ge, ":var0", 154, 1),
      (this_or_next|troop_slot_eq, ":var0", 154, -1),
      (neq, "$players_kingdom", ":var1"),
      (call_script, "script_npc_decision_checklist_take_stand_on_issue", ":var0"),
      (troop_set_slot, ":var0", 154, reg0),
    (try_end),
    (val_add, "$g_resolve_issue_cur_lord", 1),
  ]),

  (0.024,
  [
    (try_begin),
      (lt, "$g_process_alarms_cur_center", "p_town_1_1"),
      (assign, "$g_process_alarms_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_process_alarms_cur_center", "p_salt_mine"),
      (assign, "$g_process_alarms_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_slot_eq, "$g_process_alarms_cur_center", 55, -1),
      (call_script, "script_process_alarms_new", "$g_process_alarms_cur_center"),
    (else_try),
      (neg|this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (neg|party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_set_slot, "$g_process_alarms_cur_center", 55, -1),
      (party_set_slot, "$g_process_alarms_cur_center", 66, 0),
      (party_set_slot, "$g_process_alarms_cur_center", 67, 0),
    (try_end),
    (val_add, "$g_process_alarms_cur_center", 1),
    (try_begin),
      (this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_slot_eq, "$g_process_alarms_cur_center", 55, -1),
      (call_script, "script_process_alarms_new", "$g_process_alarms_cur_center"),
    (else_try),
      (neg|this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (neg|party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_set_slot, "$g_process_alarms_cur_center", 55, -1),
      (party_set_slot, "$g_process_alarms_cur_center", 66, 0),
      (party_set_slot, "$g_process_alarms_cur_center", 67, 0),
    (try_end),
    (val_add, "$g_process_alarms_cur_center", 1),
    (try_begin),
      (this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_slot_eq, "$g_process_alarms_cur_center", 55, -1),
      (call_script, "script_process_alarms_new", "$g_process_alarms_cur_center"),
    (else_try),
      (neg|this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (neg|party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_set_slot, "$g_process_alarms_cur_center", 55, -1),
      (party_set_slot, "$g_process_alarms_cur_center", 66, 0),
      (party_set_slot, "$g_process_alarms_cur_center", 67, 0),
    (try_end),
    (val_add, "$g_process_alarms_cur_center", 1),
    (try_begin),
      (this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_slot_eq, "$g_process_alarms_cur_center", 55, -1),
      (call_script, "script_process_alarms_new", "$g_process_alarms_cur_center"),
    (else_try),
      (neg|this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (neg|party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_set_slot, "$g_process_alarms_cur_center", 55, -1),
      (party_set_slot, "$g_process_alarms_cur_center", 66, 0),
      (party_set_slot, "$g_process_alarms_cur_center", 67, 0),
    (try_end),
    (val_add, "$g_process_alarms_cur_center", 1),
    (try_begin),
      (this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_slot_eq, "$g_process_alarms_cur_center", 55, -1),
      (call_script, "script_process_alarms_new", "$g_process_alarms_cur_center"),
    (else_try),
      (neg|this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (neg|party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_set_slot, "$g_process_alarms_cur_center", 55, -1),
      (party_set_slot, "$g_process_alarms_cur_center", 66, 0),
      (party_set_slot, "$g_process_alarms_cur_center", 67, 0),
    (try_end),
    (val_add, "$g_process_alarms_cur_center", 1),
    (try_begin),
      (this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_slot_eq, "$g_process_alarms_cur_center", 55, -1),
      (call_script, "script_process_alarms_new", "$g_process_alarms_cur_center"),
    (else_try),
      (neg|this_or_next|party_slot_ge, "$g_process_alarms_cur_center", 54, 0),
      (neg|party_slot_eq, "$g_process_alarms_cur_center", 35, 1),
      (party_set_slot, "$g_process_alarms_cur_center", 55, -1),
      (party_set_slot, "$g_process_alarms_cur_center", 66, 0),
      (party_set_slot, "$g_process_alarms_cur_center", 67, 0),
    (try_end),
    (val_add, "$g_process_alarms_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_9", 6),
  ]),

  (1,
  [
    (call_script, "script_process_kingdom_parties_ai"),
  ]),

  (0.028,
  [
    (try_begin),
      (lt, "$g_process_sieges_new_cur_center", "p_town_1_1"),
      (assign, "$g_process_sieges_new_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_process_sieges_new_cur_center", "p_village_1_1"),
      (assign, "$g_process_sieges_new_cur_center", "p_town_1_1"),
    (try_end),
    (call_script, "script_process_sieges_new", "$g_process_sieges_new_cur_center"),
    (val_add, "$g_process_sieges_new_cur_center", 1),
    (call_script, "script_process_sieges_new", "$g_process_sieges_new_cur_center"),
    (val_add, "$g_process_sieges_new_cur_center", 1),
    (call_script, "script_process_sieges_new", "$g_process_sieges_new_cur_center"),
    (val_add, "$g_process_sieges_new_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_10", 3),
  ]),

  (0.5,
  [
    (try_begin),
      (lt, "$g_recalculate_ais_cur_fac", "fac_player_supporters_faction"),
      (assign, "$g_recalculate_ais_cur_fac", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (ge, "$g_recalculate_ais_cur_fac", "fac_kingdoms_end"),
      (assign, "$g_recalculate_ais_cur_fac", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (is_between, "$g_recalculate_ais_cur_fac", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (try_begin),
        (faction_slot_eq, "$g_recalculate_ais_cur_fac", 21, 0),
        (call_script, "script_recalculate_ais_for_faction", "$g_recalculate_ais_cur_fac"),
      (else_try),
        (assign, ":var0", "fac_kingdoms_end"),
        (assign, ":var1", "$g_recalculate_ais_cur_fac"),
        (try_for_range, ":var2", ":var1", ":var0"),
          (faction_slot_eq, ":var2", 21, 0),
          (assign, "$g_recalculate_ais_cur_fac", ":var2"),
          (call_script, "script_recalculate_ais_for_faction", "$g_recalculate_ais_cur_fac"),
          (assign, ":var0", 0),
        (try_end),
      (try_end),
    (else_try),
      (assign, "$g_recalculate_ais_cur_fac", "fac_player_supporters_faction"),
      (call_script, "script_recalculate_ais_for_faction", "$g_recalculate_ais_cur_fac"),
    (try_end),
    (val_add, "$g_recalculate_ais_cur_fac", 1),
    (val_add, "$g_simple_trigger_fire_count_11", 1),
  ]),

  (0.035,
  [
    (try_begin),
      (lt, "$g_init_ai_calculation_cur_npc", "trp_npc1"),
      (assign, "$g_init_ai_calculation_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_init_ai_calculation_cur_npc", "trp_knight_1_1_wife"),
      (assign, "$g_init_ai_calculation_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_init_ai_calculation_cur_npc", 166, 1),
      (call_script, "script_init_ai_calculation_active_npcs", "$g_init_ai_calculation_cur_npc"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_npc", 1),
    (try_begin),
      (troop_slot_eq, "$g_init_ai_calculation_cur_npc", 166, 1),
      (call_script, "script_init_ai_calculation_active_npcs", "$g_init_ai_calculation_cur_npc"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_npc", 1),
    (try_begin),
      (troop_slot_eq, "$g_init_ai_calculation_cur_npc", 166, 1),
      (call_script, "script_init_ai_calculation_active_npcs", "$g_init_ai_calculation_cur_npc"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_npc", 1),
    (try_begin),
      (troop_slot_eq, "$g_init_ai_calculation_cur_npc", 166, 1),
      (call_script, "script_init_ai_calculation_active_npcs", "$g_init_ai_calculation_cur_npc"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_npc", 1),
    (try_begin),
      (troop_slot_eq, "$g_init_ai_calculation_cur_npc", 166, 1),
      (call_script, "script_init_ai_calculation_active_npcs", "$g_init_ai_calculation_cur_npc"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_npc", 1),
    (val_add, "$g_simple_trigger_fire_count_12", 3),
  ]),

  (0.036,
  [
    (try_begin),
      (lt, "$g_init_ai_calculation_cur_lady", "trp_knight_1_1_wife"),
      (assign, "$g_init_ai_calculation_cur_lady", "trp_knight_1_1_wife"),
    (try_end),
    (try_begin),
      (ge, "$g_init_ai_calculation_cur_lady", "trp_heroes_end"),
      (assign, "$g_init_ai_calculation_cur_lady", "trp_knight_1_1_wife"),
    (try_end),
    (try_begin),
      (call_script, "script_init_ai_calculation_ladies", "$g_init_ai_calculation_cur_lady"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_lady", 1),
    (try_begin),
      (call_script, "script_init_ai_calculation_ladies", "$g_init_ai_calculation_cur_lady"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_lady", 1),
    (try_begin),
      (call_script, "script_init_ai_calculation_ladies", "$g_init_ai_calculation_cur_lady"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_lady", 1),
    (val_add, "$g_simple_trigger_fire_count_13", 3),
  ]),

  (0.032,
  [
    (try_begin),
      (lt, "$g_init_ai_calculation_cur_center", "p_town_1_1"),
      (assign, "$g_init_ai_calculation_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_init_ai_calculation_cur_center", "p_village_1_1"),
      (assign, "$g_init_ai_calculation_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (call_script, "script_party_calculate_strength", "$g_init_ai_calculation_cur_center", 0),
      (call_script, "script_party_calculate_and_set_nearby_friend_enemy_follower_strengths", "$g_init_ai_calculation_cur_center"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_center", 1),
    (try_begin),
      (call_script, "script_party_calculate_strength", "$g_init_ai_calculation_cur_center", 0),
      (call_script, "script_party_calculate_and_set_nearby_friend_enemy_follower_strengths", "$g_init_ai_calculation_cur_center"),
    (try_end),
    (val_add, "$g_init_ai_calculation_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_14", 2),
  ]),

  (5,
  [
    (call_script, "script_party_calculate_strength", "p_main_party", 0),
    (call_script, "script_party_calculate_and_set_nearby_friend_enemy_follower_strengths", "p_main_party"),
  ]),

  (0.33,
  [
    (try_begin),
      (lt, "$g_faction_recalculate_strenght_cur_fac", "fac_player_supporters_faction"),
      (assign, "$g_faction_recalculate_strenght_cur_fac", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (ge, "$g_faction_recalculate_strenght_cur_fac", "fac_kingdoms_end"),
      (assign, "$g_faction_recalculate_strenght_cur_fac", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (faction_slot_eq, "$g_faction_recalculate_strenght_cur_fac", 21, 0),
      (call_script, "script_faction_recalculate_strength", "$g_faction_recalculate_strenght_cur_fac"),
    (try_end),
    (val_add, "$g_faction_recalculate_strenght_cur_fac", 1),
    (val_add, "$g_simple_trigger_fire_count_15", 1),
  ]),

  (24,
  [
    (try_begin),
      (try_for_range, ":var0", "trp_npc1", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var0", 166, 1),
        (store_faction_of_troop, ":var1", ":var0"),
        (neg|faction_slot_eq, ":var1", 4, 0),
        (neg|faction_slot_eq, ":var1", 4, 6),
        (neg|faction_slot_eq, ":var1", 4, 1),
        (troop_get_slot, ":var2", ":var0", 10),
        (party_is_active, ":var2"),
        (val_add, "$total_vassal_days_on_campaign", 1),
        (party_slot_eq, ":var2", 4, 11),
        (val_add, "$total_vassal_days_responding_to_campaign", 1),
      (try_end),
      (val_add, "$g_simple_trigger_fire_count_16", 1),
    (try_end),
  ]),

  (0.05,
  [
    (try_begin),
      (lt, "$g_reset_quest_status_heroes_cur_npc", "trp_npc1"),
      (assign, "$g_reset_quest_status_heroes_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_reset_quest_status_heroes_cur_npc", "trp_knight_1_1_wife"),
      (assign, "$g_reset_quest_status_heroes_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_reset_quest_status_heroes_cur_npc", 166, 1),
      (troop_set_slot, "$g_reset_quest_status_heroes_cur_npc", 20, 0),
    (try_end),
    (val_add, "$g_reset_quest_status_heroes_cur_npc", 1),
    (val_add, "$g_simple_trigger_fire_count_17", 1),
  ]),

  (0.085,
  [
    (try_begin),
      (lt, "$g_reset_quest_status_elders_cur_npc", "trp_village_1_elder"),
      (assign, "$g_reset_quest_status_elders_cur_npc", "trp_village_1_elder"),
    (try_end),
    (try_begin),
      (ge, "$g_reset_quest_status_elders_cur_npc", "trp_merchants_end"),
      (assign, "$g_reset_quest_status_elders_cur_npc", "trp_village_1_elder"),
    (try_end),
    (try_begin),
      (troop_set_slot, "$g_reset_quest_status_elders_cur_npc", 20, 0),
    (try_end),
    (val_add, "$g_reset_quest_status_elders_cur_npc", 1),
    (val_add, "$g_simple_trigger_fire_count_18", 1),
  ]),

  (0.397,
  [
    (try_begin),
      (lt, "$g_refresh_village_inventory_cur_village", "p_village_1_1"),
      (assign, "$g_refresh_village_inventory_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_refresh_village_inventory_cur_village", "p_salt_mine"),
      (assign, "$g_refresh_village_inventory_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (call_script, "script_refresh_village_merchant_inventory", "$g_refresh_village_inventory_cur_village"),
    (try_end),
    (val_add, "$g_refresh_village_inventory_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_19", 1),
  ]),

  (0.113,
  [
    (try_begin),
      (lt, "$g_refresh_village_defenders_cur_village", "p_village_1_1"),
      (assign, "$g_refresh_village_defenders_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_refresh_village_defenders_cur_village", "p_salt_mine"),
      (assign, "$g_refresh_village_defenders_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (call_script, "script_refresh_village_defenders", "$g_refresh_village_defenders_cur_village"),
      (party_set_slot, "$g_refresh_village_defenders_cur_village", 46, 0),
    (try_end),
    (val_add, "$g_refresh_village_defenders_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_20", 1),
  ]),

  (0.229,
  [
    (try_begin),
      (lt, "$g_calculate_center_production_cur_center", "p_town_1_1"),
      (assign, "$g_calculate_center_production_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_calculate_center_production_cur_center", "p_salt_mine"),
      (assign, "$g_calculate_center_production_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (neg|is_between, "$g_calculate_center_production_cur_center", "p_castle_1_1", "p_village_1_1"),
      (party_get_slot, ":var0", "$g_calculate_center_production_cur_center", 205),
      (party_get_slot, ":var1", "$g_calculate_center_production_cur_center", 206),
      (party_get_slot, ":var2", "$g_calculate_center_production_cur_center", 208),
      (val_max, ":var2", 1),
      (store_mul, ":var3", ":var0", 400),
      (store_mul, ":var4", ":var1", 200),
      (val_add, ":var3", ":var4"),
      (val_div, ":var3", ":var2"),
      (store_random_in_range, ":var5", 0, 100),
      (try_begin),
        (eq, ":var5", 0),
        (val_min, ":var0", 10),
        (try_begin),
          (gt, "$g_player_chamberlain", 0),
          (party_slot_eq, "$g_calculate_center_production_cur_center", 7, "trp_player"),
          (party_get_slot, reg4, "$g_calculate_center_production_cur_center", 205),
          (val_sub, reg4, ":var0"),
          (gt, reg4, 0),
          (str_store_party_name_link, s4, "$g_calculate_center_production_cur_center"),
          (display_log_message, "@A livestock epidemic has killed {reg4} cattle in {s4}."),
        (try_end),
      (else_try),
        (gt, ":var3", 100),
        (val_mul, ":var1", 90),
        (val_div, ":var1", 100),
        (val_mul, ":var0", 90),
        (val_div, ":var0", 100),
      (else_try),
        (lt, ":var3", 30),
        (val_mul, ":var0", 120),
        (val_div, ":var0", 100),
        (val_add, ":var0", 1),
        (val_mul, ":var1", 120),
        (val_div, ":var1", 100),
        (val_add, ":var1", 1),
      (else_try),
        (lt, ":var3", 60),
        (val_mul, ":var0", 110),
        (val_div, ":var0", 100),
        (val_add, ":var0", 1),
        (val_mul, ":var1", 110),
        (val_div, ":var1", 100),
        (val_add, ":var1", 1),
      (else_try),
        (lt, ":var3", 100),
        (lt, ":var5", 50),
        (val_mul, ":var0", 105),
        (val_div, ":var0", 100),
        (try_begin),
          (le, ":var0", 20),
          (val_add, ":var0", 1),
        (try_end),
        (val_mul, ":var1", 105),
        (val_div, ":var1", 100),
        (try_begin),
          (le, ":var1", 20),
          (val_add, ":var1", 1),
        (try_end),
      (try_end),
      (party_set_slot, "$g_calculate_center_production_cur_center", 205, ":var0"),
      (party_set_slot, "$g_calculate_center_production_cur_center", 206, ":var1"),
    (try_end),
    (val_add, "$g_calculate_center_production_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_21", 1),
  ]),

  (0.23,
  [
    (try_begin),
      (lt, "$g_accumulate_taxes_cur_center", "p_town_1_1"),
      (assign, "$g_accumulate_taxes_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_accumulate_taxes_cur_center", "p_salt_mine"),
      (assign, "$g_accumulate_taxes_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (try_begin),
        (party_slot_ge, "$g_accumulate_taxes_cur_center", 7, 0),
        (party_get_slot, ":var0", "$g_accumulate_taxes_cur_center", 47),
        (assign, ":var1", 800),
        (try_begin),
          (party_slot_eq, "$g_accumulate_taxes_cur_center", 0, 4),
          (try_begin),
            (party_slot_eq, "$g_accumulate_taxes_cur_center", 35, 0),
            (assign, ":var1", 3000),
          (try_end),
        (else_try),
          (party_slot_eq, "$g_accumulate_taxes_cur_center", 0, 2),
          (assign, ":var1", 6000),
        (else_try),
          (party_slot_eq, "$g_accumulate_taxes_cur_center", 0, 3),
          (assign, ":var1", 10000),
        (try_end),
        (party_get_slot, ":var2", "$g_accumulate_taxes_cur_center", 50),
        (store_add, ":var3", 35, ":var2"),
        (val_mul, ":var1", ":var3"),
        (val_div, ":var1", 135),
        (party_get_slot, ":var4", "$g_accumulate_taxes_cur_center", 287),
        (store_mul, ":var5", ":var1", ":var4"),
        (val_div, ":var5", 100),
        (val_add, ":var0", ":var5"),
        (val_add, ":var0", ":var1"),
        (val_clamp, ":var0", 0, 50000),
        (party_set_slot, "$g_accumulate_taxes_cur_center", 47, ":var0"),
      (try_end),
      (val_add, "$g_accumulate_taxes_cur_center", 1),
      (val_add, "$g_simple_trigger_fire_count_22", 1),
    (try_end),
  ]),

  (32,
  [
    (eq, "$players_kingdom", 0),
    (le, "$g_invite_faction", 0),
    (eq, "$g_player_is_captive", 0),
    (troop_get_type, ":var0", "trp_player"),
    (try_begin),
      (eq, ":var0", 1),
      (eq, "$npc_with_sisterly_advice", 0),
      (try_for_range, ":var1", "trp_npc1", "trp_kingdom_1_lord"),
        (main_party_has_troop, ":var1"),
        (troop_get_type, ":var2", ":var1"),
        (eq, ":var2", 1),
        (troop_slot_ge, "trp_player", 7, 150),
        (troop_slot_ge, ":var1", 139, 1),
        (assign, "$npc_with_sisterly_advice", ":var1"),
      (try_end),
    (else_try),
      (store_random_in_range, ":var3", "fac_kingdom_1", "fac_kingdoms_end"),
      (assign, ":var4", 999999),
      (try_for_range, ":var5", "p_town_1_1", "p_village_1_1"),
        (store_faction_of_party, ":var6", ":var5"),
        (eq, ":var6", ":var3"),
        (store_distance_to_party_from_party, ":var7", "p_main_party", ":var5"),
        (val_min, ":var4", ":var7"),
      (try_end),
      (lt, ":var4", 30),
      (store_relation, ":var8", ":var3", "fac_player_supporters_faction"),
      (faction_get_slot, ":var9", ":var3", 11),
      (call_script, "script_troop_get_player_relation", ":var9"),
      (assign, ":var10", reg0),
      (call_script, "script_get_number_of_hero_centers", "trp_player"),
      (assign, ":var11", reg0),
      (eq, "$g_infinite_camping", 0),
      (assign, ":var12", 0),
      (try_begin),
        (ge, "p_main_party", 0),
        (store_party_size_wo_prisoners, ":var12", "p_main_party"),
      (try_end),
      (try_begin),
        (eq, ":var11", 0),
        (troop_get_slot, ":var13", "trp_player", 7),
        (ge, ":var13", 160),
        (ge, ":var8", 0),
        (ge, ":var10", 0),
        (ge, ":var12", 45),
        (store_random_in_range, ":var14", 0, 100),
        (lt, ":var14", 50),
        (call_script, "script_get_poorest_village_of_faction", ":var3"),
        (assign, "$g_invite_offered_center", reg0),
        (ge, "$g_invite_offered_center", 0),
        (assign, "$g_invite_faction", ":var3"),
        (jump_to_menu, "mnu_invite_player_to_faction"),
      (else_try),
        (gt, ":var11", 0),
        (neq, "$players_oath_renounced_against_kingdom", ":var3"),
        (ge, ":var8", -40),
        (ge, ":var10", -20),
        (ge, ":var12", 30),
        (store_random_in_range, ":var14", 0, 100),
        (lt, ":var14", 20),
        (assign, "$g_invite_faction", ":var3"),
        (assign, "$g_invite_offered_center", -1),
        (jump_to_menu, "mnu_invite_player_to_faction_without_center"),
      (try_end),
    (try_end),
  ]),

  (2.3,
  [
    (try_begin),
      (lt, "$g_recalculate_random_decision_seed_cur_faction", "fac_player_supporters_faction"),
      (assign, "$g_recalculate_random_decision_seed_cur_faction", "fac_player_supporters_faction"),
    (try_end),
    (try_begin),
      (ge, "$g_recalculate_random_decision_seed_cur_faction", "fac_kingdoms_end"),
      (assign, "$g_recalculate_random_decision_seed_cur_faction", "fac_player_supporters_faction"),
    (try_end),
    (assign, ":var0", 0),
    (try_begin),
      (faction_slot_eq, "$g_recalculate_random_decision_seed_cur_faction", 21, 0),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 21, 0),
        (neq, ":var1", "$g_recalculate_random_decision_seed_cur_faction"),
        (store_relation, ":var2", "$g_recalculate_random_decision_seed_cur_faction", ":var1"),
        (lt, ":var2", 0),
        (val_add, ":var0", 1),
      (try_end),
      (try_for_range, ":var3", "trp_npc1", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var3", 166, 1),
        (store_faction_of_troop, ":var4", ":var3"),
        (eq, ":var4", "$g_recalculate_random_decision_seed_cur_faction"),
        (try_begin),
          (eq, ":var0", 2),
          (store_random_in_range, ":var5", 3000, 9999),
        (else_try),
          (gt, ":var0", 3),
          (store_random_in_range, ":var5", 7000, 9999),
        (else_try),
          (store_random_in_range, ":var5", 0, 9999),
        (try_end),
        (troop_set_slot, ":var3", 49, ":var5"),
      (try_end),
    (try_end),
    (val_add, "$g_recalculate_random_decision_seed_cur_faction", 1),
    (val_add, "$g_simple_trigger_fire_count_23", 1),
  ]),

  (0.3,
  [
    (try_for_range, ":var0", "trp_npc1", "trp_heroes_end"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (ge, ":var1", 1),
      (party_is_active, ":var1"),
      (party_get_attached_to, ":var2", ":var1"),
      (lt, ":var2", 1),
      (party_get_cur_town, ":var3", ":var1"),
      (is_between, ":var3", "p_town_1_1", "p_salt_mine"),
      (call_script, "script_get_relation_between_parties", ":var3", ":var1"),
      (try_begin),
        (ge, reg0, 0),
        (party_attach_to_party, ":var1", ":var3"),
      (else_try),
        (party_set_ai_behavior, ":var1", ai_bhvr_hold),
      (try_end),
      (try_begin),
        (this_or_next|party_slot_eq, ":var3", 0, 3),
        (party_slot_eq, ":var3", 0, 2),
        (store_faction_of_party, ":var4", ":var1"),
        (store_faction_of_party, ":var5", ":var3"),
        (eq, ":var4", ":var5"),
        (party_get_num_prisoner_stacks, ":var6", ":var1"),
        (gt, ":var6", 0),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_prisoners_add_party_prisoners", ":var3", ":var1"),
        (assign, "$g_move_heroes", 1),
        (call_script, "script_party_remove_all_prisoners", ":var1"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (call_script, "script_get_max_skill_of_player_party", "skl_spotting"),
    (store_add, ":var0", reg0, 3),
    (val_div, ":var0", 2),
    (try_for_parties, ":var1"),
      (gt, ":var1", "p_spawn_points_end"),
      (party_get_template_id, ":var2", ":var1"),
      (ge, ":var2", "pt_steppe_bandit_lair"),
      (store_distance_to_party_from_party, ":var3", "p_main_party", ":var1"),
      (val_add, ":var0", 2),
      (lt, ":var3", ":var0"),
      (party_set_flags, ":var1", pf_disabled, 0),
      (party_set_flags, ":var1", pf_always_visible, 1),
    (try_end),
  ]),

  (10,
  [
    (assign, ":var0", "trp_player"),
    (store_skill_level, ":var1", "skl_prisoner_management", ":var0"),
    (assign, ":var2", 30),
    (val_mul, ":var1", 2),
    (val_sub, ":var2", ":var1"),
    (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", "p_main_party", ":var2"),
    (try_for_range, ":var3", "trp_player_camp_chest_1", "trp_player_camp_chest_end"),
      (troop_get_slot, ":var4", ":var3", 60),
      (gt, ":var4", 0),
      (party_is_active, ":var4"),
      (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", ":var4", 40),
    (try_end),
  ]),

  (0.154,
  [
    (try_begin),
      (lt, "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", "p_town_1_1"),
      (assign, "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", "p_village_1_1"),
      (assign, "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (assign, ":var0", 30),
      (try_begin),
        (party_slot_eq, "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", 135, 1),
        (assign, ":var0", 5),
      (try_end),
      (call_script, "script_randomly_make_prisoner_heroes_escape_from_party", "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", ":var0"),
    (try_end),
    (val_add, "$g_randomly_make_prisoner_heroes_escape_from_party_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_24", 1),
  ]),

  (0.101,
  [
    (try_begin),
      (lt, "$g_respawn_party_after_release_cur_npc", "trp_npc1"),
      (assign, "$g_respawn_party_after_release_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_respawn_party_after_release_cur_npc", "trp_knight_1_1_wife"),
      (assign, "$g_respawn_party_after_release_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_respawn_party_after_release_cur_npc", 166, 1),
      (troop_slot_eq, "$g_respawn_party_after_release_cur_npc", 2, 2),
      (neg|troop_slot_ge, "$g_respawn_party_after_release_cur_npc", 8, 0),
      (neg|troop_slot_ge, "$g_respawn_party_after_release_cur_npc", 10, 1),
      (store_faction_of_troop, ":var0", "$g_respawn_party_after_release_cur_npc"),
      (try_begin),
        (eq, ":var0", "fac_outlaws"),
      (else_try),
        (try_begin),
          (eq, "$cheat_mode", 2),
          (str_store_troop_name, s4, "$g_respawn_party_after_release_cur_npc"),
          (display_message, "str_debug__attempting_to_spawn_s4"),
        (try_end),
        (call_script, "script_cf_select_random_walled_center_with_faction_and_owner_priority_no_siege", ":var0", "$g_respawn_party_after_release_cur_npc"),
        (assign, ":var1", reg0),
        (try_begin),
          (eq, "$cheat_mode", 2),
          (assign, reg7, ":var1"),
          (str_store_party_name, s7, ":var1"),
          (display_message, "str_debug__s0_is_spawning_around_party__s7"),
        (try_end),
        (call_script, "script_create_kingdom_hero_party", "$g_respawn_party_after_release_cur_npc", ":var1"),
        (try_begin),
          (eq, "$g_there_is_no_avaliable_centers", 0),
          (party_attach_to_party, "$pout_party", ":var1"),
        (try_end),
        (troop_get_slot, ":var2", "$g_respawn_party_after_release_cur_npc", 10),
        (call_script, "script_party_set_ai_state", ":var2", 7, ":var1"),
      (else_try),
        (neg|faction_slot_eq, ":var0", 21, 0),
        (try_begin),
          (is_between, "$g_respawn_party_after_release_cur_npc", "trp_kingdom_1_lord", "trp_knight_1_1"),
          (troop_set_slot, "$g_respawn_party_after_release_cur_npc", 55, "fac_commoners"),
        (else_try),
          (store_random_in_range, ":var3", 0, 100),
          (lt, ":var3", 10),
          (call_script, "script_cf_get_random_active_faction_except_player_faction_and_faction", ":var0"),
          (troop_set_slot, "$g_respawn_party_after_release_cur_npc", 55, reg0),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_respawn_party_after_release_cur_npc", 1),
    (val_add, "$g_simple_trigger_fire_count_25", 1),
  ]),

  (0.17,
  [
    (try_begin),
      (lt, "$g_village_center_trade_cur_village", "p_village_1_1"),
      (assign, "$g_village_center_trade_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_village_center_trade_cur_village", "p_salt_mine"),
      (assign, "$g_village_center_trade_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (party_slot_eq, "$g_village_center_trade_cur_village", 35, 0),
      (party_get_slot, ":var0", "$g_village_center_trade_cur_village", 121),
      (party_slot_eq, ":var0", 54, -1),
      (call_script, "script_do_villager_center_trade", "$g_village_center_trade_cur_village", ":var0"),
      (assign, ":var1", reg0),
      (call_script, "script_do_villager_center_trade", ":var0", "$g_village_center_trade_cur_village"),
      (party_get_slot, ":var2", ":var0", 48),
      (party_get_slot, ":var3", ":var0", 50),
      (assign, ":var4", ":var1"),
      (val_mul, ":var4", ":var3"),
      (val_div, ":var4", 100),
      (val_div, ":var4", 20),
      (val_add, ":var2", ":var4"),
      (party_set_slot, ":var0", 48, ":var2"),
      (party_get_slot, ":var5", ":var0", 53),
      (call_script, "script_center_get_food_store_limit", ":var0"),
      (assign, ":var6", reg0),
      (val_add, ":var5", 3000),
      (val_min, ":var5", ":var6"),
      (party_set_slot, ":var0", 53, ":var5"),
    (try_end),
    (val_add, "$g_village_center_trade_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_26", 1),
  ]),

  (72,
  [
    (call_script, "script_update_trade_good_prices"),
    (try_for_range, ":var0", "p_town_1_1", "p_salt_mine"),
      (party_get_slot, ":var1", ":var0", 51),
      (try_begin),
        (gt, ":var1", 1000),
        (val_mul, ":var1", 95),
        (val_div, ":var1", 100),
        (val_max, ":var1", 1000),
      (else_try),
        (lt, ":var1", 1000),
        (val_mul, ":var1", 105),
        (val_div, ":var1", 100),
        (val_min, ":var1", 1000),
      (try_end),
      (party_set_slot, ":var0", 51, ":var1"),
    (try_end),
  ]),

  (8,
  [
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 11),
      (party_is_in_any_town, ":var0"),
      (store_faction_of_party, ":var1", ":var0"),
      (faction_get_slot, ":var2", ":var1", 82),
      (try_begin),
        (le, ":var2", 0),
        (remove_party, ":var0"),
        (faction_get_slot, ":var3", ":var1", 503),
        (val_sub, ":var3", 1),
        (faction_set_slot, ":var1", 503, ":var3"),
      (else_try),
        (party_get_cur_town, ":var4", ":var0"),
        (store_random_in_range, ":var5", 0, 100),
        (try_begin),
          (party_slot_eq, ":var4", 7, "trp_player"),
        (else_try),
          (assign, ":var6", 45),
        (try_end),
        (lt, ":var5", ":var6"),
        (assign, ":var7", 1),
        (try_begin),
          (is_between, ":var4", "p_town_1_1", "p_village_1_1"),
          (neg|party_slot_eq, ":var4", 54, -1),
          (assign, ":var7", 0),
        (try_end),
        (eq, ":var7", 1),
        (assign, ":var8", 0),
        (try_begin),
          (party_get_slot, ":var9", ":var0", 4),
          (eq, ":var9", 13),
          (party_get_slot, ":var10", ":var0", 5),
          (eq, ":var4", ":var10"),
          (assign, ":var8", 1),
        (try_end),
        (assign, ":var11", -1),
        (try_begin),
          (eq, "$caravan_escort_party_id", ":var0"),
          (neg|party_is_in_town, ":var0", "$caravan_escort_destination_town"),
          (assign, ":var11", "$caravan_escort_destination_town"),
        (else_try),
          (call_script, "script_cf_select_most_profitable_town_at_peace_with_faction_in_trade_route", ":var4", ":var1"),
          (assign, ":var11", reg0),
        (try_end),
        (is_between, ":var11", "p_town_1_1", "p_castle_1_1"),
        (neg|party_is_in_town, ":var0", ":var11"),
        (try_begin),
          (eq, ":var8", 1),
          (str_store_party_name, s7, ":var4"),
          (call_script, "script_do_merchant_town_trade", ":var0", ":var4"),
          (call_script, "script_refresh_travelling_merchant_inventory", ":var0"),
        (try_end),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var11"),
        (party_set_flags, ":var0", pf_default_behavior, 0),
        (party_set_slot, ":var0", 4, 13),
        (party_set_slot, ":var0", 5, ":var11"),
      (try_end),
    (try_end),
  ]),

  (8,
  [
    (eq, 0, 1),
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 15),
      (party_is_in_any_town, ":var0"),
      (party_get_slot, ":var1", ":var0", 123),
      (party_get_cur_town, ":var2", ":var0"),
      (assign, ":var3", 1),
      (try_begin),
        (is_between, ":var2", "p_town_1_1", "p_village_1_1"),
        (neg|party_slot_eq, ":var2", 54, -1),
        (assign, ":var3", 0),
      (try_end),
      (eq, ":var3", 1),
      (try_begin),
        (eq, ":var2", ":var1"),
        (call_script, "script_do_party_center_trade", ":var0", ":var1", 25),
        (store_faction_of_party, ":var4", ":var2"),
        (party_set_faction, ":var0", ":var4"),
        (party_get_slot, ":var5", ":var1", 121),
        (party_set_slot, ":var0", 5, ":var5"),
        (party_set_slot, ":var0", 4, 13),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var5"),
      (else_try),
        (try_begin),
          (party_get_slot, ":var6", ":var0", 5),
          (eq, ":var2", ":var6"),
          (call_script, "script_do_party_center_trade", ":var0", ":var6", 25),
          (assign, ":var7", reg0),
          (party_get_slot, ":var8", ":var6", 48),
          (party_get_slot, ":var9", ":var6", 50),
          (assign, ":var10", ":var7"),
          (val_mul, ":var10", ":var9"),
          (val_div, ":var10", 100),
          (val_div, ":var10", 20),
          (val_add, ":var8", ":var10"),
          (try_begin),
            (ge, "$cheat_mode", 3),
            (assign, reg4, ":var10"),
            (str_store_party_name, s4, ":var6"),
            (assign, reg5, ":var8"),
            (display_message, "@{!}New tariffs at {s4} = {reg4}, total = {reg5}"),
          (try_end),
          (party_set_slot, ":var6", 48, ":var8"),
          (party_get_slot, ":var11", ":var6", 53),
          (call_script, "script_center_get_food_store_limit", ":var6"),
          (assign, ":var12", reg0),
          (val_add, ":var11", 1000),
          (val_min, ":var11", ":var12"),
          (party_set_slot, ":var6", 53, ":var11"),
          (try_begin),
            (store_random_in_range, ":var13", 0, 100),
            (lt, ":var13", 35),
            (call_script, "script_change_center_prosperity", ":var1", 1),
            (val_add, "$newglob_total_prosperity_from_village_trade", 1),
          (try_end),
        (try_end),
        (party_set_slot, ":var0", 5, ":var1"),
        (party_set_slot, ":var0", 4, 13),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var1"),
      (try_end),
    (try_end),
  ]),

  (0.06,
  [
    (try_begin),
      (lt, "$g_increase_castle_food_stores_cur_castle", "p_castle_1_1"),
      (assign, "$g_increase_castle_food_stores_cur_castle", "p_castle_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_increase_castle_food_stores_cur_castle", "p_village_1_1"),
      (assign, "$g_increase_castle_food_stores_cur_castle", "p_castle_1_1"),
    (try_end),
    (try_begin),
      (party_slot_eq, "$g_increase_castle_food_stores_cur_castle", 54, -1),
      (party_get_slot, ":var0", "$g_increase_castle_food_stores_cur_castle", 53),
      (val_add, ":var0", 100),
      (call_script, "script_center_get_food_store_limit", "$g_increase_castle_food_stores_cur_castle"),
      (assign, ":var1", reg0),
      (val_min, ":var0", ":var1"),
      (party_set_slot, "$g_increase_castle_food_stores_cur_castle", 53, ":var0"),
    (try_end),
    (val_add, "$g_increase_castle_food_stores_cur_castle", 1),
    (val_add, "$g_simple_trigger_fire_count_28", 1),
  ]),

  (0.5,
  [
    (try_for_range, ":var0", "trp_npc1", "trp_heroes_end"),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (gt, ":var1", 0),
      (try_begin),
        (party_is_active, ":var1"),
        (try_begin),
          (get_party_ai_current_behavior, ":var2", ":var1"),
          (eq, ":var2", 5),
          (assign, ":var3", 1),
          (try_begin),
            (this_or_next|troop_slot_eq, ":var0", 52, 7),
            (troop_slot_eq, ":var0", 52, 1),
            (get_party_ai_current_object, ":var4", ":var1"),
            (party_is_active, ":var4"),
            (party_get_battle_opponent, ":var5", ":var4"),
            (party_is_active, ":var5"),
            (assign, ":var3", 0),
          (try_end),
          (eq, ":var3", 1),
          (store_faction_of_party, ":var6", ":var1"),
          (party_get_slot, ":var7", ":var1", 30),
          (faction_get_slot, ":var8", ":var6", 8),
          (neq, ":var8", ":var0"),
          (assign, ":var3", 1),
          (try_begin),
            (ge, ":var8", 0),
            (troop_get_slot, ":var9", ":var8", 10),
            (party_is_active, ":var9", 0),
            (eq, ":var7", ":var9"),
            (assign, ":var3", 0),
          (try_end),
          (eq, ":var3", 1),
          (assign, ":var10", 0),
          (try_for_range, ":var11", "p_town_1_1", "p_village_1_1"),
            (eq, ":var10", 0),
            (party_slot_eq, ":var11", 54, -1),
            (store_faction_of_party, ":var12", ":var11"),
            (store_relation, ":var13", ":var12", ":var6"),
            (gt, ":var13", 0),
            (store_distance_to_party_from_party, ":var14", ":var1", ":var11"),
            (lt, ":var14", 20),
            (party_get_position, pos1, ":var1"),
            (party_get_position, pos2, ":var11"),
            (neg|position_is_behind_position, pos2, pos1),
            (call_script, "script_party_set_ai_state", ":var1", 14, ":var11"),
            (assign, ":var10", 1),
          (try_end),
        (try_end),
      (else_try),
        (troop_set_slot, ":var0", 10, -1),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (store_current_hours, ":var0"),
    (store_mod, ":var1", ":var0", 11),
    (store_sub, ":var2", ":var0", 5),
    (party_get_num_companions, ":var3", "p_main_party"),
    (party_get_num_prisoners, ":var4", "p_main_party"),
    (val_add, ":var3", ":var4"),
    (convert_to_fixed_point, ":var3"),
    (store_sqrt, ":var5", ":var3"),
    (convert_from_fixed_point, ":var5"),
    (try_begin),
      (eq, ":var1", 0),
      (try_for_range, ":var6", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_get_slot, ":var7", ":var6", 30),
        (val_sub, ":var7", 1),
        (val_max, ":var7", 0),
        (faction_set_slot, ":var6", 30, ":var7"),
      (try_end),
    (try_end),
    (eq, "$g_player_is_captive", 0),
    (try_for_range, ":var8", "p_town_1_1", "p_salt_mine"),
      (store_faction_of_party, ":var6", ":var8"),
      (store_relation, ":var9", ":var6", "fac_player_supporters_faction"),
      (lt, ":var9", 0),
      (store_distance_to_party_from_party, ":var10", "p_main_party", ":var8"),
      (lt, ":var10", 5),
      (store_mul, ":var11", ":var10", ":var10"),
      (store_sub, ":var12", 20, ":var11"),
      (store_sub, ":var13", 20, ":var9"),
      (store_mul, ":var14", ":var12", ":var13"),
      (val_mul, ":var14", ":var5"),
      (store_div, ":var15", ":var14", 10),
      (store_random_in_range, ":var16", 0, 1000),
      (lt, ":var16", ":var15"),
      (faction_get_slot, ":var7", ":var6", 30),
      (val_add, ":var7", 1),
      (val_min, ":var7", 100),
      (faction_set_slot, ":var6", 30, ":var7"),
      (try_begin),
        (neg|party_slot_ge, ":var8", 42, ":var2"),
        (str_store_party_name_link, s1, ":var8"),
        (display_message, "@Your party is spotted by {s1}."),
        (party_set_slot, ":var8", 42, ":var0"),
      (try_end),
    (try_end),
  ]),

  (12,
  [
    (eq, "$g_player_is_captive", 0),
    (party_get_num_companion_stacks, ":var0", "p_main_party"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 0, ":var0"),
      (party_stack_get_size, ":var3", "p_main_party", ":var2"),
      (val_add, ":var1", ":var3"),
    (try_end),
    (val_div, ":var1", 3),
    (try_begin),
      (eq, ":var1", 0),
      (val_add, ":var1", 1),
    (try_end),
    (call_script, "script_forage_for_food"),
    (try_begin),
      (ge, reg4, ":var1"),
      (assign, ":var1", 1),
    (else_try),
      (val_sub, ":var1", reg4),
    (try_end),
    (assign, ":var4", ":var1"),
    (assign, ":var5", 0),
    (try_begin),
      (eq, "$g_town_visit_after_rest", 1),
      (val_div, ":var4", 2),
    (try_end),
    (try_begin),
      (eq, ":var4", 0),
      (assign, ":var4", 1),
    (try_end),
    (try_for_range, ":var6", 0, ":var4"),
      (assign, ":var7", 0),
      (try_for_range, ":var8", "itm_smoked_fish", "itm_siege_supply"),
        (item_set_slot, ":var8", 0, 0),
        (call_script, "script_cf_player_has_item_without_modifier", ":var8", 41),
        (val_add, ":var7", 1),
      (try_end),
      (try_begin),
        (gt, ":var7", 0),
        (store_random_in_range, ":var9", 0, ":var7"),
        (call_script, "script_consume_food", ":var9"),
      (else_try),
        (eq, ":var5", 0),
        (display_message, "@Party has nothing to eat!", 0xFF0000),
        (call_script, "script_change_player_party_morale", -3),
        (assign, ":var5", 1),
        (try_begin),
          (call_script, "script_party_count_fit_regulars", "p_main_party"),
          (gt, reg0, 0),
          (call_script, "script_objectionable_action", 2, "str_men_hungry"),
        (try_end),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$g_town_visit_after_rest", 1),
      (gt, ":var4", 1),
      (display_message, "@Party is stationed and therefore consumes half the food required.", 0x3399FF),
    (try_end),
    (call_script, "script_food_consumption_display_message", ":var4"),
    (call_script, "script_get_player_party_morale_values"),
    (assign, ":var10", reg1),
    (party_get_morale, ":var11", "p_main_party"),
    (store_sub, ":var12", ":var10", ":var11"),
    (store_skill_level, ":var13", "skl_leadership", "trp_player"),
    (try_begin),
      (gt, ":var12", 0),
      (store_add, ":var14", 20, ":var13"),
    (else_try),
      (store_sub, ":var14", 20, ":var13"),
    (try_end),
    (store_mul, ":var15", ":var12", ":var14"),
    (val_div, ":var15", 100),
    (store_mul, ":var16", ":var15", 100),
    (val_div, ":var16", ":var14"),
    (try_begin),
      (neq, ":var16", ":var12"),
      (try_begin),
        (gt, ":var12", 0),
        (val_add, ":var15", 1),
      (else_try),
        (val_sub, ":var15", 1),
      (try_end),
    (try_end),
    (val_add, ":var11", ":var15"),
    (val_clamp, ":var11", 0, 100),
    (party_set_morale, "p_main_party", ":var11"),
    (assign, reg1, ":var11"),
  ]),

  (24,
  [
    (troop_get_inventory_capacity, ":var0", "trp_player"),
    (try_for_range, ":var1", 0, ":var0"),
      (troop_get_inventory_slot, ":var2", "trp_player", ":var1"),
      (this_or_next|eq, ":var2", "itm_cattle_meat"),
      (this_or_next|eq, ":var2", "itm_chicken"),
      (eq, ":var2", "itm_pork"),
      (troop_get_inventory_slot_modifier, ":var3", "trp_player", ":var1"),
      (try_begin),
        (ge, ":var3", 37),
        (lt, ":var3", 41),
        (val_add, ":var3", 1),
        (troop_set_inventory_slot_modifier, "trp_player", ":var1", ":var3"),
      (else_try),
        (lt, ":var3", 37),
        (troop_set_inventory_slot_modifier, "trp_player", ":var1", 37),
      (try_end),
    (try_end),
  ]),

  (0.2,
  [
    (troop_get_inventory_slot, ":var0", "trp_player", ek_horse),
    (assign, ":var1", -1),
    (try_begin),
      (eq, "$g_player_icon_state", 0),
      (try_begin),
        (ge, ":var0", 0),
        (assign, ":var1", "icon_player_horseman"),
      (else_try),
        (assign, ":var1", "icon_player"),
      (try_end),
    (else_try),
      (eq, "$g_player_icon_state", 1),
      (assign, ":var1", "icon_camp"),
    (else_try),
      (eq, "$g_player_icon_state", 2),
      (assign, ":var1", "icon_ship"),
    (try_end),
    (try_begin),
      (call_script, "script_cf_is_party_on_water", "p_main_party"),
      (assign, ":var1", "icon_longship"),
    (try_end),
    (neq, ":var1", "$g_player_party_icon"),
    (assign, "$g_player_party_icon", ":var1"),
    (party_set_icon, "p_main_party", ":var1"),
  ]),

  (4,
  [
    (store_troop_gold, ":var0", "trp_player"),
    (store_div, ":var1", ":var0", 100),
    (troop_get_inventory_capacity, ":var2", "trp_player"),
    (try_for_range, ":var3", 0, ":var2"),
      (troop_get_inventory_slot, ":var4", "trp_player", ":var3"),
      (ge, ":var4", 0),
      (try_begin),
        (is_between, ":var4", "itm_spice", "itm_siege_supply"),
        (store_item_value, ":var5", ":var4"),
        (val_add, ":var0", ":var5"),
      (try_end),
    (try_end),
    (val_clamp, ":var1", 0, 100),
    (party_set_bandit_attraction, "p_main_party", ":var1"),
  ]),

  (3,
  [
    (faction_slot_eq, "fac_player_supporters_faction", 21, 2),
    (try_for_range, ":var0", "p_town_1_1", "p_village_1_1"),
      (store_faction_of_party, ":var1", ":var0"),
      (eq, ":var1", "fac_player_supporters_faction"),
      (call_script, "script_activate_player_faction", "trp_player"),
    (try_end),
  ]),

  (6,
  [
    (gt, "$g_prisoner_recruit_troop_id", 0),
    (gt, "$g_prisoner_recruit_size", 0),
    (gt, "$g_prisoner_recruit_last_time", 0),
    (is_currently_night),
    (try_begin),
      (store_skill_level, ":var0", "skl_leadership", "trp_player"),
      (val_mul, ":var0", 5),
      (store_sub, ":var1", 66, ":var0"),
      (gt, ":var1", 0),
      (assign, ":var2", 0),
      (try_for_range, ":var3", 0, "$g_prisoner_recruit_size"),
        (store_random_in_range, ":var4", 0, 100),
        (lt, ":var4", ":var1"),
        (val_add, ":var2", 1),
      (try_end),
      (party_remove_members, "p_main_party", "$g_prisoner_recruit_troop_id", ":var2"),
      (assign, ":var2", reg0),
      (gt, ":var2", 0),
      (try_begin),
        (gt, ":var2", 1),
        (assign, reg2, 1),
      (else_try),
        (assign, reg2, 0),
      (try_end),
      (assign, reg1, ":var2"),
      (str_store_troop_name_by_count, s1, "$g_prisoner_recruit_troop_id", ":var2"),
      (display_log_message, "@{reg1} {s1} {reg2?have:has} escaped from your party during the night."),
    (try_end),
    (assign, "$g_prisoner_recruit_troop_id", 0),
    (assign, "$g_prisoner_recruit_size", 0),
  ]),

  (24,
  [
    (neq, "$g_ransom_offer_rejected", 1),
    (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", "p_main_party"),
    (eq, reg0, 0),
    (assign, ":var0", "p_village_1_1"),
    (try_for_range, ":var1", "p_town_1_1", ":var0"),
      (party_slot_eq, ":var1", 7, "trp_player"),
      (call_script, "script_offer_ransom_amount_to_player_for_prisoners_in_party", ":var1"),
      (eq, reg0, 1),
      (assign, ":var0", 0),
    (try_end),
  ]),

  (0.23,
  [
    (try_begin),
      (lt, "$g_exchange_prisoners_cur_center", "p_town_1_1"),
      (assign, "$g_exchange_prisoners_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_exchange_prisoners_cur_center", "p_village_1_1"),
      (assign, "$g_exchange_prisoners_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (party_get_slot, ":var0", "$g_exchange_prisoners_cur_center", 7),
      (gt, ":var0", 0),
      (party_get_num_prisoner_stacks, ":var1", "$g_exchange_prisoners_cur_center"),
      (try_for_range_backwards, ":var2", 0, ":var1"),
        (party_prisoner_stack_get_troop_id, ":var3", "$g_exchange_prisoners_cur_center", ":var2"),
        (troop_is_hero, ":var3"),
        (troop_slot_eq, ":var3", 2, 2),
        (store_random_in_range, ":var4", 0, 100),
        (try_begin),
          (le, ":var4", 10),
          (call_script, "script_calculate_ransom_amount_for_troop", ":var3"),
          (assign, ":var5", reg0),
          (troop_get_slot, ":var6", ":var0", 11),
          (val_add, ":var6", ":var5"),
          (troop_set_slot, ":var0", 11, ":var6"),
          (party_remove_prisoners, "$g_exchange_prisoners_cur_center", ":var3", 1),
          (call_script, "script_remove_troop_from_prison", ":var3"),
          (store_faction_of_troop, ":var7", ":var0"),
          (store_faction_of_troop, ":var8", ":var3"),
          (str_store_troop_name, s1, ":var3"),
          (str_store_faction_name, s2, ":var7"),
          (str_store_faction_name, s3, ":var8"),
          (store_relation, ":var9", ":var8", "$players_kingdom"),
          (try_begin),
            (this_or_next|lt, ":var9", 0),
            (eq, ":var8", "$players_kingdom"),
            (display_log_message, "@{s1} of {s3} has been released from captivity."),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_exchange_prisoners_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_29", 1),
  ]),

  (72,
  [
    (assign, "$g_ransom_offer_rejected", 0),
  ]),

  (72,
  [
    (call_script, "script_update_ransom_brokers"),
    (call_script, "script_update_tavern_travellers"),
    (call_script, "script_update_tavern_minstrels"),
    (call_script, "script_update_booksellers"),
    (call_script, "script_update_manor_infested_by_bandits"),
  ]),

  (0.17,
  [
    (try_begin),
      (lt, "$g_update_villages_cur_village", "p_village_1_1"),
      (assign, "$g_update_villages_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_update_villages_cur_village", "p_salt_mine"),
      (assign, "$g_update_villages_cur_village", "p_village_1_1"),
    (try_end),
    (call_script, "script_update_villages_infested_by_bandits", "$g_update_villages_cur_village"),
    (try_begin),
      (eq, "$use_feudal_lance", 0),
      (call_script, "script_update_volunteer_troops_in_village", "$g_update_villages_cur_village"),
      (call_script, "script_update_npc_volunteer_troops_in_village", "$g_update_villages_cur_village"),
    (try_end),
    (val_add, "$g_update_villages_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_30", 1),
  ]),

  (0.36,
  [
    (try_begin),
      (eq, "$use_feudal_lance", 0),
      (try_begin),
        (lt, "$g_update_villages_cur_castle", "p_castle_1_1"),
        (assign, "$g_update_villages_cur_castle", "p_castle_1_1"),
      (try_end),
      (try_begin),
        (ge, "$g_update_villages_cur_castle", "p_village_1_1"),
        (assign, "$g_update_villages_cur_castle", "p_castle_1_1"),
      (try_end),
      (try_begin),
        (call_script, "script_update_volunteer_troops_in_village", "$g_update_villages_cur_castle"),
        (call_script, "script_update_npc_volunteer_troops_in_village", "$g_update_villages_cur_castle"),
      (try_end),
      (val_add, "$g_update_villages_cur_castle", 1),
      (val_add, "$g_simple_trigger_fire_count_31", 1),
    (try_end),
  ]),

  (48,
  [
    (call_script, "script_update_other_taverngoers"),
  ]),

  (0.098,
  [
    (try_begin),
      (lt, "$g_set_random_walker_types_cur_center", "p_town_1_1"),
      (assign, "$g_set_random_walker_types_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_set_random_walker_types_cur_center", "p_salt_mine"),
      (assign, "$g_set_random_walker_types_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (this_or_next|party_slot_eq, "$g_set_random_walker_types_cur_center", 0, 3),
      (party_slot_eq, "$g_set_random_walker_types_cur_center", 0, 4),
      (call_script, "script_center_remove_walker_type_from_walkers", "$g_set_random_walker_types_cur_center", 1),
      (call_script, "script_center_remove_walker_type_from_walkers", "$g_set_random_walker_types_cur_center", 2),
      (store_random_in_range, ":var0", 0, 100),
      (try_begin),
        (lt, ":var0", 70),
        (neg|party_slot_ge, "$g_set_random_walker_types_cur_center", 50, 60),
        (call_script, "script_cf_center_get_free_walker", "$g_set_random_walker_types_cur_center"),
        (call_script, "script_center_set_walker_to_type", "$g_set_random_walker_types_cur_center", reg0, 1),
      (try_end),
    (try_end),
    (val_add, "$g_set_random_walker_types_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_32", 1),
  ]),

  (0.032,
  [
    (try_begin),
      (lt, "$g_check_center_improvements_cur_center", "p_town_1_1"),
      (assign, "$g_check_center_improvements_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_check_center_improvements_cur_center", "p_salt_mine"),
      (assign, "$g_check_center_improvements_cur_center", "p_town_1_1"),
    (try_end),
    (call_script, "script_process_center_upgrades", "$g_check_center_improvements_cur_center"),
    (val_add, "$g_check_center_improvements_cur_center", 1),
    (call_script, "script_process_center_upgrades", "$g_check_center_improvements_cur_center"),
    (val_add, "$g_check_center_improvements_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_33", 2),
  ]),

  (0.032,
  [
    (try_begin),
      (lt, "$g_add_bandit_to_fief_cur_fief", "p_town_1_1"),
      (assign, "$g_add_bandit_to_fief_cur_fief", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_add_bandit_to_fief_cur_fief", "p_salt_mine"),
      (assign, "$g_add_bandit_to_fief_cur_fief", "p_town_1_1"),
    (try_end),
    (call_script, "script_add_bandits_to_towns_and_villages", "$g_add_bandit_to_fief_cur_fief"),
    (val_add, "$g_add_bandit_to_fief_cur_fief", 1),
    (val_add, "$g_simple_trigger_fire_count_34", 1),
  ]),

  (24,
  [
    (assign, ":var0", 0),
    (try_for_range, ":var1", "p_town_1_1", "p_castle_1_1"),
      (party_get_slot, ":var2", ":var1", 156),
      (try_begin),
        (eq, ":var2", 1),
        (call_script, "script_fill_tournament_participants_troop", ":var1", 0),
        (call_script, "script_sort_tournament_participant_troops"),
        (call_script, "script_get_num_tournament_participants"),
        (store_sub, ":var3", reg0, 1),
        (call_script, "script_remove_tournament_participants_randomly", ":var3"),
        (call_script, "script_sort_tournament_participant_troops"),
        (troop_get_slot, ":var4", "trp_tournament_participants", 0),
        (try_begin),
          (is_between, ":var4", "trp_npc1", "trp_knight_1_1_wife"),
          (str_store_troop_name_link, s1, ":var4"),
          (str_store_party_name_link, s2, ":var1"),
          (display_message, "@{s1} has won the tournament at {s2}."),
          (call_script, "script_change_troop_renown", ":var4", 20),
        (try_end),
      (try_end),
      (val_sub, ":var2", 1),
      (val_max, ":var2", 0),
      (party_set_slot, ":var1", 156, ":var2"),
      (try_begin),
        (gt, ":var2", 0),
        (val_add, ":var0", 1),
      (try_end),
    (try_end),
    (try_for_range, ":var5", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var5", 4, 6),
      (faction_get_slot, ":var6", ":var5", 5),
      (is_between, ":var6", "p_town_1_1", "p_castle_1_1"),
      (party_slot_ge, ":var6", 156, 1),
      (party_set_slot, ":var6", 156, 2),
    (try_end),
    (try_begin),
      (lt, ":var0", 8),
      (store_random_in_range, ":var7", 0, 100),
      (lt, ":var7", 29),
      (store_random_in_range, ":var8", "p_town_1_1", "p_castle_1_1"),
      (store_random_in_range, ":var9", 5, 7),
      (party_set_slot, ":var8", 156, ":var9"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (str_store_party_name, s1, ":var8"),
        (display_message, "@{!}{s1} is holding a tournament."),
      (try_end),
    (try_end),
  ]),

  (3,
  [
    (assign, "$g_player_tournament_placement", 0),
  ]),

  (1,
  [
    (neg|map_free),
    (is_currently_night),
    (is_between, "$g_last_rest_center", "p_town_1_1", "p_salt_mine"),
    (neg|party_slot_eq, "$g_last_rest_center", 7, "trp_player"),
    (store_faction_of_party, ":var0", "$g_last_rest_center"),
    (neq, ":var0", "fac_player_supporters_faction"),
    (store_current_hours, ":var1"),
    (ge, ":var1", "$g_last_rest_payment_until"),
    (store_add, "$g_last_rest_payment_until", ":var1", 24),
    (store_troop_gold, ":var2", "trp_player"),
    (party_get_num_companions, ":var3", "p_main_party"),
    (store_div, ":var4", ":var3", 4),
    (val_add, ":var4", 1),
    (try_begin),
      (ge, ":var2", ":var4"),
      (display_message, "@You pay for accommodation."),
      (troop_remove_gold, "trp_player", ":var4"),
    (else_try),
      (gt, ":var2", 0),
      (troop_remove_gold, "trp_player", ":var2"),
    (try_end),
  ]),

  (24,
  [
    (call_script, "script_update_party_creation_random_limits"),
  ]),

  (48,
  [
    (assign, ":var0", 0),
    (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_set_slot, ":var1", 20, 0),
    (try_end),
    (try_for_parties, ":var2"),
      (store_faction_of_party, ":var3", ":var2"),
      (is_between, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (is_between, ":var2", "p_town_1_1", "p_salt_mine"),
      (faction_get_slot, ":var4", ":var3", 20),
      (val_add, ":var4", 1),
      (faction_set_slot, ":var3", 20, ":var4"),
    (try_end),
    (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var1", 21, 0),
      (val_add, ":var0", 1),
      (faction_slot_eq, ":var1", 20, 0),
      (assign, ":var5", 0),
      (try_begin),
        (eq, ":var1", "fac_player_supporters_faction"),
        (try_begin),
          (le, "$supported_pretender", 0),
          (faction_set_slot, ":var1", 21, 2),
          (assign, ":var5", 1),
        (try_end),
      (else_try),
        (neq, "$players_kingdom", ":var1"),
        (faction_set_slot, ":var1", 21, 1),
        (try_for_parties, ":var2"),
          (this_or_next|party_slot_eq, ":var2", 0, 69),
          (this_or_next|party_slot_eq, ":var2", 0, 12),
          (this_or_next|party_slot_eq, ":var2", 0, 11),
          (this_or_next|party_slot_eq, ":var2", 0, 19),
          (this_or_next|party_slot_eq, ":var2", 0, 6),
          (this_or_next|party_slot_eq, ":var2", 0, 10),
          (party_slot_eq, ":var2", 0, 5),
          (store_faction_of_party, ":var3", ":var2"),
          (eq, ":var3", ":var1"),
          (remove_party, ":var2"),
        (try_end),
        (assign, ":var6", -1),
        (try_for_range, ":var7", "trp_kingdom_2_pretender", "trp_knight_1_1_wife"),
          (troop_slot_eq, ":var7", 14, ":var1"),
          (assign, ":var6", ":var7"),
        (try_end),
        (try_begin),
          (is_between, ":var6", "trp_kingdom_2_pretender", "trp_knight_1_1_wife"),
          (neq, ":var6", "$supported_pretender"),
          (troop_set_slot, ":var6", 12, 0),
        (try_end),
        (assign, ":var5", 1),
        (try_begin),
          (eq, "$players_oath_renounced_against_kingdom", ":var1"),
          (assign, "$players_oath_renounced_against_kingdom", 0),
          (assign, "$players_oath_renounced_given_center", 0),
          (assign, "$players_oath_renounced_begin_time", 0),
          (call_script, "script_add_notification_menu", "mnu_notification_oath_renounced_faction_defeated", ":var1", 0),
        (try_end),
        (call_script, "script_add_notification_menu", "mnu_notification_faction_defeated", ":var1", 0),
      (try_end),
      (try_begin),
        (eq, ":var5", 1),
        (val_sub, ":var0", 1),
      (try_end),
      (try_for_range, ":var8", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (call_script, "script_update_faction_notes", ":var8"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, ":var0", 1),
      (eq, "$g_one_faction_left_notification_shown", 0),
      (assign, "$g_one_faction_left_notification_shown", 1),
      (try_for_range, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var1", 21, 0),
        (call_script, "script_add_notification_menu", "mnu_notification_one_faction_left", ":var1", 0),
      (try_end),
    (try_end),
  ]),

  (3,
  [
    (try_begin),
      (is_between, "$g_player_court", "p_town_1_1", "p_salt_mine"),
      (party_slot_eq, "$g_player_court", 39, "trp_peasant_woman"),
      (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (else_try),
      (is_between, "$g_player_court", "p_town_1_1", "p_salt_mine"),
      (store_faction_of_party, ":var0", "$g_player_court"),
      (neq, ":var0", "$players_kingdom"),
      (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (else_try),
      (lt, "$g_player_court", "p_town_1_1"),
      (this_or_next|faction_slot_eq, "$players_kingdom", 11, "trp_player"),
      (gt, "$g_player_minister", 0),
      (assign, ":var1", 0),
      (try_for_range, ":var2", "p_town_1_1", "p_village_1_1"),
        (eq, ":var1", 0),
        (store_faction_of_party, ":var0", ":var2"),
        (eq, ":var0", "$players_kingdom"),
        (assign, ":var1", ":var2"),
      (try_end),
      (ge, ":var1", 1),
      (call_script, "script_add_notification_menu", "mnu_notification_court_lost", 0, 0),
    (try_end),
    (try_begin),
      (troop_get_slot, ":var3", "trp_player", 34),
      (gt, ":var3", 0),
      (neg|check_quest_active, "qst_wed_betrothed"),
      (neg|check_quest_active, "qst_wed_betrothed_female"),
      (str_store_troop_name, s5, ":var3"),
      (display_message, "@Betrothal to {s5} expires"),
      (troop_set_slot, "trp_player", 34, -1),
      (troop_set_slot, ":var3", 34, -1),
    (try_end),
  ]),

  (6,
  [
    (try_for_parties, ":var0"),
      (gt, ":var0", "p_spawn_points_end"),
      (party_get_template_id, ":var1", ":var0"),
      (is_between, ":var1", "pt_steppe_bandits", "pt_deserters"),
      (party_template_get_slot, ":var2", ":var1", 4),
      (try_begin),
        (gt, ":var2", "p_spawn_points_end"),
        (store_distance_to_party_from_party, ":var3", ":var0", ":var2"),
        (gt, ":var3", 30),
        (lt, ":var3", 35),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_point),
        (party_get_position, pos5, ":var2"),
        (party_set_ai_target_position, ":var0", pos5),
      (else_try),
        (get_party_ai_behavior, ":var4", ":var0"),
        (eq, ":var4", 6),
        (try_begin),
          (gt, ":var2", "p_spawn_points_end"),
          (store_distance_to_party_from_party, ":var3", ":var0", ":var2"),
          (lt, ":var3", 3),
          (party_set_ai_behavior, ":var0", ai_bhvr_patrol_party),
          (party_template_get_slot, ":var5", ":var1", 5),
          (party_set_ai_object, ":var0", ":var5"),
          (party_set_ai_patrol_radius, ":var0", 45),
        (else_try),
          (lt, ":var2", "p_spawn_points_end"),
          (party_set_ai_behavior, ":var0", ai_bhvr_patrol_party),
          (party_template_get_slot, ":var5", ":var1", 5),
          (party_set_ai_object, ":var0", ":var5"),
          (party_set_ai_patrol_radius, ":var0", 45),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (eq, "$g_misc_disable_renown_weekly_reduction", 0),
    (troop_get_slot, ":var0", "trp_player", 7),
    (store_div, ":var1", ":var0", 200),
    (val_sub, ":var0", ":var1"),
    (troop_set_slot, "trp_player", 7, ":var0"),
  ]),

  (1,
  [
    (neg|map_free),
    (gt, "$g_player_reading_book", 0),
    (player_has_item, "$g_player_reading_book"),
    (store_attribute_level, ":var0", "trp_player", ca_intelligence),
    (item_get_slot, ":var1", "$g_player_reading_book", 4),
    (le, ":var1", ":var0"),
    (item_get_slot, ":var2", "$g_player_reading_book", 2),
    (item_get_slot, ":var3", "$g_player_reading_book", 3),
    (eq, ":var3", 0),
    (val_add, ":var2", 7),
    (item_set_slot, "$g_player_reading_book", 2, ":var2"),
    (ge, ":var2", 1000),
    (item_set_slot, "$g_player_reading_book", 3, 1),
    (str_store_item_name, s1, "$g_player_reading_book"),
    (str_clear, s2),
    (try_begin),
      (eq, "$g_player_reading_book", "itm_book_tactics"),
      (troop_raise_skill, "trp_player", "skl_tactics", 1),
      (str_store_string, s2, "@ Your tactics skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_persuasion"),
      (troop_raise_skill, "trp_player", "skl_persuasion", 1),
      (str_store_string, s2, "@ Your persuasion skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_leadership"),
      (troop_raise_skill, "trp_player", "skl_leadership", 1),
      (str_store_string, s2, "@ Your leadership skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_intelligence"),
      (troop_raise_attribute, "trp_player", ca_intelligence, 1),
      (str_store_string, s2, "@ Your intelligence has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_trade"),
      (troop_raise_skill, "trp_player", "skl_trade", 1),
      (str_store_string, s2, "@ Your trade skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_weapon_mastery"),
      (troop_raise_skill, "trp_player", "skl_weapon_master", 1),
      (str_store_string, s2, "@ Your weapon master skill has increased by 1."),
    (else_try),
      (eq, "$g_player_reading_book", "itm_book_engineering"),
      (troop_raise_skill, "trp_player", "skl_engineer", 1),
      (str_store_string, s2, "@ Your engineer skill has increased by 1."),
    (try_end),
    (unlock_achievement, 37),
    (try_begin),
      (eq, "$g_infinite_camping", 0),
      (dialog_box, "@You have finished reading {s1}.{s2}", "@Book Read"),
    (try_end),
    (assign, "$g_player_reading_book", 0),
  ]),

  (12,
  [
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 17),
      (store_distance_to_party_from_party, ":var1", ":var0", "p_main_party"),
      (try_begin),
        (gt, ":var1", 30),
        (remove_party, ":var0"),
        (try_begin),
          (check_quest_active, "qst_move_cattle_herd"),
          (neg|check_quest_concluded, "qst_move_cattle_herd"),
          (quest_slot_eq, "qst_move_cattle_herd", 8, ":var0"),
          (call_script, "script_fail_quest", "qst_move_cattle_herd"),
        (try_end),
      (else_try),
        (gt, ":var1", 10),
        (party_set_slot, ":var0", 7, 0),
        (party_set_ai_behavior, ":var0", ai_bhvr_hold),
      (try_end),
    (try_end),
  ]),

  (0.397,
  [
    (try_begin),
      (lt, "$g_player_school_bonus_cur_village", "p_village_1_1"),
      (assign, "$g_player_school_bonus_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_player_school_bonus_cur_village", "p_salt_mine"),
      (assign, "$g_player_school_bonus_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (party_slot_eq, "$g_player_school_bonus_cur_village", 7, "trp_player"),
      (party_slot_eq, "$g_player_school_bonus_cur_village", 133, 1),
      (party_get_slot, ":var0", "$g_player_school_bonus_cur_village", 26),
      (val_add, ":var0", 1),
      (val_min, ":var0", 100),
      (party_set_slot, "$g_player_school_bonus_cur_village", 26, ":var0"),
    (try_end),
    (val_add, "$g_player_school_bonus_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_35", 1),
  ]),

  (24,
  [
    (try_for_range, ":var0", 0, "qst_quests_end"),
      (try_begin),
        (check_quest_active, ":var0"),
        (try_begin),
          (neg|check_quest_concluded, ":var0"),
          (quest_slot_ge, ":var0", 23, 1),
          (quest_get_slot, ":var1", ":var0", 23),
          (val_sub, ":var1", 1),
          (try_begin),
            (eq, ":var1", 0),
            (call_script, "script_abort_quest", ":var0", 1),
          (else_try),
            (quest_set_slot, ":var0", 23, ":var1"),
            (assign, reg0, ":var1"),
            (add_quest_note_from_sreg, ":var0", 7, "@You have {reg0} days to finish this quest.", 0),
          (try_end),
        (try_end),
      (else_try),
        (quest_slot_ge, ":var0", 25, 1),
        (quest_get_slot, ":var2", ":var0", 25),
        (val_sub, ":var2", 1),
        (quest_set_slot, ":var0", 25, ":var2"),
      (try_end),
    (try_end),
  ]),

  (2,
  [
    (eq, "$g_infinite_camping", 0),
    (eq, "$g_player_crusading", 0),
    (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (eq, "$g_player_is_captive", 0),
    (try_begin),
      (check_quest_active, "qst_report_to_army"),
      (faction_slot_eq, "$players_kingdom", 8, -1),
      (call_script, "script_abort_quest", "qst_report_to_army", 0),
    (try_end),
    (faction_get_slot, ":var0", "$players_kingdom", 5),
    (neg|faction_slot_eq, "$players_kingdom", 4, 0),
    (neg|faction_slot_eq, "$players_kingdom", 4, 6),
    (assign, ":var1", 1),
    (try_begin),
      (this_or_next|faction_slot_eq, "$players_kingdom", 4, 5),
      (this_or_next|faction_slot_eq, "$players_kingdom", 4, 2),
      (faction_slot_eq, "$players_kingdom", 4, 3),
      (neg|is_between, ":var0", "p_town_1_1", "p_village_1_1"),
      (assign, ":var1", 0),
    (try_end),
    (eq, ":var1", 1),
    (assign, ":var2", 0),
    (try_for_range, ":var3", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, ":var3", "$players_kingdom"),
      (store_relation, ":var4", ":var3", "$players_kingdom"),
      (lt, ":var4", 0),
      (assign, ":var2", 1),
    (try_end),
    (eq, ":var2", 1),
    (neg|check_quest_active, "qst_report_to_army"),
    (neg|check_quest_active, "qst_follow_army"),
    (neg|quest_slot_ge, "qst_report_to_army", 25, 1),
    (faction_get_slot, ":var5", "$players_kingdom", 8),
    (gt, ":var5", 0),
    (troop_get_slot, ":var6", ":var5", 10),
    (gt, ":var6", 0),
    (party_is_active, ":var6"),
    (store_distance_to_party_from_party, ":var7", ":var6", "p_main_party"),
    (le, ":var7", 96),
    (assign, ":var8", 1),
    (try_for_range, ":var9", "qst_deliver_message", "qst_follow_army"),
      (check_quest_active, ":var9"),
      (quest_slot_eq, ":var9", 6, ":var5"),
      (assign, ":var8", 0),
    (try_end),
    (eq, ":var8", 1),
    (try_for_range, ":var9", "qst_destroy_bandit_lair", "qst_blank_quest_2"),
      (check_quest_active, ":var9"),
      (quest_slot_eq, ":var9", 6, ":var5"),
      (assign, ":var8", 0),
    (try_end),
    (eq, ":var8", 1),
    (try_for_range, ":var9", "qst_deliver_cattle_to_army", "qst_rescue_lord_by_replace"),
      (check_quest_active, ":var9"),
      (assign, ":var8", 0),
    (try_end),
    (eq, ":var8", 1),
    (store_character_level, ":var10", "trp_player"),
    (ge, ":var10", 8),
    (assign, ":var11", 2),
    (try_for_range, ":var12", "p_town_1_1", "p_salt_mine"),
      (party_slot_eq, ":var12", 7, "trp_player"),
      (try_begin),
        (party_slot_eq, ":var12", 0, 3),
        (val_add, ":var11", 3),
      (else_try),
        (party_slot_eq, ":var12", 0, 2),
        (val_add, ":var11", 1),
      (else_try),
        (val_add, ":var11", 1),
      (try_end),
    (try_end),
    (val_mul, ":var11", 4),
    (val_min, ":var11", 60),
    (quest_set_slot, "qst_report_to_army", 6, ":var5"),
    (quest_set_slot, "qst_report_to_army", 2, ":var5"),
    (quest_set_slot, "qst_report_to_army", 10, ":var11"),
    (quest_set_slot, "qst_report_to_army", 23, 6),
    (quest_set_slot, "qst_report_to_army", 24, 15),
    (jump_to_menu, "mnu_kingdom_army_quest_report_to_army"),
  ]),

  (3,
  [
    (assign, "$g_random_army_quest", -1),
    (check_quest_active, "qst_follow_army", 1),
    (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
    (neg|faction_slot_eq, "$players_kingdom", 4, 0),
    (faction_get_slot, ":var0", "$players_kingdom", 8),
    (neq, ":var0", "trp_player"),
    (gt, ":var0", 0),
    (troop_get_slot, ":var1", ":var0", 10),
    (gt, ":var1", 0),
    (party_is_active, ":var1"),
    (store_distance_to_party_from_party, ":var2", ":var1", "p_main_party"),
    (try_begin),
      (lt, ":var2", 15),
      (assign, "$g_player_follow_army_warnings", 0),
      (store_current_hours, ":var3"),
      (faction_get_slot, ":var4", "$players_kingdom", 95),
      (store_sub, ":var5", ":var3", ":var4"),
      (assign, ":var6", -1),
      (try_begin),
        (store_random_in_range, ":var7", 0, 100),
        (lt, ":var7", 30),
        (troop_slot_eq, ":var0", 20, 0),
        (try_for_range, ":var8", 0, 20),
          (eq, ":var6", -1),
          (store_random_in_range, ":var9", "qst_deliver_cattle_to_army", "qst_rescue_lord_by_replace"),
          (neg|quest_slot_ge, ":var9", 25, 1),
          (try_begin),
            (eq, ":var9", "qst_deliver_cattle_to_army"),
            (try_begin),
              (faction_slot_eq, "$players_kingdom", 4, 2),
              (gt, ":var5", 120),
              (store_random_in_range, ":var10", 5, 10),
              (assign, ":var6", "qst_deliver_cattle_to_army"),
              (quest_set_slot, ":var6", 10, ":var10"),
              (quest_set_slot, ":var6", 23, 10),
              (quest_set_slot, ":var6", 24, 30),
            (try_end),
          (else_try),
            (eq, ":var9", "qst_join_siege_with_army"),
            (eq, 1, 0),
            (try_begin),
              (faction_slot_eq, "$players_kingdom", 4, 2),
              (faction_get_slot, ":var11", "$players_kingdom", 5),
              (is_between, ":var11", "p_town_1_1", "p_village_1_1"),
              (party_get_battle_opponent, ":var12", ":var1"),
              (eq, ":var12", ":var11"),
              (assign, ":var6", ":var9"),
              (quest_set_slot, ":var6", 1, ":var11"),
              (quest_set_slot, ":var6", 23, 2),
              (quest_set_slot, ":var6", 24, 15),
            (try_end),
          (else_try),
            (eq, ":var9", "qst_scout_waypoints"),
            (try_begin),
              (assign, ":var13", 100),
              (assign, "$qst_scout_waypoints_wp_1", -1),
              (assign, "$qst_scout_waypoints_wp_2", -1),
              (assign, "$qst_scout_waypoints_wp_3", -1),
              (assign, ":var14", 0),
              (try_for_range, ":var8", 0, ":var13"),
                (try_begin),
                  (lt, "$qst_scout_waypoints_wp_1", 0),
                  (call_script, "script_cf_get_random_enemy_center_within_range", ":var1", 50),
                  (assign, "$qst_scout_waypoints_wp_1", reg0),
                (try_end),
                (try_begin),
                  (lt, "$qst_scout_waypoints_wp_2", 0),
                  (call_script, "script_cf_get_random_enemy_center_within_range", ":var1", 50),
                  (neq, "$qst_scout_waypoints_wp_1", reg0),
                  (assign, "$qst_scout_waypoints_wp_2", reg0),
                (try_end),
                (try_begin),
                  (lt, "$qst_scout_waypoints_wp_3", 0),
                  (call_script, "script_cf_get_random_enemy_center_within_range", ":var1", 50),
                  (neq, "$qst_scout_waypoints_wp_1", reg0),
                  (neq, "$qst_scout_waypoints_wp_2", reg0),
                  (assign, "$qst_scout_waypoints_wp_3", reg0),
                (try_end),
                (neq, "$qst_scout_waypoints_wp_1", "$qst_scout_waypoints_wp_2"),
                (neq, "$qst_scout_waypoints_wp_1", "$qst_scout_waypoints_wp_2"),
                (neq, "$qst_scout_waypoints_wp_2", "$qst_scout_waypoints_wp_3"),
                (ge, "$qst_scout_waypoints_wp_1", 0),
                (ge, "$qst_scout_waypoints_wp_2", 0),
                (ge, "$qst_scout_waypoints_wp_3", 0),
                (assign, ":var13", 0),
                (assign, ":var14", 1),
              (try_end),
              (eq, ":var14", 1),
              (assign, "$qst_scout_waypoints_wp_1_visited", 0),
              (assign, "$qst_scout_waypoints_wp_2_visited", 0),
              (assign, "$qst_scout_waypoints_wp_3_visited", 0),
              (assign, ":var6", "qst_scout_waypoints"),
              (quest_set_slot, ":var6", 23, 7),
              (quest_set_slot, ":var6", 24, 25),
            (try_end),
          (try_end),
        (try_end),
        (try_begin),
          (neq, ":var6", -1),
          (quest_set_slot, ":var6", 11, 0),
          (quest_set_slot, ":var6", 6, ":var0"),
          (try_begin),
            (eq, ":var6", "qst_join_siege_with_army"),
            (jump_to_menu, "mnu_kingdom_army_quest_join_siege_order"),
          (else_try),
            (assign, "$g_random_army_quest", ":var6"),
            (quest_set_slot, "$g_random_army_quest", 6, ":var0"),
            (jump_to_menu, "mnu_kingdom_army_quest_messenger"),
          (try_end),
        (try_end),
      (try_end),
    (else_try),
      (val_add, "$g_player_follow_army_warnings", 1),
      (try_begin),
        (lt, "$g_player_follow_army_warnings", 15),
        (try_begin),
          (store_mod, ":var15", "$g_player_follow_army_warnings", 3),
          (eq, ":var15", 0),
          (str_store_troop_name_link, s1, ":var0"),
          (try_begin),
            (lt, "$g_player_follow_army_warnings", 8),
          (else_try),
            (display_message, "str_marshal_warning"),
          (try_end),
        (try_end),
      (else_try),
        (jump_to_menu, "mnu_kingdom_army_follow_failed"),
      (try_end),
    (try_end),
  ]),

  (0.5,
  [
    (check_quest_active, "qst_move_cattle_herd"),
    (neg|check_quest_concluded, "qst_move_cattle_herd"),
    (quest_get_slot, ":var0", "qst_move_cattle_herd", 8),
    (quest_get_slot, ":var1", "qst_move_cattle_herd", 1),
    (store_distance_to_party_from_party, ":var2", ":var0", ":var1"),
    (lt, ":var2", 3),
    (remove_party, ":var0"),
    (call_script, "script_succeed_quest", "qst_move_cattle_herd"),
  ]),

  (3,
  [
    (try_for_range, ":var0", "trp_npc1", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 166, 1),
      (troop_slot_eq, ":var0", 2, 2),
      (troop_get_slot, ":var1", ":var0", 10),
      (ge, ":var1", 1),
      (party_is_active, ":var1"),
      (party_slot_eq, ":var1", 31, 1),
      (store_current_hours, ":var2"),
      (neg|party_slot_ge, ":var1", 32, ":var2"),
      (party_set_slot, ":var1", 30, -1),
      (party_set_slot, ":var1", 31, 0),
      (assign, ":var3", 200),
      (store_add, ":var4", ":var2", ":var3"),
      (party_set_slot, ":var1", 33, ":var4"),
    (try_end),
  ]),

  (0.5,
  [
    (try_begin),
      (check_quest_active, "qst_deliver_cattle"),
      (neg|check_quest_succeeded, "qst_deliver_cattle"),
      (quest_get_slot, ":var0", "qst_deliver_cattle", 1),
      (quest_get_slot, ":var1", "qst_deliver_cattle", 10),
      (quest_get_slot, ":var2", "qst_deliver_cattle", 11),
      (store_sub, ":var3", ":var1", ":var2"),
      (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":var0", ":var3"),
      (val_add, ":var2", reg0),
      (quest_set_slot, "qst_deliver_cattle", 11, ":var2"),
      (le, ":var1", ":var2"),
      (call_script, "script_succeed_quest", "qst_deliver_cattle"),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_deliver_cattle_to_army"),
      (neg|check_quest_succeeded, "qst_deliver_cattle_to_army"),
      (quest_get_slot, ":var4", "qst_deliver_cattle_to_army", 6),
      (troop_get_slot, ":var5", ":var4", 10),
      (try_begin),
        (gt, ":var5", 0),
        (quest_get_slot, ":var1", "qst_deliver_cattle_to_army", 10),
        (quest_get_slot, ":var2", "qst_deliver_cattle_to_army", 11),
        (store_sub, ":var3", ":var1", ":var2"),
        (call_script, "script_remove_cattles_if_herd_is_close_to_party", ":var5", ":var3"),
        (val_add, ":var2", reg0),
        (quest_set_slot, "qst_deliver_cattle_to_army", 11, ":var2"),
        (try_begin),
          (le, ":var1", ":var2"),
          (call_script, "script_succeed_quest", "qst_deliver_cattle_to_army"),
        (try_end),
      (else_try),
        (call_script, "script_abort_quest", "qst_deliver_cattle_to_army", 0),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (neg|map_free),
    (check_quest_active, "qst_train_peasants_against_bandits"),
    (neg|check_quest_concluded, "qst_train_peasants_against_bandits"),
    (eq, "$qst_train_peasants_against_bandits_currently_training", 1),
    (val_add, "$qst_train_peasants_against_bandits_num_hours_trained", 1),
    (call_script, "script_get_max_skill_of_player_party", "skl_trainer"),
    (assign, ":var0", reg0),
    (store_sub, ":var1", 20, ":var0"),
    (val_mul, ":var1", 3),
    (val_div, ":var1", 5),
    (ge, "$qst_train_peasants_against_bandits_num_hours_trained", ":var1"),
    (assign, "$qst_train_peasants_against_bandits_num_hours_trained", 0),
    (rest_for_hours, 0, 0, 0),
    (jump_to_menu, "mnu_train_peasants_against_bandits_ready"),
  ]),

  (1,
  [
    (check_quest_active, "qst_scout_waypoints"),
    (neg|check_quest_succeeded, "qst_scout_waypoints"),
    (try_begin),
      (eq, "$qst_scout_waypoints_wp_1_visited", 0),
      (store_distance_to_party_from_party, ":var0", "$qst_scout_waypoints_wp_1", "p_main_party"),
      (le, ":var0", 3),
      (assign, "$qst_scout_waypoints_wp_1_visited", 1),
      (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_1"),
      (display_message, "@{s1} is scouted."),
    (try_end),
    (try_begin),
      (eq, "$qst_scout_waypoints_wp_2_visited", 0),
      (store_distance_to_party_from_party, ":var0", "$qst_scout_waypoints_wp_2", "p_main_party"),
      (le, ":var0", 3),
      (assign, "$qst_scout_waypoints_wp_2_visited", 1),
      (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_2"),
      (display_message, "@{s1} is scouted."),
    (try_end),
    (try_begin),
      (eq, "$qst_scout_waypoints_wp_3_visited", 0),
      (store_distance_to_party_from_party, ":var0", "$qst_scout_waypoints_wp_3", "p_main_party"),
      (le, ":var0", 3),
      (assign, "$qst_scout_waypoints_wp_3_visited", 1),
      (str_store_party_name_link, s1, "$qst_scout_waypoints_wp_3"),
      (display_message, "@{s1} is scouted."),
    (try_end),
    (eq, "$qst_scout_waypoints_wp_1_visited", 1),
    (eq, "$qst_scout_waypoints_wp_2_visited", 1),
    (eq, "$qst_scout_waypoints_wp_3_visited", 1),
    (call_script, "script_succeed_quest", "qst_scout_waypoints"),
  ]),

  (3,
  [
    (neg|map_free),
    (check_quest_active, "qst_kill_local_merchant"),
    (quest_slot_eq, "qst_kill_local_merchant", 11, 0),
    (quest_set_slot, "qst_kill_local_merchant", 11, 1),
    (rest_for_hours, 0, 0, 0),
    (assign, "$auto_enter_town", "$qst_kill_local_merchant_center"),
    (assign, "$quest_auto_menu", "mnu_kill_local_merchant_begin"),
  ]),

  (1,
  [
    (neg|map_free),
    (check_quest_active, "qst_collect_taxes"),
    (eq, "$g_player_is_captive", 0),
    (eq, "$qst_collect_taxes_currently_collecting", 1),
    (quest_get_slot, ":var0", "qst_collect_taxes", 11),
    (this_or_next|eq, ":var0", 1),
    (this_or_next|eq, ":var0", 2),
    (eq, ":var0", 3),
    (quest_get_slot, ":var1", "qst_collect_taxes", 10),
    (val_sub, ":var1", 1),
    (quest_set_slot, "qst_collect_taxes", 10, ":var1"),
    (call_script, "script_get_max_skill_of_player_party", "skl_trade"),
    (try_begin),
      (lt, ":var1", 0),
      (assign, ":var0", 4),
      (quest_set_slot, "qst_collect_taxes", 11, 4),
      (rest_for_hours, 0, 0, 0),
      (jump_to_menu, "mnu_collect_taxes_complete"),
    (else_try),
      (assign, ":var2", "$qst_collect_taxes_hourly_income"),
      (party_get_slot, ":var3", "$g_encountered_party", 50),
      (store_add, ":var4", 30, ":var3"),
      (val_mul, ":var2", ":var4"),
      (val_div, ":var2", 80),
      (try_begin),
        (eq, "$qst_collect_taxes_halve_taxes", 1),
        (val_div, ":var2", 2),
      (try_end),
      (val_max, ":var2", 2),
      (store_random_in_range, ":var5", 1, ":var2"),
      (quest_get_slot, ":var6", "qst_collect_taxes", 22),
      (val_add, ":var6", ":var5"),
      (quest_set_slot, "qst_collect_taxes", 22, ":var6"),
      (call_script, "script_troop_add_gold", "trp_player", ":var5"),
    (try_end),
    (try_begin),
      (eq, ":var0", 1),
      (val_sub, "$qst_collect_taxes_menu_counter", 1),
      (le, "$qst_collect_taxes_menu_counter", 0),
      (quest_set_slot, "qst_collect_taxes", 11, 2),
      (jump_to_menu, "mnu_collect_taxes_revolt_warning"),
    (else_try),
      (eq, ":var0", 2),
      (val_sub, "$qst_collect_taxes_unrest_counter", 1),
      (le, "$qst_collect_taxes_unrest_counter", 0),
      (eq, "$qst_collect_taxes_halve_taxes", 0),
      (quest_set_slot, "qst_collect_taxes", 11, 3),
      (store_div, ":var7", 10000, "$qst_collect_taxes_total_hours"),
      (val_add, ":var7", 30),
      (store_random_in_range, ":var8", 0, 1000),
      (try_begin),
        (lt, ":var8", ":var7"),
        (jump_to_menu, "mnu_collect_taxes_revolt"),
      (try_end),
    (try_end),
  ]),

  (72,
  [
    (gt, "$g_force_peace_faction_1", 0),
    (gt, "$g_force_peace_faction_2", 0),
    (try_begin),
      (store_relation, ":var0", "$g_force_peace_faction_1", "$g_force_peace_faction_2"),
      (lt, ":var0", 0),
      (call_script, "script_diplomacy_start_peace_between_kingdoms", "$g_force_peace_faction_1", "$g_force_peace_faction_2", 1),
    (try_end),
    (assign, "$g_force_peace_faction_1", 0),
    (assign, "$g_force_peace_faction_2", 0),
  ]),

  (1,
  [
    (str_store_string, s51, "str_no_trigger_noted"),
    (try_begin),
      (gt, "$npc_to_rejoin_party", 0),
      (eq, "$g_infinite_camping", 0),
      (try_begin),
        (neg|main_party_has_troop, "$npc_to_rejoin_party"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_to_rejoin_party"),
        (assign, "$npc_map_talk_context", 151),
        (start_map_conversation, "$npc_to_rejoin_party", -1),
      (else_try),
        (troop_set_slot, "$npc_to_rejoin_party", 152, 8),
        (assign, "$npc_to_rejoin_party", 0),
      (try_end),
    (else_try),
      (gt, "$npc_is_quitting", 0),
      (eq, "$g_infinite_camping", 0),
      (try_begin),
        (main_party_has_troop, "$npc_is_quitting"),
        (neq, "$g_player_is_captive", 1),
        (neg|troop_slot_eq, "trp_player", 30, "$npc_is_quitting"),
        (neg|troop_slot_eq, "$npc_is_quitting", 30, "trp_player"),
        (str_store_string, s51, "str_triggered_by_npc_is_quitting"),
        (start_map_conversation, "$npc_is_quitting", -1),
      (else_try),
        (assign, "$npc_is_quitting", 0),
      (try_end),
    (else_try),
      (gt, "$npc_with_grievance", 0),
      (eq, "$g_infinite_camping", 0),
      (eq, "$disable_npc_complaints", 0),
      (try_begin),
        (main_party_has_troop, "$npc_with_grievance"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_has_grievance"),
        (assign, "$npc_map_talk_context", 61),
        (start_map_conversation, "$npc_with_grievance", -1),
      (else_try),
        (assign, "$npc_with_grievance", 0),
      (try_end),
    (else_try),
      (gt, "$npc_with_personality_clash", 0),
      (eq, "$g_infinite_camping", 0),
      (eq, "$disable_npc_complaints", 0),
      (troop_get_slot, ":var0", "$npc_with_personality_clash", 71),
      (try_begin),
        (main_party_has_troop, "$npc_with_personality_clash"),
        (main_party_has_troop, ":var0"),
        (neq, "$g_player_is_captive", 1),
        (assign, "$npc_map_talk_context", 72),
        (str_store_string, s51, "str_triggered_by_npc_has_personality_clash"),
        (start_map_conversation, "$npc_with_personality_clash", -1),
      (else_try),
        (assign, "$npc_with_personality_clash", 0),
      (try_end),
    (else_try),
      (gt, "$npc_with_political_grievance", 0),
      (eq, "$g_infinite_camping", 0),
      (eq, "$disable_npc_complaints", 0),
      (try_begin),
        (main_party_has_troop, "$npc_with_political_grievance"),
        (neq, "$g_player_is_captive", 1),
        (str_store_string, s51, "str_triggered_by_npc_has_political_grievance"),
        (assign, "$npc_map_talk_context", 145),
        (start_map_conversation, "$npc_with_political_grievance", -1),
      (else_try),
        (assign, "$npc_with_political_grievance", 0),
      (try_end),
    (else_try),
      (eq, "$disable_sisterly_advice", 0),
      (eq, "$g_infinite_camping", 0),
      (gt, "$npc_with_sisterly_advice", 0),
      (try_begin),
        (main_party_has_troop, "$npc_with_sisterly_advice"),
        (neq, "$g_player_is_captive", 1),
        (troop_slot_ge, "$npc_with_sisterly_advice", 139, 1),
        (assign, "$npc_map_talk_context", 139),
        (start_map_conversation, "$npc_with_sisterly_advice", -1),
      (else_try),
        (assign, "$npc_with_sisterly_advice", 0),
      (try_end),
    (else_try),
      (eq, "$disable_local_histories", 0),
      (eq, "$g_infinite_camping", 0),
      (try_for_range, ":var1", "trp_npc1", "trp_kingdom_1_lord"),
        (main_party_has_troop, ":var1"),
        (troop_slot_eq, ":var1", 78, 0),
        (troop_get_slot, ":var2", ":var1", 60),
        (gt, ":var2", 0),
        (store_distance_to_party_from_party, ":var3", ":var2", "p_main_party"),
        (lt, ":var3", 7),
        (assign, "$npc_map_talk_context", 60),
        (str_store_string, s51, "str_triggered_by_local_histories"),
        (start_map_conversation, ":var1", -1),
      (try_end),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_rebel_against_kingdom"),
      (is_between, "$supported_pretender", "trp_kingdom_2_pretender", "trp_knight_1_1_wife"),
      (neg|main_party_has_troop, "$supported_pretender"),
      (neg|troop_slot_eq, "$supported_pretender", 2, 2),
      (party_add_members, "p_main_party", "$supported_pretender", 1),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_rebel_against_kingdom"),
      (is_between, "$supported_pretender", "trp_kingdom_2_pretender", "trp_knight_1_1_wife"),
      (main_party_has_troop, "$supported_pretender"),
      (neg|faction_slot_eq, "fac_player_supporters_faction", 8, "trp_player"),
      (call_script, "script_appoint_faction_marshall", "fac_player_supporters_faction", "trp_player"),
    (try_end),
  ]),

  (3,
  [
    (try_for_range, ":var0", "trp_npc1", "trp_knight_1_1_wife"),
      (troop_slot_eq, ":var0", 166, 1),
      (troop_slot_ge, ":var0", 55, 1),
      (store_faction_of_troop, ":var1", ":var0"),
      (troop_get_slot, ":var2", ":var0", 55),
      (troop_get_slot, ":var3", ":var0", 10),
      (assign, ":var4", 0),
      (try_begin),
        (le, ":var3", 0),
        (neg|troop_slot_ge, ":var0", 8, 0),
        (assign, ":var4", 1),
      (else_try),
        (gt, ":var3", 0),
        (party_get_attached_to, ":var5", ":var3"),
        (try_begin),
          (lt, ":var5", 0),
          (party_get_cur_town, ":var5", ":var3"),
        (try_end),
        (neg|this_or_next|is_between, ":var5", "p_town_1_1", "p_salt_mine"),
        (party_slot_eq, ":var5", 7, ":var0"),
        (assign, ":var6", "trp_knight_1_1_wife"),
        (try_for_range, ":var7", "trp_npc1", ":var6"),
          (troop_slot_eq, ":var7", 166, 1),
          (neq, ":var7", ":var0"),
          (troop_slot_eq, ":var7", 2, 2),
          (troop_get_slot, ":var8", ":var7", 10),
          (party_is_active, ":var8"),
          (store_faction_of_party, ":var9", ":var8"),
          (eq, ":var9", ":var1"),
          (store_distance_to_party_from_party, ":var10", ":var3", ":var8"),
          (lt, ":var10", 4),
          (assign, ":var6", 0),
        (try_end),
        (neq, ":var6", 0),
        (assign, ":var4", 1),
      (try_end),
      (eq, ":var4", 1),
      (try_begin),
        (ge, "$cheat_mode", 1),
        (str_store_troop_name, s4, ":var0"),
        (display_message, "@{!}DEBUG - {s4} faction changed from slot troop change to faction"),
      (try_end),
      (troop_set_slot, ":var0", 55, 0),
      (try_begin),
        (faction_slot_eq, ":var1", 11, ":var0"),
        (troop_set_slot, ":var0", 166, 0),
      (else_try),
        (call_script, "script_change_troop_faction", ":var0", ":var2"),
        (is_between, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (str_store_troop_name_link, s1, ":var0"),
        (str_store_faction_name_link, s2, ":var1"),
        (str_store_faction_name_link, s3, ":var2"),
        (display_message, "@{s1} has switched from {s2} to {s3}."),
        (try_begin),
          (eq, ":var1", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_troop_left_players_faction", ":var0", ":var2"),
        (else_try),
          (eq, ":var2", "$players_kingdom"),
          (call_script, "script_add_notification_menu", "mnu_notification_troop_joined_players_faction", ":var0", ":var1"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (store_current_day, ":var0"),
    (gt, ":var0", "$g_last_report_control_day"),
    (store_time_of_day, ":var1"),
    (ge, ":var1", 18),
    (store_random_in_range, ":var2", 0, 4),
    (this_or_next|ge, ":var1", 22),
    (eq, ":var2", 0),
    (assign, "$g_last_report_control_day", ":var0"),
    (store_troop_gold, ":var3", "trp_player"),
    (try_begin),
      (lt, ":var3", 0),
      (store_sub, ":var4", 0, ":var3"),
      (troop_add_gold, "trp_player", ":var4"),
    (try_end),
    (party_get_morale, ":var5", "p_main_party"),
    (try_begin),
      (str_store_string, s1, "str_party_morale_is_low"),
      (str_clear, s2),
      (party_get_num_companion_stacks, ":var6", "p_main_party"),
      (assign, ":var7", 0),
      (try_for_range_backwards, ":var8", 0, ":var6"),
        (party_stack_get_troop_id, ":var9", "p_main_party", ":var8"),
        (neg|troop_is_hero, ":var9"),
        (party_stack_get_size, ":var10", "p_main_party", ":var8"),
        (store_faction_of_troop, ":var11", ":var9"),
        (assign, ":var12", ":var5"),
        (try_begin),
          (ge, ":var11", "fac_kingdom_1"),
          (lt, ":var11", "fac_kingdoms_end"),
          (faction_get_slot, ":var13", ":var11", 99),
          (val_div, ":var13", 100),
          (val_add, ":var12", ":var13"),
        (try_end),
        (lt, ":var12", 32),
        (store_sub, ":var14", 36, ":var12"),
        (val_div, ":var14", 4),
        (assign, ":var15", 0),
        (try_for_range, ":var16", 0, ":var10"),
          (store_random_in_range, ":var2", 0, 100),
          (lt, ":var2", ":var14"),
          (val_add, ":var15", 1),
          (remove_member_from_party, ":var9", "p_main_party"),
        (try_end),
        (try_begin),
          (ge, ":var15", 1),
          (str_store_troop_name, s2, ":var9"),
          (assign, reg0, ":var15"),
          (try_begin),
            (ge, ":var7", 1),
            (str_store_string, s1, "str_s1_reg0_s2"),
          (else_try),
            (str_store_string, s3, s1),
            (str_store_string, s1, "str_s3_reg0_s2"),
          (try_end),
          (val_add, ":var7", ":var15"),
        (try_end),
      (try_end),
      (try_begin),
        (store_div, ":var14", "$g_player_party_morale_modifier_debt", 4),
        (gt, ":var14", 0),
        (try_for_range, ":var17", "trp_player_camp_chest_1", "trp_player_camp_chest_end"),
          (troop_get_slot, ":var18", ":var17", 60),
          (gt, ":var18", 0),
          (party_is_active, ":var18"),
          (call_script, "script_party_inflict_attrition", ":var18", ":var14", 1),
          (party_get_num_companions, ":var19", "p_temp_casualties"),
          (try_begin),
            (gt, ":var19", 0),
            (str_store_party_name, s3, ":var18"),
            (str_store_string, s2, "str_pcamp_soldiers_from_s3"),
            (assign, reg0, ":var19"),
            (try_begin),
              (ge, ":var7", 1),
              (str_store_string, s1, "str_s1_reg0_s2"),
            (else_try),
              (str_store_string, s3, s1),
              (str_store_string, s1, "str_s3_reg0_s2"),
            (try_end),
            (val_add, ":var7", ":var19"),
          (try_end),
        (try_end),
      (try_end),
      (try_begin),
        (ge, ":var7", 1),
        (try_begin),
          (ge, ":var7", 2),
          (str_store_string, s2, "str_have_deserted_the_party"),
        (else_try),
          (str_store_string, s2, "str_has_deserted_the_party"),
        (try_end),
        (str_store_string, s1, "str_s1_s2"),
        (eq, "$g_infinite_camping", 0),
        (dialog_box, s1, "str_weekly_report"),
      (try_end),
    (try_end),
  ]),

  (1,
  [
    (try_begin),
      (eq, "$g_player_is_captive", 1),
      (neg|party_is_active, "$capturer_party"),
      (rest_for_hours, 0, 0, 0),
    (try_end),
    (assign, ":var0", "$next_center_will_be_fired"),
    (party_get_slot, ":var1", ":var0", 38),
    (eq, ":var1", 0),
    (try_begin),
      (party_get_slot, ":var2", ":var0", 120),
      (party_get_slot, ":var3", ":var2", 240),
      (store_current_hours, ":var4"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (is_between, ":var0", "p_town_1_1", "p_salt_mine"),
        (is_between, ":var2", "p_town_1_1", "p_salt_mine"),
        (str_store_party_name, s4, ":var0"),
        (str_store_party_name, s5, ":var2"),
        (store_current_hours, reg3),
        (party_get_slot, reg4, ":var2", 240),
        (display_message, "@{!}DEBUG - Checking fire at {s4} for {s5} - current time {reg3}, last nearby fire {reg4}"),
      (try_end),
      (eq, ":var4", ":var3"),
      (party_add_particle_system, ":var0", "psys_map_village_fire"),
      (party_add_particle_system, ":var0", "psys_map_village_fire_smoke"),
    (else_try),
      (store_add, ":var5", ":var3", 4),
      (eq, ":var5", ":var4"),
      (party_clear_particle_systems, ":var0"),
    (try_end),
  ]),

  (24,
  [
    (val_sub, "$g_dont_give_fief_to_player_days", 1),
    (val_max, "$g_dont_give_fief_to_player_days", -1),
    (val_sub, "$g_dont_give_marshalship_to_player_days", 1),
    (val_max, "$g_dont_give_marshalship_to_player_days", -1),
    (party_set_name, "p_steppe_bandit_spawn_point_1", "str_the_steppes"),
    (party_set_name, "p_steppe_bandit_spawn_point_2", "str_the_steppes"),
    (party_set_name, "p_taiga_bandit_spawn_point_1", "str_the_tundra"),
    (party_set_name, "p_taiga_bandit_spawn_point_2", "str_the_tundra"),
    (party_set_name, "p_forest_bandit_spawn_point_1", "str_the_forests"),
    (party_set_name, "p_forest_bandit_spawn_point_2", "str_the_forests"),
    (party_set_name, "p_forest_bandit_spawn_point_3", "str_the_forests"),
    (party_set_name, "p_forest_bandit_spawn_point_4", "str_the_forests"),
    (party_set_name, "p_forest_bandit_spawn_point_5", "str_the_forests"),
    (party_set_name, "p_forest_bandit_spawn_point_6", "str_the_forests"),
    (party_set_name, "p_forest_bandit_spawn_point_7", "str_the_forests"),
    (party_set_name, "p_mountain_bandit_spawn_point_1", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_2", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_3", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_4", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_5", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_6", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_7", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_8", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_9", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_10", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_11", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_12", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_13", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_14", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_15", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_16", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_17", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_18", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_19", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_20", "str_the_highlands"),
    (party_set_name, "p_mountain_bandit_spawn_point_21", "str_the_highlands"),
    (party_set_name, "p_sea_raider_spawn_point_1", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_2", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_3", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_4", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_5", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_6", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_7", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_8", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_9", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_10", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_11", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_12", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_13", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_14", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_15", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_16", "str_the_coast"),
    (party_set_name, "p_sea_raider_spawn_point_17", "str_the_coast"),
    (party_set_name, "p_desert_bandit_spawn_point_1", "str_the_deserts"),
    (party_set_name, "p_desert_bandit_spawn_point_2", "str_the_deserts"),
    (party_set_name, "p_desert_bandit_spawn_point_3", "str_the_deserts"),
    (party_set_name, "p_desert_bandit_spawn_point_4", "str_the_deserts"),
    (party_set_name, "p_desert_bandit_spawn_point_5", "str_the_deserts"),
    (try_begin),
      (check_quest_active, "qst_formal_marriage_proposal"),
      (check_quest_failed, "qst_formal_marriage_proposal"),
      (call_script, "script_end_quest", "qst_formal_marriage_proposal"),
    (try_end),
    (try_begin),
      (check_quest_active, "qst_lend_companion"),
      (quest_get_slot, ":var0", "qst_lend_companion", 6),
      (store_faction_of_troop, ":var1", ":var0"),
      (store_relation, ":var2", ":var1", "$players_kingdom"),
      (this_or_next|lt, ":var2", 0),
      (neg|is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (call_script, "script_abort_quest", "qst_lend_companion", 0),
    (try_end),
    (try_begin),
      (is_between, "$players_kingdom", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, "$players_kingdom", "fac_player_supporters_faction"),
      (faction_slot_eq, "$players_kingdom", 8, "trp_player"),
      (val_add, "$g_player_days_as_marshal", 1),
    (else_try),
      (assign, "$g_player_days_as_marshal", 0),
    (try_end),
    (try_for_range, ":var3", "p_town_1_1", "p_castle_1_1"),
      (party_get_slot, ":var4", ":var3", 139),
      (ge, ":var4", 1),
      (val_sub, ":var4", 1),
      (party_set_slot, ":var3", 139, ":var4"),
    (try_end),
  ]),

  (12,
  [
    (eq, "$g_player_is_captive", 0),
    (party_get_num_companion_stacks, ":var0", "p_main_party"),
    (assign, ":var1", 0),
    (try_for_range, ":var2", 0, ":var0"),
      (party_stack_get_size, ":var3", "p_main_party", ":var2"),
      (val_add, ":var1", ":var3"),
    (try_end),
    (val_div, ":var1", 3),
    (try_begin),
      (eq, ":var1", 0),
      (val_add, ":var1", 1),
    (try_end),
    (assign, ":var4", ":var1"),
    (assign, ":var5", 0),
    (troop_get_inventory_capacity, ":var6", "trp_player"),
    (try_for_range, ":var7", 0, ":var6"),
      (troop_get_inventory_slot, ":var8", "trp_player", ":var7"),
      (try_begin),
        (ge, ":var8", 0),
        (try_begin),
          (is_between, ":var8", "itm_smoked_fish", "itm_siege_supply"),
          (troop_inventory_slot_get_item_amount, ":var9", "trp_player", ":var7"),
          (troop_get_inventory_slot_modifier, ":var10", "trp_player", ":var7"),
          (neq, ":var10", 41),
          (val_add, ":var5", ":var9"),
        (try_end),
      (try_end),
    (try_end),
    (store_mul, ":var11", ":var5", 12),
    (val_div, ":var11", ":var4"),
    (try_begin),
      (le, ":var11", 48),
      (gt, ":var11", 0),
      (display_message, "@Your party is low on food, less than 48 hours of food remaining", 0xFF0000),
    (try_end),
  ]),

  (8,
  [
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 24),
      (party_get_slot, ":var1", ":var0", 246),
      (party_get_slot, ":var2", ":var0", 123),
      (store_distance_to_party_from_party, ":var3", ":var0", ":var1"),
      (try_begin),
        (le, ":var3", 1),
        (try_begin),
          (neq, ":var1", ":var2"),
          (try_begin),
            (is_between, ":var1", "p_village_1_1", "p_salt_mine"),
            (party_get_slot, ":var4", ":var1", 25),
          (else_try),
            (party_get_slot, ":var4", ":var1", 23),
          (try_end),
          (troop_get_slot, ":var5", "trp_player", 30),
          (troop_get_slot, ":var6", ":var5", 156),
          (troop_remove_items, ":var4", "itm_bread", ":var6"),
          (party_set_slot, ":var0", 5, ":var2"),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var0", ":var2"),
          (troop_add_items, "trp_household_possessions", "itm_bread", ":var6"),
        (else_try),
          (remove_party, ":var0"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (2.5,
  [
    (gt, "$g_recruiter_count", 0),
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 22),
      (party_get_slot, ":var1", ":var0", 288),
      (party_get_num_companion_stacks, ":var2", ":var0"),
      (assign, ":var3", 1),
      (assign, ":var4", 0),
      (try_for_range, ":var5", 0, ":var2"),
        (party_stack_get_troop_id, ":var6", ":var0", ":var5"),
        (eq, ":var6", "trp_dplmc_recruiter"),
        (assign, ":var3", 0),
      (try_end),
      (try_begin),
        (party_get_battle_opponent, ":var7", ":var0"),
        (lt, ":var7", 0),
        (eq, ":var3", 1),
        (party_get_slot, ":var8", ":var0", 289),
        (str_store_party_name_link, s13, ":var8"),
        (assign, reg10, ":var1"),
        (display_log_message, "@Your recruiter who was commissioned to recruit {reg10} recruits to {s13} has been defeated!", 0xFF0000),
        (remove_party, ":var0"),
        (assign, ":var4", 1),
        (val_sub, "$g_recruiter_count", 1),
      (try_end),
      (try_begin),
        (eq, ":var4", 0),
        (party_get_slot, ":var8", ":var0", 289),
        (store_faction_of_party, ":var9", ":var8"),
        (neq, ":var9", "$players_kingdom"),
        (str_store_party_name_link, s13, ":var8"),
        (assign, reg10, ":var1"),
        (display_log_message, "@{s13} has been taken by the enemy and your recruiter who was commissioned to recruit {reg10} recruits vanished without a trace!", 0xFF0000),
        (remove_party, ":var0"),
        (assign, ":var4", 1),
        (val_sub, "$g_recruiter_count", 1),
      (try_end),
      (eq, ":var4", 0),
      (party_get_num_companions, ":var10", ":var0"),
      (val_sub, ":var10", 1),
      (party_get_slot, ":var11", ":var0", 291),
      (lt, ":var10", ":var1"),
      (try_begin),
        (get_party_ai_object, ":var12", ":var0"),
        (get_party_ai_behavior, ":var13", ":var0"),
        (try_begin),
          (neq, ":var13", 0),
          (neq, ":var12", -1),
          (party_set_slot, ":var12", 290, 0),
        (try_end),
        (assign, ":var14", 999999),
        (assign, ":var15", -1),
        (try_for_range, ":var16", "p_village_1_1", "p_salt_mine"),
          (store_distance_to_party_from_party, ":var17", ":var0", ":var16"),
          (lt, ":var17", ":var14"),
          (try_begin),
            (store_faction_of_party, ":var18", ":var16"),
            (assign, ":var19", 100),
            (try_begin),
              (neq, ":var18", "$players_kingdom"),
              (store_relation, ":var19", "$players_kingdom", ":var18"),
            (try_end),
            (ge, ":var19", 0),
            (party_get_slot, ":var20", ":var16", 26),
            (ge, ":var20", 0),
            (party_get_slot, ":var21", ":var16", 93),
            (gt, ":var21", 0),
            (party_get_slot, ":var22", ":var16", 61),
            (party_get_slot, ":var23", ":var16", 19),
            (assign, ":var24", 1),
            (try_begin),
              (eq, ":var11", -1),
              (assign, ":var24", 0),
            (else_try),
              (eq, ":var23", ":var11"),
              (assign, ":var24", 0),
            (try_end),
            (neq, ":var24", 1),
            (neg|party_slot_eq, ":var16", 35, 2),
            (neg|party_slot_eq, ":var16", 35, 1),
            (neg|party_slot_ge, ":var16", 39, 1),
            (neg|party_slot_eq, ":var16", 290, 1),
            (assign, ":var14", ":var17"),
            (assign, ":var15", ":var16"),
          (try_end),
        (try_end),
        (gt, ":var15", -1),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var15"),
        (party_set_slot, ":var0", 5, ":var15"),
        (party_set_slot, ":var15", 290, 1),
      (try_end),
      (party_get_slot, ":var25", ":var0", 5),
      (gt, ":var25", -1),
      (store_distance_to_party_from_party, ":var26", ":var0", ":var25"),
      (try_begin),
        (store_faction_of_party, ":var27", ":var25"),
        (assign, ":var19", 100),
        (try_begin),
          (neq, ":var27", "$players_kingdom"),
          (store_relation, ":var19", "$players_kingdom", ":var27"),
        (try_end),
        (ge, ":var19", 0),
        (party_get_slot, ":var28", ":var25", 26),
        (ge, ":var28", 0),
        (call_script, "script_raf_aor_faction_to_region", ":var22"),
        (assign, ":var29", reg0),
        (assign, ":var24", 1),
        (try_begin),
          (eq, ":var11", -1),
          (assign, ":var24", 0),
        (else_try),
          (eq, ":var29", ":var11"),
          (assign, ":var24", 0),
        (try_end),
        (neq, ":var24", 1),
        (neg|party_slot_eq, ":var25", 35, 2),
        (neg|party_slot_eq, ":var25", 35, 1),
        (neg|party_slot_ge, ":var25", 39, 1),
        (le, ":var26", 0),
        (party_get_slot, ":var30", ":var25", 93),
        (party_get_slot, ":var31", ":var25", 92),
        (assign, ":var32", ":var1"),
        (val_sub, ":var32", ":var10"),
        (try_begin),
          (gt, ":var30", ":var32"),
          (assign, ":var33", ":var30"),
          (val_sub, ":var33", ":var32"),
          (assign, ":var34", ":var30"),
          (val_sub, ":var34", ":var33"),
          (assign, ":var35", ":var30"),
          (val_sub, ":var35", ":var34"),
          (party_set_slot, ":var25", 93, ":var35"),
          (party_add_members, ":var0", ":var31", ":var34"),
          (party_set_ai_behavior, ":var0", ai_bhvr_hold),
          (party_set_slot, ":var25", 290, 0),
        (else_try),
          (le, ":var30", ":var32"),
          (gt, ":var30", 0),
          (party_set_slot, ":var25", 93, -1),
          (party_add_members, ":var0", ":var31", ":var30"),
          (party_set_ai_behavior, ":var0", ai_bhvr_hold),
          (party_set_slot, ":var25", 290, 0),
        (else_try),
          (le, ":var30", 0),
          (party_set_ai_behavior, ":var0", ai_bhvr_hold),
          (party_set_slot, ":var25", 290, 0),
        (else_try),
          (display_message, "@ERROR IN THE RECRUITER KIT SIMPLE TRIGGERS!", 0xFF2222),
          (party_set_slot, ":var25", 290, 0),
        (try_end),
      (try_end),
    (try_end),
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 22),
      (party_get_num_companions, ":var10", ":var0"),
      (val_sub, ":var10", 1),
      (party_get_slot, ":var1", ":var0", 288),
      (eq, ":var10", ":var1"),
      (party_get_slot, ":var8", ":var0", 289),
      (try_begin),
        (neg|party_slot_eq, ":var0", 5, ":var8"),
        (party_set_slot, ":var0", 5, ":var8"),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var8"),
      (try_end),
      (store_distance_to_party_from_party, ":var36", ":var0", ":var8"),
      (try_begin),
        (le, ":var36", 0),
        (party_get_num_companion_stacks, ":var2", ":var0"),
        (try_for_range, ":var5", 1, ":var2"),
          (party_stack_get_size, ":var37", ":var0", ":var5"),
          (party_stack_get_troop_id, ":var6", ":var0", ":var5"),
          (party_add_members, ":var8", ":var6", ":var37"),
        (try_end),
        (str_store_party_name_link, s13, ":var8"),
        (assign, reg10, ":var10"),
        (display_log_message, "@A recruiter has brought {reg10} recruits to {s13}.", 0x00FF00),
        (remove_party, ":var0"),
        (val_sub, "$g_recruiter_count", 1),
      (try_end),
    (try_end),
  ]),

  (0.056,
  [
    (try_begin),
      (lt, "$g_recruiter_reserved_cur_village", "p_village_1_1"),
      (assign, "$g_recruiter_reserved_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_recruiter_reserved_cur_village", "p_salt_mine"),
      (assign, "$g_recruiter_reserved_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (party_set_slot, "$g_recruiter_reserved_cur_village", 290, 0),
    (try_end),
    (val_add, "$g_recruiter_reserved_cur_village", 1),
    (val_add, "$g_simple_trigger_fire_count_36", 1),
  ]),

  (2,
  [
    (eq, "$g_player_chancellor", "trp_dplmc_chancellor"),
    (gt, "$g_gift_caravan_count", 0),
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 23),
      (party_is_active, ":var0"),
      (party_get_slot, ":var1", ":var0", 5),
      (party_get_slot, ":var2", ":var0", 246),
      (try_begin),
        (party_is_active, ":var1"),
        (store_distance_to_party_from_party, ":var3", ":var0", ":var1"),
        (str_store_party_name, s14, ":var0"),
        (str_store_party_name, s15, ":var1"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg0, ":var3"),
          (display_message, "@Distance between {s14} and {s15}: {reg0}"),
        (try_end),
        (try_begin),
          (le, ":var3", 1),
          (party_get_slot, ":var4", ":var0", 286),
          (str_store_item_name, s12, ":var4"),
          (try_begin),
            (gt, ":var2", 0),
            (str_store_troop_name, s13, ":var2"),
          (else_try),
            (str_store_party_name, s13, ":var1"),
          (try_end),
          (display_log_message, "@Your caravan has brought {s12} to {s13}.", 0x00FF00),
          (assign, ":var5", 0),
          (store_faction_of_party, ":var6", ":var1"),
          (try_begin),
            (gt, ":var2", 0),
            (faction_slot_eq, ":var6", 11, ":var2"),
            (try_begin),
              (eq, ":var4", "itm_wine"),
              (assign, ":var5", 1),
            (else_try),
              (eq, ":var4", "itm_oil"),
              (assign, ":var5", 2),
            (try_end),
          (else_try),
            (store_random_in_range, ":var7", 1, 3),
            (try_begin),
              (eq, ":var4", "itm_ale"),
              (val_add, ":var5", ":var7"),
            (else_try),
              (eq, ":var4", "itm_wine"),
              (store_add, ":var5", 1, ":var7"),
            (else_try),
              (eq, ":var4", "itm_oil"),
              (store_add, ":var5", 2, ":var7"),
            (else_try),
              (eq, ":var4", "itm_raw_dyes"),
              (val_add, ":var5", 1),
            (else_try),
              (eq, ":var4", "itm_raw_silk"),
              (val_add, ":var5", 2),
            (else_try),
              (eq, ":var4", "itm_velvet"),
              (val_add, ":var5", 4),
            (else_try),
              (eq, ":var4", "itm_smoked_fish"),
              (try_begin),
                (party_slot_eq, ":var1", 0, 4),
                (val_add, ":var5", 1),
              (try_end),
            (else_try),
              (eq, ":var4", "itm_cheese"),
              (val_add, ":var5", 1),
              (try_begin),
                (party_slot_eq, ":var1", 0, 4),
                (val_add, ":var5", 1),
              (try_end),
            (else_try),
              (eq, ":var4", "itm_honey"),
              (val_add, ":var5", 2),
              (try_begin),
                (party_slot_eq, ":var1", 0, 4),
                (val_add, ":var5", 2),
              (try_end),
            (try_end),
          (try_end),
          (try_begin),
            (this_or_next|eq, ":var6", "fac_player_supporters_faction"),
            (eq, ":var6", "$players_kingdom"),
            (val_add, ":var5", 1),
          (try_end),
          (try_begin),
            (gt, ":var2", 0),
            (call_script, "script_change_player_relation_with_troop", ":var2", ":var5"),
          (else_try),
            (call_script, "script_change_player_relation_with_center", ":var1", ":var5"),
          (try_end),
          (remove_party, ":var0"),
          (val_sub, "$g_gift_caravan_count", 1),
        (try_end),
      (else_try),
        (display_log_message, "@Your caravan has lost its way and gave up your mission!", 0xFF0000),
        (remove_party, ":var0"),
        (val_sub, "$g_gift_caravan_count", 1),
      (try_end),
    (try_end),
  ]),

  (2,
  [
    (gt, "$g_player_messenger_count", 0),
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 25),
      (party_get_slot, ":var1", ":var0", 5),
      (party_get_slot, ":var2", ":var0", 246),
      (try_begin),
        (party_is_active, ":var1"),
        (store_distance_to_party_from_party, ":var3", ":var0", ":var1"),
        (str_store_party_name, s14, ":var0"),
        (str_store_party_name, s15, ":var1"),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (assign, reg0, ":var3"),
          (display_message, "@Distance between {s14} and {s15}: {reg0}"),
        (try_end),
        (try_begin),
          (le, ":var3", 1),
          (try_begin),
            (eq, ":var1", "p_main_party"),
            (party_get_slot, ":var4", ":var0", 246),
            (party_get_slot, ":var5", ":var0", 286),
            (call_script, "script_add_notification_menu", "mnu_dplmc_messenger", ":var4", ":var5"),
            (remove_party, ":var0"),
            (val_sub, "$g_player_messenger_count", 1),
          (else_try),
            (party_stack_get_troop_id, ":var4", ":var1", 0),
            (str_store_troop_name, s13, ":var4"),
            (try_begin),
              (eq, "$cheat_mode", 1),
              (display_log_message, "@Your messenger reached {s13}.", 0x00FF00),
              (assign, "$g_talk_troop", ":var4"),
            (try_end),
            (party_get_slot, ":var6", ":var0", 286),
            (assign, ":var5", 0),
            (try_begin),
              (party_set_slot, ":var1", 30, "p_main_party"),
              (store_current_hours, ":var7"),
              (party_set_slot, ":var1", 244, "trp_kingdom_heroes_including_player_begin"),
              (party_set_slot, ":var1", 246, ":var2"),
              (party_set_slot, ":var1", 245, ":var6"),
              (party_set_slot, ":var1", 247, ":var7"),
              (call_script, "script_npc_decision_checklist_party_ai", ":var4"),
              (try_begin),
                (eq, "$cheat_mode", 1),
                (display_message, "@{s14}"),
              (try_end),
              (try_begin),
                (eq, reg0, ":var6"),
                (eq, reg1, ":var2"),
                (assign, ":var5", 1),
              (try_end),
              (call_script, "script_party_set_ai_state", ":var1", reg0, reg1),
            (try_end),
            (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
            (party_set_ai_object, ":var0", "p_main_party"),
            (party_set_slot, ":var0", 5, "p_main_party"),
            (party_set_slot, ":var0", 246, ":var4"),
            (party_set_slot, ":var0", 286, ":var5"),
          (try_end),
        (try_end),
      (else_try),
        (display_log_message, "@Your messenger has lost it's way and gave up your mission!", 0xFF0000),
        (remove_party, ":var0"),
        (val_sub, "$g_player_messenger_count", 1),
      (try_end),
    (try_end),
  ]),

  (6,
  [
    (try_for_parties, ":var0"),
      (party_get_template_id, ":var1", ":var0"),
      (this_or_next|party_slot_eq, ":var0", 0, 69),
      (this_or_next|eq, ":var1", "pt_peasant_rebels_euro"),
      (this_or_next|eq, ":var1", "pt_guelphs"),
      (this_or_next|eq, ":var1", "pt_ghibellines"),
      (this_or_next|eq, ":var1", "pt_prussians"),
      (this_or_next|eq, ":var1", "pt_yotvingians"),
      (this_or_next|eq, ":var1", "pt_curonians"),
      (this_or_next|eq, ":var1", "pt_samogitians"),
      (this_or_next|eq, ":var1", "pt_welsh"),
      (this_or_next|eq, ":var1", "pt_mongolian_camp"),
      (this_or_next|eq, ":var1", "pt_patrol_party"),
      (this_or_next|eq, ":var1", "pt_rogue_mercenaries"),
      (this_or_next|eq, ":var1", "pt_rebels"),
      (this_or_next|eq, ":var1", "pt_jihadist_raiders"),
      (this_or_next|eq, ":var1", "pt_teutonic_raiders"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_iberian"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_scandinavian"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_euro"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_italian"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_welsh"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_gaelic"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_teutonic"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_templar"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_hospitaller"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_saint_lazarus"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_santiago"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_calatrava"),
      (this_or_next|eq, ":var1", "pt_escaped_prisoners_party"),
      (this_or_next|eq, ":var1", "pt_crusader_raiders_saint_thomas"),
      (eq, ":var1", "pt_sea_raiders"),
      (party_is_active, ":var0"),
      (party_get_battle_opponent, ":var2", ":var0"),
      (try_begin),
        (lt, ":var2", 0),
        (party_get_slot, ":var3", ":var0", 5),
        (gt, ":var3", 0),
        (party_is_active, ":var3"),
        (try_begin),
          (store_distance_to_party_from_party, ":var4", ":var0", ":var3"),
          (gt, ":var4", 15),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_point),
          (party_get_position, pos5, ":var3"),
          (party_set_ai_target_position, ":var0", pos5),
        (else_try),
          (get_party_ai_behavior, ":var5", ":var0"),
          (eq, ":var5", 6),
          (try_begin),
            (store_distance_to_party_from_party, ":var4", ":var0", ":var3"),
            (lt, ":var4", 3),
            (party_set_ai_behavior, ":var0", ai_bhvr_patrol_location),
            (party_set_ai_object, ":var0", ":var3"),
            (party_set_ai_patrol_radius, ":var0", 15),
            (party_set_slot, ":var0", 5, ":var3"),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (2,
  [
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 69),
      (party_is_active, ":var0"),
      (try_begin),
        (get_party_ai_behavior, ":var1", ":var0"),
        (eq, ":var1", 1),
        (party_get_slot, ":var2", ":var0", 5),
        (try_begin),
          (gt, ":var2", 0),
          (store_distance_to_party_from_party, ":var3", ":var0", ":var2"),
          (le, ":var3", 5),
          (try_begin),
            (party_get_slot, ":var4", ":var0", 4),
            (eq, ":var4", 14),
            (try_begin),
              (le, ":var3", 1),
              (call_script, "script_party_add_party", ":var2", ":var0"),
              (remove_party, ":var0"),
            (try_end),
          (else_try),
            (party_get_position, pos1, ":var2"),
            (party_set_ai_behavior, ":var0", ai_bhvr_patrol_location),
            (party_set_ai_patrol_radius, ":var0", 1),
            (party_set_ai_target_position, ":var0", pos1),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (gt, "$g_raf_spt_messenger", 0),
    (try_for_parties, ":var0"),
      (party_slot_eq, ":var0", 0, 26),
      (party_get_slot, ":var2", ":var0", 5),
      (party_get_slot, ":var5", ":var0", 246),
      (troop_get_slot, ":var6", ":var5", 12),
      (party_get_slot, ":var7", ":var0", 123),
      (party_get_slot, ":var8", ":var0", 61),
      (try_begin),
        (gt, "$players_kingdom", 0),
        (neq, "$players_kingdom", ":var8"),
        (party_set_faction, ":var0", "$players_kingdom"),
        (party_set_slot, ":var0", 61, "$players_kingdom"),
      (else_try),
        (neq, "fac_player_faction", ":var8"),
        (le, "$players_kingdom", 0),
        (party_set_faction, ":var0", "fac_player_faction"),
        (party_set_slot, ":var0", 61, "fac_player_faction"),
      (try_end),
      (try_begin),
        (neq, ":var6", ":var2"),
        (neq, ":var2", ":var7"),
        (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
        (party_set_ai_object, ":var0", ":var6"),
        (party_set_slot, ":var0", 5, ":var6"),
      (else_try),
        (store_distance_to_party_from_party, ":var3", ":var0", ":var2"),
        (try_begin),
          (le, ":var3", 1),
          (neq, ":var2", ":var7"),
          (str_store_party_name, s25, ":var7"),
          (str_store_troop_name, s26, ":var5"),
          (display_message, "@Your messenger has delivered his message to {s26} and is on his way back to {s25}", 0x00FF00),
          (party_add_members, ":var0", ":var5", 1),
          (troop_set_slot, ":var5", 12, ":var0"),
          (troop_set_slot, ":var5", 159, 1),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var0", ":var7"),
          (party_set_slot, ":var0", 5, ":var7"),
        (else_try),
          (le, ":var3", 1),
          (eq, ":var2", ":var7"),
          (troop_set_slot, ":var5", 12, ":var7"),
          (str_store_party_name, s25, ":var7"),
          (str_store_troop_name, s26, ":var5"),
          (display_message, "@{s26} has arrived in {s25} and is awaiting you there.", 0x00FF00),
          (remove_party, ":var0"),
          (val_sub, "$g_raf_spt_messenger", 1),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (6,
  [
    (eq, "$g_battle_preparation_phase", 2),
    (party_set_slot, "$g_battle_preparation", 250, 1),
    (try_for_parties, ":var0"),
      (str_store_party_name, s20, ":var0"),
      (neq, ":var0", "$g_battle_preparation"),
      (neq, ":var0", "p_main_party"),
      (neg|party_slot_eq, ":var0", 250, 1),
      (this_or_next|party_slot_eq, ":var0", 0, 69),
      (this_or_next|party_slot_eq, ":var0", 0, 30),
      (party_slot_eq, ":var0", 0, 13),
      (party_is_active, ":var0"),
      (party_get_battle_opponent, ":var1", ":var0"),
      (lt, ":var1", 0),
      (party_get_attached_to, ":var2", ":var0"),
      (lt, ":var2", 0),
      (get_party_ai_behavior, ":var3", ":var0"),
      (neq, ":var3", 8),
      (store_faction_of_party, ":var4", ":var0"),
      (store_relation, ":var5", "fac_player_supporters_faction", ":var4"),
      (this_or_next|eq, ":var4", "$players_kingdom"),
      (lt, ":var5", 0),
      (store_distance_to_party_from_party, ":var6", ":var0", "p_main_party"),
      (le, ":var6", 5),
      (party_set_slot, ":var0", 250, 1),
    (try_end),
    (try_begin),
      (map_free),
      (rest_for_hours, 12, 3, 0),
    (try_end),
    (store_current_hours, ":var7"),
    (store_sub, ":var8", ":var7", "$g_battle_preparation_start"),
    (ge, ":var8", 12),
    (assign, "$g_battle_preparation_phase", 3),
    (assign, "$g_battle_preparation_start", ":var7"),
  ]),

  (0,
  [
    (is_between, "$g_player_sally_town", "p_town_1_1", "p_salt_mine"),
    (party_is_active, "$g_player_sallies"),
    (start_encounter, "$g_player_sallies"),
  ]),

  (4,
  [
    (party_get_current_terrain, ":var0", "p_main_party"),
    (try_begin),
      (this_or_next|eq, ":var0", 4),
      (eq, ":var0", 12),
      (assign, "$tom_sand_storm_chance", 20),
      (set_global_haze_amount, 0),
      (store_random_in_range, ":var1", 25, 101),
      (set_global_cloud_amount, ":var1"),
    (else_try),
      (this_or_next|eq, ":var0", 3),
      (eq, ":var0", 11),
      (assign, "$tom_sand_storm_chance", 15),
      (store_random_in_range, ":var1", 0, 101),
      (set_global_haze_amount, ":var1"),
      (store_random_in_range, ":var1", 15, 100),
      (set_global_cloud_amount, ":var1"),
    (else_try),
      (this_or_next|eq, ":var0", 2),
      (eq, ":var0", 10),
      (assign, "$tom_sand_storm_chance", 10),
      (store_random_in_range, ":var1", 0, 50),
      (set_global_haze_amount, ":var1"),
      (store_random_in_range, ":var1", 0, 80),
      (set_global_cloud_amount, ":var1"),
    (else_try),
      (this_or_next|eq, ":var0", 5),
      (eq, ":var0", 13),
      (assign, "$tom_sand_storm_chance", 25),
      (set_global_haze_amount, 0),
      (set_global_cloud_amount, 0),
    (else_try),
      (assign, "$tom_sand_storm_chance", 15),
      (store_random_in_range, ":var1", 0, 101),
      (set_global_haze_amount, ":var1"),
      (store_random_in_range, ":var1", 0, 101),
      (set_global_cloud_amount, ":var1"),
    (try_end),
  ]),

  (168,
  [
    (troop_get_slot, ":var0", "trp_manor_array", 0),
    (try_for_range, ":var1", 1, ":var0"),
      (troop_get_slot, ":var2", "trp_manor_array", ":var1"),
      (party_get_slot, ":var3", ":var2", 120),
      (neg|this_or_next|party_slot_eq, ":var3", 35, 2),
      (party_slot_eq, ":var2", 327, 1),
      (party_get_slot, ":var4", ":var3", 7),
      (party_get_slot, ":var5", ":var2", 50),
      (party_get_slot, ":var6", ":var2", 342),
      (party_get_slot, ":var7", ":var2", 341),
      (party_get_slot, ":var8", ":var2", 367),
      (assign, ":var9", 0),
      (try_begin),
        (store_faction_of_party, ":var10", ":var3"),
        (party_set_faction, ":var2", ":var10"),
        (party_set_slot, ":var2", 7, ":var4"),
      (try_end),
      (assign, ":var11", 0),
      (try_for_range, ":var12", 303, 328),
        (party_slot_eq, ":var2", ":var12", 2),
        (party_set_slot, ":var2", ":var12", 1),
        (try_begin),
          (this_or_next|eq, ":var12", 303),
          (this_or_next|eq, ":var12", 306),
          (this_or_next|eq, ":var12", 305),
          (eq, ":var12", 304),
          (val_add, ":var11", 15),
        (else_try),
          (eq, ":var12", 307),
          (val_add, ":var11", 10),
        (try_end),
        (try_begin),
          (eq, ":var4", "trp_player"),
          (str_store_party_name, s21, ":var3"),
          (try_begin),
            (eq, ":var12", 305),
            (display_message, "@Peasants rejoice of your whorehouse in the regional manor at {s21}. You gain fame!"),
            (call_script, "script_change_troop_renown", "trp_player", 5),
          (else_try),
            (this_or_next|eq, ":var12", 322),
            (this_or_next|eq, ":var12", 323),
            (this_or_next|eq, ":var12", 324),
            (this_or_next|eq, ":var12", 325),
            (this_or_next|eq, ":var12", 326),
            (eq, ":var12", 327),
            (display_message, "@You gain right to rule for building an important building in your regional manor at {s21}!"),
            (call_script, "script_change_player_right_to_rule", 1),
          (else_try),
            (display_message, "@You gain renown for funding a building in your regional manor at {s21}."),
            (call_script, "script_change_troop_renown", "trp_player", 10),
          (try_end),
        (try_end),
      (try_end),
      (try_for_range, ":var12", 303, 328),
        (party_slot_eq, ":var2", ":var12", 1),
        (store_sub, ":var13", ":var12", 308),
        (val_add, ":var13", "trp_manor_grain"),
        (assign, ":var14", 0),
        (assign, ":var15", -1),
        (assign, ":var16", -1),
        (troop_get_slot, ":var17", ":var13", 160),
        (party_get_slot, ":var18", ":var2", ":var17"),
        (assign, ":var19", 0),
        (try_begin),
          (is_between, ":var12", 308, 312),
          (try_begin),
            (this_or_next|neq, ":var4", "trp_player"),
            (eq, ":var18", 0),
            (val_add, ":var14", 30),
            (val_add, ":var19", 30),
          (else_try),
            (eq, ":var18", 1),
            (troop_get_slot, ":var15", ":var13", 161),
            (assign, ":var16", 4),
          (try_end),
        (else_try),
          (this_or_next|eq, ":var12", 303),
          (this_or_next|eq, ":var12", 304),
          (eq, ":var12", 305),
          (val_add, ":var14", 50),
          (val_add, ":var19", 50),
        (else_try),
          (is_between, ":var12", 312, 322),
          (try_begin),
            (this_or_next|neq, ":var4", "trp_player"),
            (eq, ":var18", 0),
            (val_add, ":var14", 80),
            (val_add, ":var19", 80),
          (else_try),
            (this_or_next|neq, ":var4", "trp_player"),
            (eq, ":var18", 1),
            (troop_get_slot, ":var15", ":var13", 161),
            (assign, ":var16", 3),
          (try_end),
        (else_try),
          (is_between, ":var12", 323, 327),
          (val_add, ":var14", 100),
        (try_end),
        (try_begin),
          (ge, ":var14", 1),
          (store_random_in_range, ":var20", -5, 5),
          (val_add, ":var14", ":var20"),
          (val_add, ":var9", ":var14"),
          (val_add, ":var19", ":var20"),
        (try_end),
        (try_begin),
          (eq, "$cheat_mode", 1),
          (eq, ":var4", "trp_player"),
          (str_store_troop_name, s1, ":var13"),
          (assign, reg1, ":var19"),
          (display_message, "@MANOR troop: {s1} pays {reg1} gold"),
        (try_end),
        (ge, ":var16", 0),
        (ge, ":var15", 0),
        (try_begin),
          (eq, ":var7", 1),
          (val_div, ":var16", 2),
        (else_try),
          (eq, ":var7", -1),
          (val_mul, ":var16", 3),
          (val_div, ":var16", 2),
        (try_end),
        (troop_ensure_inventory_space, "trp_manor_array", ":var16"),
        (troop_add_items, "trp_manor_array", ":var15", ":var16"),
      (try_end),
      (try_begin),
        (party_slot_eq, ":var2", 327, 1),
        (val_sub, ":var9", 500),
        (lt, ":var9", 0),
        (assign, ":var9", 0),
      (try_end),
      (val_add, ":var9", ":var6"),
      (try_begin),
        (party_slot_eq, ":var2", 302, 0),
        (val_clamp, ":var6", 20, 200),
      (else_try),
        (party_slot_eq, ":var2", 302, 1),
        (val_clamp, ":var6", 20, 760),
      (else_try),
        (party_slot_eq, ":var2", 302, 2),
        (val_clamp, ":var6", 20, 1000),
      (try_end),
      (store_random_in_range, ":var20", -5, 6),
      (val_add, ":var6", ":var20"),
      (try_begin),
        (eq, ":var7", 1),
        (val_sub, ":var11", 3),
        (val_add, ":var6", 15),
        (val_mul, ":var9", 3),
        (val_div, ":var9", 2),
      (else_try),
        (eq, ":var7", 0),
        (val_add, ":var11", 1),
        (val_add, ":var6", 40),
      (else_try),
        (eq, ":var7", -1),
        (val_add, ":var11", 2),
        (val_add, ":var6", 50),
        (val_div, ":var9", 2),
      (try_end),
      (val_clamp, ":var11", 0, 100),
      (try_begin),
        (assign, ":var21", ":var5"),
        (val_clamp, ":var21", 5, 100),
        (val_mul, ":var9", ":var21"),
        (val_div, ":var9", 100),
      (try_end),
      (try_begin),
        (party_set_slot, ":var2", 344, -1),
        (party_slot_eq, ":var2", 303, 1),
        (ge, ":var5", 50),
        (ge, ":var6", 700),
        (store_random_in_range, ":var22", "trp_manor_trader_silk", "trp_temp_lord"),
        (party_set_slot, ":var2", 344, ":var22"),
        (troop_get_slot, ":var23", ":var22", 161),
        (troop_clear_inventory, ":var22"),
        (store_random_in_range, ":var20", 5, 10),
        (troop_add_items, ":var22", ":var23", ":var20"),
        (store_troop_gold, ":var24", ":var22"),
        (troop_remove_gold, ":var22", ":var24"),
        (store_random_in_range, ":var24", 200, 800),
        (troop_add_gold, ":var22", ":var24"),
      (try_end),
      (try_begin),
        (party_slot_eq, ":var2", 340, 1),
        (store_random_in_range, ":var25", "itm_book_tactics", "itm_spice"),
        (troop_clear_inventory, "trp_manor_trader_book"),
        (troop_add_items, "trp_manor_trader_book", ":var25", 1),
        (store_random_in_range, ":var25", "itm_book_tactics", "itm_spice"),
        (troop_add_items, "trp_manor_trader_book", ":var25", 1),
        (store_random_in_range, ":var25", "itm_book_tactics", "itm_spice"),
        (troop_add_items, "trp_manor_trader_book", ":var25", 1),
        (store_troop_gold, ":var24", "trp_manor_trader_book"),
        (troop_remove_gold, "trp_manor_trader_book", ":var24"),
        (store_random_in_range, ":var24", 200, 300),
        (troop_add_gold, "trp_manor_trader_book", ":var24"),
      (try_end),
      (val_add, ":var8", ":var9"),
      (try_begin),
        (eq, "$cheat_mode", 1),
        (eq, ":var4", "trp_player"),
        (assign, reg0, ":var9"),
        (assign, reg1, ":var8"),
        (display_message, "@final gold :{reg0}, manor gold: {reg1}"),
      (try_end),
      (val_add, ":var11", ":var5"),
      (val_clamp, ":var11", 0, 100),
      (party_set_slot, ":var2", 50, ":var11"),
      (party_set_slot, ":var2", 342, ":var6"),
      (party_set_slot, ":var2", 343, ":var9"),
      (party_set_slot, ":var2", 367, ":var8"),
      (try_begin),
        (eq, ":var4", "trp_player"),
        (gt, ":var8", 0),
        (assign, reg0, ":var9"),
        (str_store_party_name_link, s6, ":var3"),
        (call_script, "script_dplmc_pay_into_treasury_no_comment", ":var8"),
        (display_message, "@{reg0} coins collected from {s6}'s manor added to treasury."),
        (party_set_slot, ":var2", 367, 0),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (troop_get_slot, ":var0", "trp_manor_array", 0),
    (try_for_range, ":var1", 1, ":var0"),
      (troop_get_slot, ":var2", "trp_manor_array", ":var1"),
      (party_get_slot, ":var3", ":var2", 120),
      (party_get_slot, ":var4", ":var3", 7),
      (neq, ":var4", "trp_player"),
      (neg|party_slot_eq, ":var3", 35, 2),
      (party_get_slot, ":var5", ":var2", 367),
      (ge, ":var5", 2000),
      (try_begin),
        (store_random_in_range, ":var6", 308, 312),
        (party_slot_eq, ":var2", ":var6", 0),
        (party_set_slot, ":var2", ":var6", 1),
        (val_sub, ":var5", 2000),
      (else_try),
        (ge, ":var5", 3000),
        (store_random_in_range, ":var6", 303, 308),
        (party_slot_eq, ":var2", ":var6", 0),
        (party_set_slot, ":var2", ":var6", 1),
        (val_sub, ":var5", 3000),
      (else_try),
        (ge, ":var5", 6000),
        (store_random_in_range, ":var6", 303, 308),
        (party_slot_eq, ":var2", ":var6", 0),
        (party_set_slot, ":var2", ":var6", 1),
        (val_sub, ":var5", 6000),
      (else_try),
        (ge, ":var5", 10000),
        (store_random_in_range, ":var6", 303, 308),
        (party_slot_eq, ":var2", ":var6", 0),
        (party_set_slot, ":var2", ":var6", 1),
        (val_sub, ":var5", 10000),
      (try_end),
      (party_set_slot, ":var2", 367, ":var5"),
    (try_end),
  ]),

  (72,
  [
    (try_for_range, ":var0", 3469, 3490),
      (store_random_in_range, ":var1", "p_town_1_1", "p_castle_1_1"),
      (troop_set_slot, ":var0", 12, ":var1"),
      (troop_clear_inventory, ":var0"),
      (try_begin),
        (is_between, ":var0", "trp_trader_hat1", "trp_trader_sword1"),
        (try_for_range, reg0, 0, 32),
          (store_random_in_range, ":var2", "itm_head_wrappings", "itm_head_african"),
          (troop_add_item, ":var0", ":var2"),
          (store_random_in_range, ":var3", "itm_nomad_cap", "itm_wooden_shield"),
          (troop_add_item, ":var0", ":var3"),
        (try_end),
      (else_try),
        (is_between, ":var0", "trp_trader_sword1", "trp_trader_helmet1"),
        (try_for_range, reg0, 0, 25),
          (store_random_in_range, ":var4", 0, 4),
          (try_begin),
            (eq, ":var4", 0),
            (store_random_in_range, ":var2", "itm_spatha", "itm_military_cleaver_b"),
            (troop_add_item, ":var0", ":var2"),
          (else_try),
            (eq, ":var4", 1),
            (store_random_in_range, ":var2", "itm_sword_viking_1", "itm_military_hammer"),
            (troop_add_item, ":var0", ":var2"),
          (else_try),
            (eq, ":var4", 2),
            (store_random_in_range, ":var2", "itm_baltic_sword", "itm_iberian_cleaver"),
            (troop_add_item, ":var0", ":var2"),
          (else_try),
            (eq, ":var4", 3),
            (store_random_in_range, ":var2", "itm_alsacian_sword", "itm_modded_club"),
            (troop_add_item, ":var0", ":var2"),
          (try_end),
        (try_end),
      (else_try),
        (is_between, ":var0", "trp_trader_helmet1", "trp_trader_spice1"),
        (try_for_range, reg0, 0, 30),
          (store_random_in_range, ":var2", "itm_elm8", "itm_african_turban"),
          (troop_add_item, ":var0", ":var2"),
        (try_end),
      (else_try),
        (is_between, ":var0", "trp_trader_spice1", "trp_trader_silk1"),
        (try_for_range, reg0, 0, 10),
          (troop_add_item, ":var0", "itm_spice"),
          (troop_add_item, ":var0", "itm_salt"),
        (try_end),
      (else_try),
        (is_between, ":var0", "trp_trader_silk1", "trp_maid_1"),
        (try_for_range, reg0, 0, 10),
          (troop_add_item, ":var0", "itm_raw_silk"),
          (troop_add_item, ":var0", "itm_velvet"),
        (try_end),
      (try_end),
      (store_troop_gold, reg6, ":var0"),
      (troop_remove_gold, ":var0", reg6),
      (store_random_in_range, ":var5", 2000, 3500),
      (call_script, "script_troop_add_gold", ":var0", ":var5"),
    (try_end),
  ]),

  (24,
  [
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_set_slot, ":var0", 400, 0),
      (faction_slot_eq, ":var0", 21, 0),
      (call_script, "script_check_if_faction_is_at_war", ":var0"),
      (faction_set_slot, ":var0", 400, reg0),
    (try_end),
  ]),

  (0.23,
  [
    (try_begin),
      (lt, "$g_change_prosperity_cur_center", "p_town_1_1"),
      (assign, "$g_change_prosperity_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_change_prosperity_cur_center", "p_salt_mine"),
      (assign, "$g_change_prosperity_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (store_faction_of_party, ":var0", "$g_change_prosperity_cur_center"),
      (faction_get_slot, ":var1", ":var0", 400),
      (party_get_slot, ":var2", "$g_change_prosperity_cur_center", 287),
      (party_get_slot, ":var3", "$g_change_prosperity_cur_center", 7),
      (party_get_slot, ":var4", "$g_change_prosperity_cur_center", 50),
      (assign, reg1, ":var4"),
      (try_begin),
        (eq, ":var1", 0),
        (call_script, "script_change_center_prosperity", "$g_change_prosperity_cur_center", 20),
      (try_end),
      (call_script, "script_change_center_prosperity", "$g_change_prosperity_cur_center", 5),
      (store_mul, ":var5", ":var2", -1),
      (call_script, "script_change_center_prosperity", "$g_change_prosperity_cur_center", ":var5"),
      (val_add, ":var4", ":var5"),
      (neq, ":var3", "trp_player"),
      (try_begin),
        (le, ":var4", 20),
        (gt, ":var2", -2),
        (val_sub, ":var2", 1),
        (party_set_slot, "$g_change_prosperity_cur_center", 287, ":var2"),
      (else_try),
        (ge, ":var4", 99),
        (lt, ":var2", 2),
        (val_add, ":var2", 1),
        (party_set_slot, "$g_change_prosperity_cur_center", 287, ":var2"),
      (else_try),
        (store_random_in_range, ":var6", 0, 10),
        (eq, ":var6", 0),
        (store_random_in_range, ":var6", -2, 3),
        (party_set_slot, "$g_change_prosperity_cur_center", 287, ":var6"),
      (try_end),
    (try_end),
    (val_add, "$g_change_prosperity_cur_center", 1),
    (val_add, "$g_simple_trigger_fire_count_37", 1),
  ]),

  (24,
  [
    (item_set_slot, "itm_bread", 1, 8),
    (item_set_slot, "itm_grain", 1, 2),
    (item_set_slot, "itm_smoked_fish", 1, 4),
    (item_set_slot, "itm_dried_meat", 1, 5),
    (item_set_slot, "itm_cheese", 1, 5),
    (item_set_slot, "itm_sausages", 1, 5),
    (item_set_slot, "itm_butter", 1, 4),
    (item_set_slot, "itm_chicken", 1, 8),
    (item_set_slot, "itm_cattle_meat", 1, 7),
    (item_set_slot, "itm_pork", 1, 6),
    (item_set_slot, "itm_raw_olives", 1, 1),
    (item_set_slot, "itm_cabbages", 1, 2),
    (item_set_slot, "itm_raw_grapes", 1, 3),
    (item_set_slot, "itm_apples", 1, 4),
    (item_set_slot, "itm_raw_date_fruit", 1, 4),
    (item_set_slot, "itm_honey", 1, 6),
    (item_set_slot, "itm_wine", 1, 7),
    (item_set_slot, "itm_ale", 1, 6),
  ]),

  (168,
  [
    (try_begin),
      (eq, "$kaos_restore", 1),
      (assign, ":var0", 1),
      (try_for_range, ":var1", "trp_npc1", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var1", 2, 2),
        (troop_get_slot, ":var2", ":var1", 14),
        (neg|faction_slot_eq, ":var2", 21, 0),
        (try_begin),
          (eq, "$background_answer_3", 8),
          (try_begin),
            (eq, ":var2", "fac_kingdom_1"),
            (eq, "$kaos_kings_kingdom", 1),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_2"),
            (eq, "$kaos_kings_kingdom", 2),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_3"),
            (eq, "$kaos_kings_kingdom", 3),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_4"),
            (eq, "$kaos_kings_kingdom", 4),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_5"),
            (eq, "$kaos_kings_kingdom", 5),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_6"),
            (eq, "$kaos_kings_kingdom", 6),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_7"),
            (eq, "$kaos_kings_kingdom", 7),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_8"),
            (eq, "$kaos_kings_kingdom", 8),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_9"),
            (eq, "$kaos_kings_kingdom", 9),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_10"),
            (eq, "$kaos_kings_kingdom", 10),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_11"),
            (eq, "$kaos_kings_kingdom", 11),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_12"),
            (eq, "$kaos_kings_kingdom", 12),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_13"),
            (eq, "$kaos_kings_kingdom", 13),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_14"),
            (eq, "$kaos_kings_kingdom", 14),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_15"),
            (eq, "$kaos_kings_kingdom", 15),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_16"),
            (eq, "$kaos_kings_kingdom", 16),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_17"),
            (eq, "$kaos_kings_kingdom", 17),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_18"),
            (eq, "$kaos_kings_kingdom", 18),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_19"),
            (eq, "$kaos_kings_kingdom", 19),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_20"),
            (eq, "$kaos_kings_kingdom", 20),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_papacy"),
            (eq, "$kaos_kings_kingdom", 21),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_22"),
            (eq, "$kaos_kings_kingdom", 22),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_23"),
            (eq, "$kaos_kings_kingdom", 23),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_24"),
            (eq, "$kaos_kings_kingdom", 24),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_25"),
            (eq, "$kaos_kings_kingdom", 25),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_26"),
            (eq, "$kaos_kings_kingdom", 26),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_27"),
            (eq, "$kaos_kings_kingdom", 27),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_28"),
            (eq, "$kaos_kings_kingdom", 28),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_29"),
            (eq, "$kaos_kings_kingdom", 29),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_30"),
            (eq, "$kaos_kings_kingdom", 30),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_31"),
            (eq, "$kaos_kings_kingdom", 31),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_32"),
            (eq, "$kaos_kings_kingdom", 32),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_33"),
            (eq, "$kaos_kings_kingdom", 33),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_34"),
            (eq, "$kaos_kings_kingdom", 34),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_35"),
            (eq, "$kaos_kings_kingdom", 35),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_36"),
            (eq, "$kaos_kings_kingdom", 36),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_37"),
            (eq, "$kaos_kings_kingdom", 37),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_38"),
            (eq, "$kaos_kings_kingdom", 38),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_39"),
            (eq, "$kaos_kings_kingdom", 39),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_40"),
            (eq, "$kaos_kings_kingdom", 40),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_41"),
            (eq, "$kaos_kings_kingdom", 41),
            (assign, ":var0", 0),
          (else_try),
            (eq, ":var2", "fac_kingdom_42"),
            (eq, "$kaos_kings_kingdom", 42),
            (assign, ":var0", 0),
          (try_end),
        (else_try),
          (is_between, ":var2", "fac_player_supporters_faction", "fac_kingdoms_end"),
          (assign, ":var0", 1),
        (try_end),
        (try_begin),
          (eq, ":var0", 1),
          (store_faction_of_troop, ":var3", ":var1"),
          (neq, ":var3", "fac_player_supporters_faction"),
          (store_faction_of_troop, ":var4", ":var1"),
          (neq, ":var4", ":var2"),
          (assign, ":var5", 0),
          (try_for_range, ":var6", "p_town_1_1", "p_village_1_1"),
            (party_slot_eq, ":var6", 7, ":var1"),
            (val_add, ":var5", 1),
          (try_end),
          (gt, ":var5", 0),
          (store_sub, ":var7", ":var2", 42),
          (val_add, ":var7", "trp_kingdom_1_lord"),
          (faction_set_slot, ":var2", 11, ":var7"),
          (call_script, "script_change_troop_faction", ":var1", ":var2"),
          (try_for_range, ":var1", "trp_npc1", "trp_knight_1_1_wife"),
            (troop_slot_eq, ":var1", 2, 2),
            (neg|is_between, ":var1", "trp_npc29", "trp_knight_1_1"),
            (neq, ":var1", ":var1"),
            (troop_get_slot, ":var8", ":var1", 14),
            (store_faction_of_troop, ":var4", ":var1"),
            (eq, ":var8", ":var2"),
            (neq, ":var4", ":var2"),
            (troop_set_slot, ":var1", 55, ":var2"),
          (try_end),
          (call_script, "script_add_notification_menu", "mnu_notification_kingdom_restoration", ":var1", ":var4"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (2,
  [
    (val_add, "$g_party_garrison_reinforcement_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_garrison_reinforcement_rate_hours_passed", "$g_party_garrison_reinforcement_rate"),
      (assign, "$g_party_garrison_reinforcement_rate_hours_passed", 0),
      (try_for_range, ":var0", "p_town_1_1", "p_village_1_1"),
        (neg|party_slot_eq, ":var0", 7, "trp_player"),
        (party_set_slot, ":var0", 258, 0),
      (try_end),
      (try_for_range, ":var0", "p_town_1_1", "p_village_1_1"),
        (party_slot_ge, ":var0", 7, 0),
        (party_slot_eq, ":var0", 54, -1),
        (party_slot_eq, ":var0", 258, 0),
        (assign, ":var1", "$g_party_garrison_max_size_castles"),
        (try_begin),
          (is_between, ":var0", "p_town_1_1", "p_castle_1_1"),
          (assign, ":var1", "$g_party_garrison_max_size_towns"),
        (try_end),
        (party_get_num_companions, ":var2", ":var0"),
        (try_begin),
          (lt, ":var2", ":var1"),
          (call_script, "script_cf_reinforce_party", ":var0"),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_party_npc_reinforcement_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_npc_reinforcement_rate_hours_passed", "$g_party_npc_reinforcement_rate"),
      (assign, "$g_party_npc_reinforcement_rate_hours_passed", 0),
      (try_for_range, ":var3", "trp_npc1", "trp_knight_1_1_wife"),
        (troop_slot_eq, ":var3", 166, 1),
        (troop_slot_eq, ":var3", 2, 2),
        (troop_get_slot, ":var4", ":var3", 10),
        (ge, ":var4", 1),
        (party_is_active, ":var4"),
        (party_get_attached_to, ":var5", ":var4"),
        (is_between, ":var5", "p_town_1_1", "p_salt_mine"),
        (party_slot_eq, ":var5", 54, -1),
        (store_faction_of_party, ":var6", ":var4"),
        (try_begin),
          (this_or_next|eq, ":var6", "fac_player_supporters_faction"),
          (eq, ":var6", "$players_kingdom"),
          (assign, ":var7", 1),
          (store_random_in_range, ":var8", 1, 1),
          (val_add, ":var7", ":var8"),
        (else_try),
          (game_get_reduce_campaign_ai, ":var9"),
          (try_begin),
            (eq, ":var9", 0),
            (assign, ":var7", 1),
          (else_try),
            (eq, ":var9", 1),
            (assign, ":var7", 1),
          (else_try),
            (eq, ":var9", 2),
            (assign, ":var7", 1),
          (try_end),
        (try_end),
        (try_begin),
          (faction_slot_eq, ":var6", 8, ":var3"),
          (val_add, ":var7", 1),
        (try_end),
        (try_for_range, ":var10", 0, ":var7"),
          (call_script, "script_hire_men_to_kingdom_hero_party", ":var3"),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_party_player_reinforcement_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_player_reinforcement_rate_hours_passed", "$g_party_player_reinforcement_rate"),
      (assign, "$g_party_player_reinforcement_rate_hours_passed", 0),
      (try_for_range, ":var11", "p_town_1_1", "p_castle_1_1"),
        (call_script, "script_feudal_lance_manpower_update", ":var11", "$g_party_lances_max_town"),
        (call_script, "script_update_npc_volunteer_troops_in_village", ":var11"),
      (try_end),
      (try_for_range, ":var11", "p_village_1_1", "p_salt_mine"),
        (call_script, "script_feudal_lance_manpower_update", ":var11", "$g_party_lances_max_village"),
        (call_script, "script_update_npc_volunteer_troops_in_village", ":var11"),
      (try_end),
      (try_for_range, ":var11", "p_castle_1_1", "p_village_1_1"),
        (call_script, "script_feudal_lance_manpower_update", ":var11", "$g_party_lances_max_castle"),
        (call_script, "script_update_npc_volunteer_troops_in_village", ":var11"),
      (try_end),
    (try_end),
    (val_add, "$g_party_town_merc_refill_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_town_merc_refill_rate_hours_passed", "$g_party_town_merc_refill_rate"),
      (assign, "$g_party_town_merc_refill_rate_hours_passed", 0),
      (try_begin),
        (call_script, "script_town_merc_respawn"),
      (try_end),
    (try_end),
    (val_add, "$g_party_faction_respawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_faction_respawn_rate_hours_passed", "$g_party_faction_respawn_rate"),
      (assign, "$g_party_faction_respawn_rate_hours_passed", 0),
      (try_for_range, ":var12", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var12", 21, 0),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_foragers", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_foragers"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 5),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_scouts", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_foragers"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 10),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_patrols", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_patrols"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 69),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_caravans", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_caravans"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 11),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_prisoner_trains", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_prisoner_trains"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 12),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_war_parties", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_war_parties"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 6),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_mercenary_companies", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_mercenary_companies"),
          (call_script, "script_create_kingdom_party_if_below_limit", ":var12", 19),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_party_bandit_respawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_bandit_respawn_rate_hours_passed", "$g_party_bandit_respawn_rate"),
      (assign, "$g_party_bandit_respawn_rate_hours_passed", 0),
      (call_script, "script_spawn_balts"),
      (call_script, "script_spawn_bandits"),
      (call_script, "script_cf_spawn_crusaders_and_jihadists"),
    (try_end),
    (val_add, "$g_party_mercenary_company_spawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_mercenary_company_spawn_rate_hours_passed", "$g_party_mercenary_company_spawn_rate"),
      (assign, "$g_party_mercenary_company_spawn_rate_hours_passed", 0),
      (try_begin),
        (store_random_in_range, ":var13", 0, 100),
        (lt, ":var13", "$g_party_mercenary_company_spawn_chance"),
        (call_script, "script_spawn_rogue_mercenaries"),
      (try_end),
    (try_end),
    (val_add, "$g_party_rebellion_respawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_rebellion_respawn_rate_hours_passed", "$g_party_rebellion_respawn_rate"),
      (assign, "$g_party_rebellion_respawn_rate_hours_passed", 0),
      (try_begin),
        (store_random_in_range, ":var13", 0, 100),
        (lt, ":var13", "$g_party_rebellion_chance"),
        (call_script, "script_spawn_peasant_rebels"),
      (try_end),
    (try_end),
    (val_add, "$g_party_rebellion_strong_respawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_rebellion_strong_respawn_rate_hours_passed", "$g_party_rebellion_strong_respawn_rate"),
      (assign, "$g_party_rebellion_strong_respawn_rate_hours_passed", 0),
      (try_begin),
        (store_random_in_range, ":var13", 0, 100),
        (lt, ":var13", "$g_party_rebellion_strong_chance"),
        (call_script, "script_spawn_rebels"),
      (try_end),
    (try_end),
    (val_add, "$g_party_fugitive_serf_hours_passed", 2),
    (try_begin),
      (ge, "$g_party_fugitive_serf_hours_passed", "$g_party_fugitive_serf_respawn_rate"),
      (assign, "$g_party_fugitive_serf_hours_passed", 0),
      (try_begin),
        (store_random_in_range, ":var13", 0, 100),
        (lt, ":var13", "$g_party_fugitive_serf_chance"),
        (call_script, "script_spawn_fugitive_serfs"),
      (try_end),
    (try_end),
    (val_add, "$g_misc_merchant_respawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_misc_merchant_respawn_rate_hours_passed", "$g_misc_merchant_respawn_rate"),
      (assign, "$g_misc_merchant_respawn_rate_hours_passed", 0),
      (try_begin),
        (call_script, "script_refresh_center_inventories"),
        (call_script, "script_refresh_center_armories"),
        (call_script, "script_refresh_center_weaponsmiths"),
        (call_script, "script_refresh_center_stables"),
      (try_end),
    (try_end),
    (val_add, "$g_misc_mercenary_respawn_rate_hours_passed", 2),
    (try_begin),
      (ge, "$g_misc_mercenary_respawn_rate_hours_passed", "$g_misc_tavern_mercenaries_respawn_rate"),
      (assign, "$g_misc_mercenary_respawn_rate_hours_passed", 0),
      (call_script, "script_update_mercenary_units_of_towns"),
    (try_end),
  ]),

  (2,
  [
    (try_begin),
      (gt, "$send_troops_tweak", 0),
      (party_is_active, "$send_troops_tweak"),
      (get_party_ai_object, ":var0", "$send_troops_tweak"),
      (party_is_in_town, "$send_troops_tweak", ":var0"),
      (party_get_slot, ":var1", ":var0", 7),
      (eq, ":var1", "trp_player"),
      (party_get_num_companion_stacks, ":var2", "$send_troops_tweak"),
      (try_for_range, ":var3", 0, ":var2"),
        (party_stack_get_size, ":var4", "$send_troops_tweak", ":var3"),
        (party_stack_get_troop_id, ":var5", "$send_troops_tweak", ":var3"),
        (party_add_members, ":var0", ":var5", ":var4"),
      (try_end),
      (remove_party, "$send_troops_tweak"),
      (assign, "$send_troops_tweak", 0),
    (else_try),
      (neg|party_is_active, "$send_troops_tweak"),
      (assign, "$send_troops_tweak", 0),
    (try_end),
  ]),

  (0.54,
  [
    (try_begin),
      (lt, "$g_prisoners_escape_cur_center", "p_town_1_1"),
      (assign, "$g_prisoners_escape_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_prisoners_escape_cur_center", "p_village_1_1"),
      (assign, "$g_prisoners_escape_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (neg|party_slot_eq, "$g_prisoners_escape_cur_center", 7, -1),
      (party_get_num_prisoner_stacks, ":var0", "$g_prisoners_escape_cur_center"),
      (party_get_num_prisoners, ":var1", "$g_prisoners_escape_cur_center"),
      (try_begin),
        (ge, ":var1", 10),
        (store_div, ":var2", ":var1", 10),
        (try_begin),
          (party_get_num_companions, ":var3", "$g_prisoners_escape_cur_center"),
          (val_div, ":var3", 20),
          (val_sub, ":var2", ":var3"),
        (try_end),
        (try_begin),
          (party_slot_eq, "$g_prisoners_escape_cur_center", 135, 1),
          (val_div, ":var2", 2),
        (try_end),
        (store_random_in_range, ":var4", 0, 101),
        (le, ":var4", ":var2"),
        (set_spawn_radius, 2),
        (spawn_around_party, "$g_prisoners_escape_cur_center", "pt_escaped_prisoners_party"),
        (assign, ":var5", reg0),
        (party_clear, ":var5"),
        (party_set_ai_behavior, ":var5", ai_bhvr_patrol_location),
        (party_set_aggressiveness, ":var5", 12),
        (try_for_range_backwards, ":var6", 0, ":var0"),
          (party_prisoner_stack_get_troop_id, ":var7", "$g_prisoners_escape_cur_center", ":var6"),
          (neg|troop_is_hero, ":var7"),
          (party_prisoner_stack_get_size, ":var8", "$g_prisoners_escape_cur_center", ":var6"),
          (party_add_members, ":var5", ":var7", ":var8"),
          (party_remove_prisoners, "$g_prisoners_escape_cur_center", ":var7", ":var8"),
        (try_end),
        (str_store_party_name_link, s4, "$g_prisoners_escape_cur_center"),
        (display_message, "@There was a prisoner break from {s4}!"),
      (try_end),
    (try_end),
    (val_add, "$g_prisoners_escape_cur_center", 1),
  ]),

  (0.101,
  [
    (try_begin),
      (lt, "$g_assassination_attempt_cur_npc", "trp_npc1"),
      (assign, "$g_assassination_attempt_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (ge, "$g_assassination_attempt_cur_npc", "trp_knight_1_1_wife"),
      (assign, "$g_assassination_attempt_cur_npc", "trp_npc1"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_assassination_attempt_cur_npc", 166, 1),
      (troop_slot_eq, "$g_assassination_attempt_cur_npc", 2, 2),
      (call_script, "script_cf_troop_get_random_enemy_lord", "$g_assassination_attempt_cur_npc"),
      (gt, reg0, 0),
      (assign, ":var0", reg0),
      (store_faction_of_troop, ":var1", "$g_assassination_attempt_cur_npc"),
      (try_begin),
        (neg|faction_slot_eq, ":var1", 11, "$g_assassination_attempt_cur_npc"),
        (call_script, "script_rand", 0, 1000),
        (lt, reg0, "$g_lord_death_chance_assassination"),
        (call_script, "script_rand", 0, 100),
        (try_begin),
          (lt, reg0, 35),
          (call_script, "script_kill_lord_assassination", "$g_assassination_attempt_cur_npc", 1, ":var0"),
        (else_try),
          (call_script, "script_kill_lord_assassination", "$g_assassination_attempt_cur_npc", 0, 0),
        (try_end),
      (else_try),
        (faction_slot_eq, ":var1", 11, "$g_assassination_attempt_cur_npc"),
        (call_script, "script_rand", 0, 1000),
        (lt, reg0, "$g_lord_death_chance_assassination_king"),
        (call_script, "script_rand", 0, 100),
        (try_begin),
          (lt, reg0, 60),
          (call_script, "script_kill_lord_assassination", "$g_assassination_attempt_cur_npc", 1, ":var0"),
        (else_try),
          (call_script, "script_kill_lord_assassination", "$g_assassination_attempt_cur_npc", 0, -1),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_assassination_attempt_cur_npc", 1),
  ]),

  (0.23,
  [
    (try_begin),
      (lt, "$g_execute_lord_cur_center", "p_town_1_1"),
      (assign, "$g_execute_lord_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_execute_lord_cur_center", "p_village_1_1"),
      (assign, "$g_execute_lord_cur_center", "p_town_1_1"),
    (try_end),
    (try_begin),
      (gt, "$g_lord_death_chance_execution_base", 0),
      (party_slot_ge, "$g_execute_lord_cur_center", 7, "trp_npc1"),
      (party_get_num_prisoner_stacks, ":var0", "$g_execute_lord_cur_center"),
      (try_for_range_backwards, ":var1", 0, ":var0"),
        (party_prisoner_stack_get_troop_id, ":var2", "$g_execute_lord_cur_center", ":var1"),
        (troop_is_hero, ":var2"),
        (troop_slot_eq, ":var2", 166, 1),
        (troop_slot_eq, ":var2", 2, 2),
        (party_get_slot, ":var3", "$g_execute_lord_cur_center", 7),
        (call_script, "script_ee_get_chance_of_execution", ":var2", ":var3"),
        (assign, ":var4", reg0),
        (try_begin),
          (call_script, "script_rand", 0, 100),
          (lt, reg0, ":var4"),
          (call_script, "script_ee_get_execution_method", ":var3"),
          (assign, ":var5", reg0),
          (call_script, "script_kill_lord_execution", ":var3", ":var2", "$g_execute_lord_cur_center", ":var5", 1),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_execute_lord_cur_center", 1),
  ]),

  (72,
  [
    (try_begin),
      (eq, "$g_execution_scheduled", 1),
      (gt, "$lord_to_execute", 0),
      (gt, "$g_method_of_execution", 0),
      (troop_get_slot, ":var0", "$lord_to_execute", 8),
      (eq, ":var0", "$g_execution_center"),
      (call_script, "script_kill_lord_execution", "trp_player", "$lord_to_execute", "$g_execution_center", "$g_method_of_execution"),
      (assign, "$g_execution_scheduled", 0),
    (else_try),
      (eq, "$g_execution_scheduled", 1),
      (gt, "$lord_to_execute", 0),
      (gt, "$g_method_of_execution", 0),
      (troop_get_slot, ":var0", "$lord_to_execute", 8),
      (neq, ":var0", "$g_execution_center"),
      (call_script, "script_add_notification_menu", "mnu_lord_executed_by_player_escaped", "$lord_to_execute", "$g_execution_center", "$g_method_of_execution"),
      (assign, "$g_execution_scheduled", 0),
    (try_end),
  ]),

  (168,
  [
    (try_begin),
      (eq, "$g_assassination_scheduled", 1),
      (troop_slot_eq, "$lord_to_assassinate", 166, 1),
      (store_faction_of_troop, ":var0", "$lord_to_assassinate"),
      (call_script, "script_rand", 0, 100),
      (lt, reg0, 40),
      (try_begin),
        (neg|faction_slot_eq, ":var0", 11, "$lord_to_assassinate"),
        (call_script, "script_rand", 0, 100),
        (try_begin),
          (lt, reg0, 35),
          (call_script, "script_kill_lord_assassination", "$lord_to_assassinate", 1, "trp_player"),
          (call_script, "script_add_notification_menu", "mnu_lord_assassination_by_player_suceeded", "$lord_to_assassinate"),
        (else_try),
          (call_script, "script_kill_lord_assassination", "$lord_to_assassinate", 0, "trp_player"),
          (call_script, "script_add_notification_menu", "mnu_lord_assassination_by_player_suceeded", "$lord_to_assassinate"),
        (try_end),
      (else_try),
        (faction_slot_eq, ":var0", 11, "$lord_to_assassinate"),
        (lt, reg0, 20),
        (call_script, "script_rand", 0, 100),
        (try_begin),
          (lt, reg0, 60),
          (call_script, "script_kill_lord_assassination", "$lord_to_assassinate", 1, "trp_player"),
          (call_script, "script_add_notification_menu", "mnu_lord_assassination_by_player_suceeded", "$lord_to_assassinate"),
        (else_try),
          (call_script, "script_kill_lord_assassination", "$lord_to_assassinate", 0, "trp_player"),
          (call_script, "script_add_notification_menu", "mnu_lord_assassination_by_player_suceeded", "$lord_to_assassinate"),
        (try_end),
      (try_end),
    (else_try),
      (eq, "$g_assassination_scheduled", 1),
      (troop_slot_eq, "$lord_to_assassinate", 166, 1),
      (call_script, "script_add_notification_menu", "mnu_lord_assassination_by_player_failed", "$lord_to_assassinate"),
    (else_try),
      (eq, "$g_assassination_scheduled", 1),
      (troop_slot_eq, "$lord_to_assassinate", 166, 0),
      (call_script, "script_add_notification_menu", "mnu_lord_assassination_by_player_died_before", "$lord_to_assassinate"),
    (try_end),
  ]),

  (0.3,
  [
    (val_add, "$g_misc_diplomacy_rate_hours_passed", 30),
    (try_begin),
      (store_mul, ":var0", "$g_misc_faction_diplomacy_rate", 100),
      (val_div, ":var0", 73),
      (ge, "$g_misc_diplomacy_rate_hours_passed", ":var0"),
      (assign, "$g_misc_diplomacy_rate_hours_passed", 0),
      (call_script, "script_randomly_start_war_peace_new", 1),
      (store_sub, ":var1", "fac_kingdoms_end", 1),
      (try_begin),
        (ge, "$g_diplo_kingdom", ":var1"),
        (try_begin),
          (faction_slot_eq, "fac_player_supporters_faction", 21, 0),
          (faction_slot_eq, "fac_player_supporters_faction", 11, "trp_player"),
          (eq, "$g_player_cur_role", 6),
          (assign, "$g_diplo_kingdom", "fac_player_supporters_faction"),
        (else_try),
          (assign, "$g_diplo_kingdom", "fac_kingdom_1"),
        (try_end),
      (else_try),
        (val_add, "$g_diplo_kingdom", 1),
      (try_end),
    (try_end),
  ]),

  (0.2,
  [
    (gt, "$g_lord_creation_rate", 0),
    (val_add, "$g_misc_lord_creation_rate_hours_passed", 20),
    (try_begin),
      (store_mul, ":var0", "$g_lord_creation_rate", 100),
      (val_div, ":var0", 73),
      (ge, "$g_misc_lord_creation_rate_hours_passed", ":var0"),
      (assign, "$g_misc_lord_creation_rate_hours_passed", 0),
      (try_begin),
        (lt, "$g_misc_lord_generation_cur_faction", "fac_player_supporters_faction"),
        (assign, "$g_misc_lord_generation_cur_faction", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (ge, "$g_misc_lord_generation_cur_faction", "fac_kingdoms_end"),
        (assign, "$g_misc_lord_generation_cur_faction", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (faction_slot_eq, "$g_misc_lord_generation_cur_faction", 21, 0),
        (call_script, "script_check_faction_lord_threshold", "$g_misc_lord_generation_cur_faction"),
        (eq, reg0, 1),
        (call_script, "script_create_new_lord_for_faction", "$g_misc_lord_generation_cur_faction"),
      (try_end),
      (val_add, "$g_misc_lord_generation_cur_faction", 1),
    (try_end),
  ]),

  (720,
  []),

  (0.056,
  [
    (try_begin),
      (lt, "$g_donation_changes_cur_village", "p_village_1_1"),
      (assign, "$g_donation_changes_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_donation_changes_cur_village", "p_salt_mine"),
      (assign, "$g_donation_changes_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_donation_changes_cur_village", 285, 1),
      (call_script, "script_rand", 200, 501),
      (assign, ":var0", reg0),
      (party_get_slot, ":var1", "$g_donation_changes_cur_village", 285),
      (val_min, ":var0", ":var1"),
      (store_div, ":var2", ":var0", 100),
      (call_script, "script_change_center_prosperity", "$g_donation_changes_cur_village", ":var2"),
      (val_sub, ":var1", ":var0"),
      (party_set_slot, "$g_donation_changes_cur_village", 285, ":var1"),
      (try_begin),
        (eq, "$cheat_menu", 1),
        (assign, reg4, ":var2"),
        (assign, reg5, ":var1"),
        (str_store_party_name, s3, "$g_donation_changes_cur_village"),
        (display_message, "@{s3} gained {reg4} prosperity. {reg5} money left."),
      (try_end),
    (try_end),
    (val_add, "$g_donation_changes_cur_village", 1),
  ]),

  (48,
  [
    (try_begin),
      (eq, "$g_misc_parties_drop_prisoners_to_walled_fief", 1),
      (try_for_parties, ":var0"),
        (party_is_active, ":var0"),
        (neg|party_slot_eq, ":var0", 0, 13),
        (party_get_template_id, ":var1", ":var0"),
        (this_or_next|eq, ":var1", "pt_forager_party"),
        (this_or_next|eq, ":var1", "pt_scout_party"),
        (this_or_next|eq, ":var1", "pt_patrol_party"),
        (this_or_next|eq, ":var1", "pt_war_party"),
        (this_or_next|eq, ":var1", "pt_mercenary_company"),
        (this_or_next|eq, ":var1", "pt_welsh"),
        (this_or_next|eq, ":var1", "pt_guelphs"),
        (this_or_next|eq, ":var1", "pt_ghibellines"),
        (this_or_next|eq, ":var1", "pt_crusaders"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_iberian"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_scandinavian"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_euro"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_italian"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_welsh"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_gaelic"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_teutonic"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_templar"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_hospitaller"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_saint_lazarus"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_santiago"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_calatrava"),
        (this_or_next|eq, ":var1", "pt_crusader_raiders_saint_thomas"),
        (this_or_next|eq, ":var1", "pt_jihadist_raiders"),
        (this_or_next|eq, ":var1", "pt_teutonic_raiders"),
        (this_or_next|eq, ":var1", "pt_curonians"),
        (this_or_next|eq, ":var1", "pt_prussians"),
        (this_or_next|eq, ":var1", "pt_samogitians"),
        (eq, ":var1", "pt_yotvingians"),
        (party_get_slot, ":var2", ":var0", 5),
        (try_begin),
          (party_is_in_town, ":var0", ":var2"),
          (party_get_num_prisoner_stacks, ":var3", ":var0"),
          (try_for_range_backwards, ":var4", 0, ":var3"),
            (party_prisoner_stack_get_troop_id, ":var5", ":var0", ":var4"),
            (party_prisoner_stack_get_size, ":var6", ":var0", ":var4"),
            (party_force_add_prisoners, ":var2", ":var5", ":var6"),
            (party_remove_prisoners, ":var0", ":var5", ":var6"),
          (try_end),
          (party_set_ai_behavior, ":var0", ai_bhvr_patrol_party),
          (party_set_ai_patrol_radius, ":var0", 2),
          (party_set_ai_object, ":var0", ":var2"),
          (party_set_ai_initiative, ":var0", 50),
          (party_set_aggressiveness, ":var0", 8),
          (party_set_courage, ":var0", 9),
        (else_try),
          (get_party_ai_behavior, ":var7", ":var0"),
          (eq, ":var7", 3),
          (party_get_num_prisoners, ":var8", ":var0"),
          (ge, ":var8", 50),
          (party_set_ai_behavior, ":var0", ai_bhvr_travel_to_party),
          (party_set_ai_object, ":var0", ":var2"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (gt, "$g_misc_civil_war_chance", 9999999),
    (val_add, "$g_misc_civil_war_hours_passed", 30),
    (try_begin),
      (store_mul, ":var0", "$g_misc_civil_war_rate", 100),
      (val_div, ":var0", 73),
      (ge, "$g_misc_civil_war_hours_passed", ":var0"),
      (assign, "$g_misc_civil_war_hours_passed", 0),
      (try_begin),
        (lt, "$g_misc_civil_war_cur_faction", "fac_player_supporters_faction"),
        (assign, "$g_misc_civil_war_cur_faction", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (ge, "$g_misc_civil_war_cur_faction", "fac_kingdoms_end"),
        (assign, "$g_misc_civil_war_cur_faction", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (faction_slot_eq, "$g_misc_civil_war_cur_faction", 21, 0),
        (neg|faction_slot_ge, "$g_misc_civil_war_cur_faction", 136, 1),
        (call_script, "script_check_faction_civil_war_requirements", "$g_misc_civil_war_cur_faction"),
        (eq, reg0, 1),
        (assign, ":var1", reg1),
        (call_script, "script_rand", 0, 100),
        (lt, "$g_misc_civil_war_chance", reg0),
        (call_script, "script_initiate_civil_war", "$g_misc_civil_war_cur_faction", ":var1"),
      (try_end),
      (val_add, "$g_misc_civil_war_cur_faction", 1),
    (try_end),
  ]),

  (72,
  [
    (try_begin),
      (assign, "$g_current_factions_active_temp", 0),
      (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
        (faction_slot_eq, ":var0", 21, 0),
        (val_add, "$g_current_factions_active_temp", 1),
      (try_end),
      (assign, "$g_current_factions_active", "$g_current_factions_active_temp"),
    (try_end),
  ]),

  (48,
  [
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (faction_slot_ge, ":var0", 136, 1),
      (faction_get_slot, ":var1", ":var0", 136),
      (neg|faction_slot_eq, ":var1", 21, 0),
      (str_clear, s1),
      (str_store_faction_name, s1, ":var1"),
      (faction_set_name, ":var0", s1),
      (faction_set_slot, ":var0", 136, 0),
    (try_end),
  ]),

  (24,
  [
    (try_for_range, ":var0", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (faction_slot_eq, ":var0", 21, 0),
      (faction_get_slot, ":var1", ":var0", 120),
      (val_add, ":var1", 1),
      (faction_set_slot, ":var0", 120, ":var1"),
    (try_end),
  ]),

  (0.1,
  [
    (val_add, "$g_party_faction_respawn_rate_hours_passed", 10),
    (try_begin),
      (store_mul, ":var0", "$g_party_faction_respawn_rate", 100),
      (val_div, ":var0", 73),
      (ge, "$g_party_faction_respawn_rate_hours_passed", ":var0"),
      (assign, "$g_party_faction_respawn_rate_hours_passed", 0),
      (try_begin),
        (lt, "$g_party_faction_respawn_rate_cur_faction", "fac_player_supporters_faction"),
        (assign, "$g_party_faction_respawn_rate_cur_faction", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (ge, "$g_party_faction_respawn_rate_cur_faction", "fac_kingdoms_end"),
        (assign, "$g_party_faction_respawn_rate_cur_faction", "fac_player_supporters_faction"),
      (try_end),
      (try_begin),
        (faction_slot_eq, "$g_party_faction_respawn_rate_cur_faction", 21, 0),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_foragers", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_foragers"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 5),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_scouts", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_foragers"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 10),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_patrols", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_patrols"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 69),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_caravans", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_caravans"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 11),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_prisoner_trains", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_prisoner_trains"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 12),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_war_parties", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_war_parties"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 6),
        (try_end),
        (try_begin),
          (gt, "$g_party_faction_parties_spawn_chance_mercenary_companies", 0),
          (call_script, "script_rand", 0, 100),
          (le, reg0, "$g_party_faction_parties_spawn_chance_mercenary_companies"),
          (call_script, "script_create_kingdom_party_if_below_limit", "$g_party_faction_respawn_rate_cur_faction", 19),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (0.794,
  [
    (try_begin),
      (lt, "$g_mill_prosperity_cur_village", "p_village_1_1"),
      (assign, "$g_mill_prosperity_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (ge, "$g_mill_prosperity_cur_village", "p_salt_mine"),
      (assign, "$g_mill_prosperity_cur_village", "p_village_1_1"),
    (try_end),
    (try_begin),
      (party_slot_ge, "$g_mill_prosperity_cur_village", 131, 1),
      (call_script, "script_change_center_prosperity", "$g_mill_prosperity_cur_village", 5),
    (try_end),
    (val_add, "$g_mill_prosperity_cur_village", 1),
  ]),

  (2.54,
  []),

  (0.2372,
  [
    (try_begin),
      (lt, "$g_leave_defeated_faction_cur_lord", "trp_kingdom_1_lord"),
      (assign, "$g_leave_defeated_faction_cur_lord", "trp_kingdom_1_lord"),
    (try_end),
    (try_begin),
      (ge, "$g_leave_defeated_faction_cur_lord", "trp_enhanced_rnd_lord_end"),
      (assign, "$g_leave_defeated_faction_cur_lord", "trp_kingdom_1_lord"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_leave_defeated_faction_cur_lord", 166, 1),
      (store_faction_of_troop, ":var0", "$g_leave_defeated_faction_cur_lord"),
      (faction_slot_eq, ":var0", 21, 1),
      (neg|troop_slot_ge, "$g_leave_defeated_faction_cur_lord", 8, 0),
      (call_script, "script_lord_find_alternative_faction", "$g_leave_defeated_faction_cur_lord"),
      (assign, ":var1", reg0),
      (is_between, ":var1", "fac_player_supporters_faction", "fac_kingdoms_end"),
      (neq, ":var1", ":var0"),
      (str_store_troop_name_link, s1, "$g_leave_defeated_faction_cur_lord"),
      (str_store_faction_name_link, s2, ":var1"),
      (str_store_faction_name_link, s3, ":var0"),
      (try_begin),
        (faction_slot_eq, ":var0", 11, "$g_leave_defeated_faction_cur_lord"),
        (store_random_in_range, ":var2", 0, 101),
        (try_begin),
          (lt, ":var2", 30),
          (display_message, "@{s1}, unable to cope with the loss of his kingdom, has committed suicide!"),
          (troop_set_slot, "$g_leave_defeated_faction_cur_lord", 174, 4),
        (else_try),
          (ge, ":var2", 30),
          (display_message, "@{s1} went into exile due to the loss of his kingdom."),
          (troop_set_slot, "$g_leave_defeated_faction_cur_lord", 174, 5),
        (try_end),
        (troop_set_slot, "$g_leave_defeated_faction_cur_lord", 166, 0),
      (else_try),
        (call_script, "script_change_troop_faction", "$g_leave_defeated_faction_cur_lord", ":var1"),
        (call_script, "script_dplmc_store_troop_is_female", "$g_leave_defeated_faction_cur_lord"),
        (assign, reg4, reg0),
        (str_store_string, s4, "str_ee_lord_defects_ordinary"),
        (display_log_message, "@{!}{s4}"),
      (try_end),
    (try_end),
    (val_add, "$g_leave_defeated_faction_cur_lord", 1),
  ]),

  (200,
  []),

  (0.4,
  [
    (try_begin),
      (lt, "$g_place_lady_under_protection_cur_lady", "trp_knight_1_1_wife"),
      (assign, "$g_place_lady_under_protection_cur_lady", "trp_knight_1_1_wife"),
    (try_end),
    (try_begin),
      (ge, "$g_place_lady_under_protection_cur_lady", "trp_heroes_end"),
      (assign, "$g_place_lady_under_protection_cur_lady", "trp_knight_1_1_wife"),
    (try_end),
    (try_begin),
      (troop_slot_eq, "$g_place_lady_under_protection_cur_lady", 166, 1),
      (try_begin),
        (neg|troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 30, 0),
        (neg|troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 34, 0),
        (neg|troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 31, 0),
        (neg|troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 33, 0),
      (else_try),
        (troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 30, 0),
        (troop_get_slot, ":var0", "$g_place_lady_under_protection_cur_lady", 30),
        (troop_slot_eq, ":var0", 166, 1),
      (else_try),
        (troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 34, 0),
        (troop_get_slot, ":var0", "$g_place_lady_under_protection_cur_lady", 34),
        (troop_slot_eq, ":var0", 166, 1),
      (else_try),
        (troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 31, 0),
        (troop_get_slot, ":var0", "$g_place_lady_under_protection_cur_lady", 31),
        (troop_slot_eq, ":var0", 166, 1),
      (else_try),
        (troop_slot_ge, "$g_place_lady_under_protection_cur_lady", 33, 0),
        (troop_get_slot, ":var1", "$g_place_lady_under_protection_cur_lady", 33),
        (troop_slot_eq, ":var1", 166, 1),
      (else_try),
        (store_faction_of_troop, ":var2", "$g_place_lady_under_protection_cur_lady"),
        (assign, ":var3", "trp_enhanced_rnd_lord_end"),
        (try_for_range, ":var4", "trp_knight_1_1", ":var3"),
          (troop_slot_eq, ":var4", 166, 1),
          (store_faction_of_troop, ":var5", ":var4"),
          (eq, ":var5", ":var2"),
          (call_script, "script_troop_get_relation_with_troop", "$g_place_lady_under_protection_cur_lady", ":var4"),
          (ge, reg0, 10),
          (troop_set_slot, "$g_place_lady_under_protection_cur_lady", 33, ":var4"),
          (assign, ":var3", -1),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_place_lady_under_protection_cur_lady", 1),
  ]),

  (12,
  [
    (faction_slot_eq, "$players_kingdom", 21, 0),
    (faction_slot_eq, "$players_kingdom", 11, "trp_player"),
    (eq, "$g_player_cur_role", 6),
    (le, "$g_player_minister", 0),
    (try_begin),
      (gt, "$g_minister_notification_hours", 0),
      (val_sub, "$g_minister_notification_hours", 12),
    (else_try),
      (eq, "$g_minister_notification_hours", 0),
      (call_script, "script_add_notification_menu", "mnu_ee_minister_appoint", 0, 0),
    (try_end),
  ]),

  (24,
  []),

  (0.21,
  [
    (try_begin),
      (eq, "$g_cur_horse_merchant", "trp_dplmc_constable"),
      (assign, "$g_cur_horse_merchant", "trp_town_1_horse_merchant"),
    (try_end),
    (try_begin),
      (lt, "$g_cur_horse_merchant", "trp_town_1_horse_merchant"),
      (assign, "$g_cur_horse_merchant", "trp_town_1_horse_merchant"),
    (try_end),
    (try_begin),
      (ge, "$g_cur_horse_merchant", "trp_town_1_mayor"),
      (assign, "$g_cur_horse_merchant", "trp_dplmc_constable"),
    (try_end),
    (try_begin),
      (troop_slot_ge, "$g_cur_horse_merchant", 10, 1),
      (troop_get_slot, ":var0", "$g_cur_horse_merchant", 12),
      (val_sub, ":var0", 1),
      (troop_set_slot, "$g_cur_horse_merchant", 12, ":var0"),
      (try_begin),
        (eq, ":var0", 0),
        (troop_get_slot, ":var1", "$g_cur_horse_merchant", 10),
        (str_store_item_name, s1, ":var1"),
        (store_sub, ":var2", "$g_cur_horse_merchant", "trp_town_1_horse_merchant"),
        (val_add, ":var2", "p_town_1_1"),
        (str_store_party_name, s2, ":var2"),
        (call_script, "script_add_notification_menu", "mnu_ee_horse_ready_merchant"),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$g_cur_horse_merchant", "trp_dplmc_constable"),
      (try_begin),
        (troop_slot_ge, "$g_cur_horse_merchant", 25, 1),
        (troop_get_slot, ":var0", "$g_cur_horse_merchant", 25),
        (val_sub, ":var0", 1),
        (troop_set_slot, "$g_cur_horse_merchant", 25, ":var0"),
        (try_begin),
          (eq, ":var0", 0),
          (troop_get_slot, ":var3", "$g_cur_horse_merchant", 24),
          (try_begin),
            (party_slot_eq, ":var3", 7, "trp_player"),
            (str_store_party_name, s1, ":var3"),
            (troop_set_slot, "$g_cur_horse_merchant", 22, ":var3"),
            (troop_set_slot, "$g_cur_horse_merchant", 24, 0),
            (troop_set_slot, "$g_cur_horse_merchant", 23, 0),
            (troop_set_slot, "$g_cur_horse_merchant", 25, 0),
            (call_script, "script_add_notification_menu", "mnu_ee_stable_move_constable"),
          (else_try),
            (neg|party_slot_eq, ":var3", 7, "trp_player"),
            (troop_get_slot, ":var4", "$g_cur_horse_merchant", 23),
            (str_store_party_name, s1, ":var3"),
            (str_store_party_name, s2, ":var4"),
            (troop_set_slot, "$g_cur_horse_merchant", 22, 0),
            (troop_set_slot, "$g_cur_horse_merchant", 24, ":var4"),
            (troop_set_slot, "$g_cur_horse_merchant", 23, ":var3"),
            (troop_get_slot, ":var5", "$g_cur_horse_merchant", 26),
            (troop_set_slot, "$g_cur_horse_merchant", 25, ":var5"),
            (call_script, "script_add_notification_menu", "mnu_ee_stable_move_constable_fail"),
          (try_end),
        (try_end),
      (try_end),
    (try_end),
    (val_add, "$g_cur_horse_merchant", 1),
  ]),

  (2,
  [
    (try_begin),
      (troop_slot_ge, "trp_dplmc_constable", 15, 1),
      (troop_get_slot, ":var0", "trp_dplmc_constable", 15),
      (val_sub, ":var0", 2),
      (troop_set_slot, "trp_dplmc_constable", 15, ":var0"),
      (try_begin),
        (le, ":var0", 0),
        (troop_get_slot, ":var1", "trp_dplmc_constable", 13),
        (str_store_item_name, s1, ":var1"),
        (troop_get_slot, ":var2", "trp_dplmc_constable", 22),
        (str_store_party_name, s2, ":var2"),
        (call_script, "script_add_notification_menu", "mnu_ee_horse_ready_constable"),
      (try_end),
    (try_end),
    (try_begin),
      (troop_slot_ge, "trp_dplmc_constable", 18, 1),
      (troop_get_slot, ":var0", "trp_dplmc_constable", 18),
      (val_sub, ":var0", 2),
      (troop_set_slot, "trp_dplmc_constable", 18, ":var0"),
      (try_begin),
        (le, ":var0", 0),
        (troop_get_slot, ":var1", "trp_dplmc_constable", 16),
        (str_store_item_name, s1, ":var1"),
        (troop_get_slot, ":var2", "trp_dplmc_constable", 22),
        (str_store_party_name, s2, ":var2"),
        (call_script, "script_add_notification_menu", "mnu_ee_horse_ready_constable"),
      (try_end),
    (try_end),
    (try_begin),
      (troop_slot_ge, "trp_dplmc_constable", 21, 1),
      (troop_get_slot, ":var0", "trp_dplmc_constable", 21),
      (val_sub, ":var0", 2),
      (troop_set_slot, "trp_dplmc_constable", 21, ":var0"),
      (try_begin),
        (le, ":var0", 0),
        (troop_get_slot, ":var1", "trp_dplmc_constable", 19),
        (str_store_item_name, s1, ":var1"),
        (troop_get_slot, ":var2", "trp_dplmc_constable", 22),
        (str_store_party_name, s2, ":var2"),
        (call_script, "script_add_notification_menu", "mnu_ee_horse_ready_constable"),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (assign, ":var0", "p_village_1_1"),
    (try_for_range, ":var1", "p_town_1_1", ":var0"),
      (party_slot_eq, ":var1", 7, "trp_player"),
      (troop_slot_eq, "trp_dplmc_constable", 22, ":var1"),
      (party_slot_ge, ":var1", 293, 1),
      (troop_get_inventory_capacity, ":var2", "trp_stable_troop"),
      (store_random_in_range, ":var3", 0, 101),
      (try_begin),
        (party_slot_eq, ":var1", 293, 1),
        (try_for_range, ":var4", 10, ":var2"),
          (troop_get_inventory_slot, ":var5", "trp_stable_troop", ":var4"),
          (gt, ":var5", 0),
          (item_get_type, ":var6", ":var5"),
          (eq, ":var6", 1),
          (troop_get_inventory_slot_modifier, ":var7", "trp_stable_troop", ":var4"),
          (lt, ":var3", 30),
          (try_begin),
            (eq, ":var7", 30),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 31),
          (else_try),
            (eq, ":var7", 31),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 0),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@One of your horses was fully healed in {s1}.", 0x50FF50),
          (try_end),
        (try_end),
      (else_try),
        (party_slot_eq, ":var1", 293, 2),
        (try_for_range, ":var4", 10, ":var2"),
          (troop_get_inventory_slot, ":var5", "trp_stable_troop", ":var4"),
          (gt, ":var5", 0),
          (item_get_type, ":var6", ":var5"),
          (eq, ":var6", 1),
          (troop_get_inventory_slot_modifier, ":var7", "trp_stable_troop", ":var4"),
          (lt, ":var3", 45),
          (try_begin),
            (eq, ":var7", 30),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 31),
          (else_try),
            (eq, ":var7", 31),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 0),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@One of your horses was fully healed in {s1}.", 0x50FF50),
          (try_end),
        (try_end),
      (else_try),
        (party_slot_eq, ":var1", 293, 3),
        (try_for_range, ":var4", 10, ":var2"),
          (troop_get_inventory_slot, ":var5", "trp_stable_troop", ":var4"),
          (gt, ":var5", 0),
          (item_get_type, ":var6", ":var5"),
          (eq, ":var6", 1),
          (troop_get_inventory_slot_modifier, ":var7", "trp_stable_troop", ":var4"),
          (lt, ":var3", 60),
          (try_begin),
            (eq, ":var7", 30),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 31),
          (else_try),
            (eq, ":var7", 31),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 0),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@One of your horses was fully healed in {s1}.", 0x50FF50),
          (try_end),
        (try_end),
      (else_try),
        (party_slot_eq, ":var1", 293, 4),
        (try_for_range, ":var4", 10, ":var2"),
          (troop_get_inventory_slot, ":var5", "trp_stable_troop", ":var4"),
          (gt, ":var5", 0),
          (item_get_type, ":var6", ":var5"),
          (eq, ":var6", 1),
          (troop_get_inventory_slot_modifier, ":var7", "trp_stable_troop", ":var4"),
          (lt, ":var3", 75),
          (try_begin),
            (eq, ":var7", 30),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 31),
          (else_try),
            (eq, ":var7", 31),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 0),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@One of your horses was fully healed in {s1}.", 0x50FF50),
          (else_try),
            (eq, ":var7", 0),
            (troop_set_inventory_slot_modifier, "trp_stable_troop", ":var4", 18),
            (str_store_party_name, s1, ":var1"),
            (display_message, "@One of your horses was auto trained to heavy in {s1}.", 0x50FF50),
          (try_end),
        (try_end),
      (try_end),
      (assign, ":var0", -1),
    (try_end),
  ]),

  (24,
  []),

  (0,
  [
    (try_begin),
      (store_item_kind_count, reg0, "itm_no_item", "trp_cstm_load_check"),
      (eq, reg0, 0),
      (try_for_range, ":var0", "$cstm_troops_begin", "$cstm_troops_end"),
        (call_script, "script_cstm_replace_custom_troop_with_dummy", ":var0"),
      (try_end),
      (call_script, "script_cstm_setup_item_arrays"),
      (troop_add_item, "trp_cstm_load_check", "itm_no_item"),
    (try_end),
  ]),

  (168,
  [
    (eq, "$freelancer_state", 1),
    (store_current_hours, reg20),
    (val_add, reg20, 168),
    (quest_set_slot, "qst_freelancer_enlisted", 14, reg20),
    (try_begin),
      (troop_get_upgrade_troop, ":var0", "$player_cur_troop", 0),
      (gt, ":var0", 1),
      (quest_slot_ge, "qst_freelancer_enlisted", 13, 1),
      (quest_get_slot, ":var1", "qst_freelancer_enlisted", 17),
      (troop_get_xp, ":var2", "trp_player"),
      (store_sub, ":var3", ":var2", ":var1"),
      (neg|quest_slot_ge, "qst_freelancer_enlisted", 13, ":var3"),
      (jump_to_menu, "mnu_upgrade_path"),
    (try_end),
    (try_begin),
      (store_character_level, ":var4", "$player_cur_troop"),
      (store_mul, ":var5", 10, ":var4"),
      (store_mul, ":var6", 50, ":var4"),
      (troop_add_gold, "trp_player", ":var5"),
      (add_xp_to_troop, ":var6", "trp_player"),
      (play_sound, "snd_money_received", 0),
    (try_end),
  ]),

  (12,
  [
    (eq, "$freelancer_state", 1),
    (assign, ":var0", 0),
    (troop_get_inventory_capacity, ":var1", "trp_player"),
    (try_for_range, ":var2", 0, ":var1"),
      (troop_get_inventory_slot, ":var3", "trp_player", ":var2"),
      (ge, ":var3", 0),
      (is_between, ":var3", "itm_smoked_fish", "itm_siege_supply"),
      (troop_inventory_slot_get_item_amount, reg30, "trp_player", ":var2"),
      (val_add, ":var0", reg30),
    (try_end),
    (try_begin),
      (lt, ":var0", 10),
      (troop_add_item, "trp_player", "itm_bread"),
    (try_end),
  ]),

  (1,
  [
    (eq, "$freelancer_state", 1),
    (set_camera_follow_party, "$enlisted_party"),
    (party_relocate_near_party, "p_main_party", "$enlisted_party", 1),
  ]),

  (1,
  [
    (try_for_range, ":var0", "p_town_1_1", "p_castle_1_1"),
      (party_get_slot, ":var1", ":var0", 302),
      (gt, ":var1", 0),
      (party_get_slot, ":var2", ":var0", 303),
      (store_current_hours, ":var3"),
      (ge, ":var3", ":var2"),
      (call_script, "script_change_player_relation_with_center", ":var0", -5, 16724787),
      (try_begin),
        (lt, ":var1", 100000),
        (val_mul, ":var1", 14),
        (val_div, ":var1", 10),
        (try_begin),
          (gt, ":var1", 100000),
          (assign, ":var1", 100000),
        (try_end),
        (val_add, ":var2", 336),
        (party_set_slot, ":var0", 302, ":var1"),
        (party_set_slot, ":var0", 303, ":var2"),
        (str_store_party_name, s1, ":var0"),
        (display_message, "@You missed the deadline to pay back your debts in {s1}. They now grow at an interest of 50%."),
      (else_try),
        (assign, ":var1", 100000),
        (val_add, ":var2", 336),
        (party_set_slot, ":var0", 302, ":var1"),
        (party_set_slot, ":var0", 303, ":var2"),
        (store_faction_of_party, ":var4", ":var0"),
        (call_script, "script_change_player_relation_with_faction_ex", ":var4", -1),
        (str_store_party_name, s1, ":var0"),
        (display_message, "@Your debt in {s1} is now so high that the King himself has taken notice. He has frozen your debt, but is displeased with the situation.", 0xFF3333),
      (try_end),
    (try_end),
  ]),

  (336,
  [
    (try_for_range, ":var0", "p_town_1_1", "p_salt_mine"),
      (neg|party_slot_eq, ":var0", 0, 2),
      (party_get_slot, ":var1", ":var0", 50),
      (party_get_slot, ":var2", ":var0", 298),
      (assign, ":var3", 0),
      (try_begin),
        (ge, ":var1", 60),
        (store_sub, ":var3", ":var1", 60),
        (val_div, ":var3", 5),
        (val_add, ":var3", 3),
      (else_try),
        (le, ":var1", 40),
        (store_sub, ":var3", ":var1", 40),
        (val_div, ":var3", 5),
        (val_sub, ":var3", 3),
      (try_end),
      (store_div, ":var4", ":var2", 100),
      (val_mul, ":var3", ":var4"),
      (val_add, ":var2", ":var3"),
      (try_begin),
        (party_slot_eq, ":var0", 0, 3),
        (try_begin),
          (gt, ":var2", 100000),
          (assign, ":var2", 100000),
          (party_set_slot, ":var0", 298, ":var2"),
        (else_try),
          (lt, ":var2", 5000),
          (assign, ":var2", 5000),
          (party_set_slot, ":var0", 298, ":var2"),
        (else_try),
          (party_set_slot, ":var0", 298, ":var2"),
        (try_end),
      (else_try),
        (party_slot_eq, ":var0", 0, 4),
        (try_begin),
          (gt, ":var2", 10000),
          (assign, ":var2", 10000),
          (party_set_slot, ":var0", 298, ":var2"),
        (else_try),
          (lt, ":var2", 500),
          (assign, ":var2", 500),
          (party_set_slot, ":var0", 298, ":var2"),
        (else_try),
          (party_set_slot, ":var0", 298, ":var2"),
        (try_end),
      (try_end),
    (try_end),
    (try_for_range, ":var0", "p_town_1_1", "p_salt_mine"),
      (neg|party_slot_eq, ":var0", 0, 2),
      (party_get_slot, ":var2", ":var0", 298),
      (party_get_slot, ":var5", ":var0", 295),
      (party_get_slot, ":var6", ":var0", 297),
      (party_get_slot, ":var1", ":var0", 50),
      (store_sub, ":var7", ":var1", 50),
      (val_add, ":var7", 100),
      (try_begin),
        (store_div, ":var8", ":var2", 200),
        (store_add, ":var9", ":var5", ":var6"),
        (store_sub, ":var10", ":var9", ":var8"),
        (try_begin),
          (lt, ":var9", ":var8"),
          (store_sub, ":var11", ":var8", ":var9"),
          (val_add, ":var5", ":var11"),
          (party_set_slot, ":var0", 295, ":var5"),
        (else_try),
          (ge, ":var10", 20),
          (ge, ":var5", 10),
          (val_sub, ":var5", 10),
          (party_set_slot, ":var0", 295, ":var5"),
        (try_end),
        (try_begin),
          (gt, ":var6", 0),
          (try_begin),
            (le, ":var9", ":var8"),
            (val_mul, ":var6", ":var7"),
            (party_set_slot, ":var0", 299, ":var6"),
          (else_try),
            (store_mul, ":var12", ":var10", -1),
            (val_add, ":var12", ":var7"),
            (try_begin),
              (ge, ":var12", 85),
              (val_mul, ":var6", ":var12"),
              (party_set_slot, ":var0", 299, ":var6"),
            (else_try),
              (store_sub, ":var13", ":var10", 15),
              (val_sub, ":var6", ":var13"),
              (try_begin),
                (lt, ":var12", 0),
                (assign, ":var12", 0),
              (try_end),
              (val_mul, ":var6", ":var12"),
              (party_set_slot, ":var0", 299, ":var6"),
              (val_mul, ":var13", -50),
              (party_set_slot, ":var0", 300, ":var13"),
            (try_end),
          (try_end),
          (party_get_slot, ":var14", ":var0", 301),
          (party_get_slot, ":var15", ":var0", 299),
          (party_get_slot, ":var16", ":var0", 300),
          (val_add, ":var14", ":var15"),
          (val_add, ":var14", ":var16"),
          (party_set_slot, ":var0", 301, ":var14"),
        (try_end),
      (try_end),
    (try_end),
  ]),

  (168,
  [
    (this_or_next|neq, "$g_infinite_camping", 1),
    (eq, "$freelancer_state", 1),
    (assign, ":var0", "p_salt_mine"),
    (try_for_range, ":var1", "p_town_1_1", ":var0"),
      (neg|party_slot_eq, ":var1", 0, 2),
      (this_or_next|party_slot_ge, ":var1", 297, 1),
      (this_or_next|party_slot_ge, ":var1", 301, 1),
      (party_slot_ge, ":var1", 302, 1),
      (assign, ":var0", "p_town_1_1"),
    (try_end),
    (eq, ":var0", "p_town_1_1"),
    (try_begin),
      (eq, "$g_misc_floris_bank_receive_directly", 1),
      (try_for_range, ":var1", "p_town_1_1", "p_salt_mine"),
        (neg|party_slot_eq, ":var1", 0, 2),
        (party_slot_ge, ":var1", 301, 1),
        (party_get_slot, reg15, ":var1", 301),
        (troop_add_gold, "trp_player", reg15),
        (party_set_slot, ":var1", 301, 0),
        (str_store_party_name_link, s1, ":var1"),
        (display_message, "@You got {reg15} denars from the lands you own in {s1}."),
      (try_end),
    (try_end),
    (try_begin),
      (eq, "$g_misc_floris_bank_receive_directly", 1),
      (try_for_range, ":var1", "p_town_1_1", "p_castle_1_1"),
        (party_slot_ge, ":var1", 304, 1),
        (party_get_slot, ":var2", ":var1", 304),
        (party_get_slot, ":var3", ":var1", 50),
        (store_div, ":var4", ":var3", 20),
        (val_div, ":var2", 100),
        (val_mul, ":var2", ":var4"),
        (assign, reg16, ":var2"),
        (str_store_party_name_link, s2, ":var1"),
        (troop_add_gold, "trp_player", ":var2"),
        (display_message, "@You got {reg16} denars from the interest on your deposits in {s2}."),
      (try_end),
    (else_try),
      (eq, "$g_misc_floris_bank_receive_directly", 0),
      (try_for_range, ":var1", "p_town_1_1", "p_castle_1_1"),
        (party_slot_ge, ":var1", 304, 1),
        (party_get_slot, ":var2", ":var1", 304),
        (party_get_slot, ":var3", ":var1", 50),
        (store_div, ":var4", ":var3", 20),
        (store_div, ":var5", ":var2", 100),
        (store_mul, ":var6", ":var5", ":var4"),
        (party_get_slot, ":var2", ":var1", 301),
        (val_add, ":var2", ":var6"),
        (party_set_slot, ":var1", 301, ":var2"),
      (try_end),
    (try_end),
    (start_presentation, "prsnt_bank_quickview"),
  ]),

]